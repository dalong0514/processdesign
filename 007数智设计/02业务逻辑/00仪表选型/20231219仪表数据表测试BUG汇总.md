## 20131219仪表数据表测试BUG汇总

### 20221130仪表数据表测试 BUG 汇总

华雷

01. 压力表

1.1 压力表量程获取逻辑修改（已放入第二次迭代的需求文档）【已修改】

1.1.1 最大压力大于等于 0.1 的量程获取

如果压力全部为正值的情况：

步骤一：获取用于匹配量程的「量程压力」。量程压力的获取逻辑仅与「设计压力」和「操作压力」有关。

下面的逻辑命中一个即可跳出。

1、如果设计压力有值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是单个值（不是一个范围），比如 0.35MPa，那么取操作压力，乘以 1.5 倍获得量程压力。

3、如果设计压力为空，且操作压力是一个范围，比如 0.2~0.4MPa，那么通过取操作压力范围拿到最大的压力 0.4，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

匹配逻辑与老逻辑相同。最终要匹配的量程区间汇总： UPPER_LIMIT_PRESSURE_01 (0.1, "0~0.1M"), UPPER_LIMIT_PRESSURE_016 (0.16, "0~0.16M"), UPPER_LIMIT_PRESSURE_025 (0.25, "0~0.25M"), UPPER_LIMIT_PRESSURE_04 (0.4, "0~0.4M"), UPPER_LIMIT_PRESSURE_06 (0.6, "0~0.6M"), UPPER_LIMIT_PRESSURE_1 (1, "0~1M"), UPPER_LIMIT_PRESSURE_16 (1.6, "0~1.6M"), UPPER_LIMIT_PRESSURE_25 (2.5, "0~2.5M"), UPPER_LIMIT_PRESSURE_4 (4, "0~4M"), UPPER_LIMIT_PRESSURE_6 (6, "0~6M"), UPPER_LIMIT_PRESSURE_10 (10, "0~10M"), UPPER_LIMIT_PRESSURE_160 (16, "0~16M"), UPPER_LIMIT_PRESSURE_250 (25, "0~25M"), UPPER_LIMIT_PRESSURE_40 (40, "0~40M"), UPPER_LIMIT_PRESSURE_60 (60, "0~60M");

如果压力有负值的情况：

如果压力值全部是负压，那么量程直接匹配出：-0.1~0。

如果压力的最大值是正值，那么走下面的逻辑。

步骤一：获取用于匹配量程的「量程压力」。

1、如果设计压力有值且为正值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是一个范围，比如 - 0.098~0.4MPa，那么通过取操作压力范围拿到最大的压力 0.4，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

最终要匹配的量程区间汇总：

"-0.1~0.06M"

"-0.1~0.15M"

"-0.1~0.3M"

"-0.1~0.5M"

"-0.1~0.9M"

"-0.1~1.5M"

"-0.1~2.4M"

1.1.2 最大压力小于 0.1 的量程获取

如果压力全部为正值的情况：

步骤一：获取用于匹配量程的「量程压力」。逻辑完全参考压力大于 0.1 的场景。

步骤二：根据量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

最终要匹配的量程区间汇总：

"0~1.6kPa"

"0~2.5kPa"

"0~4kPa"

"0~6kPa"

"0~10kPa"

"0~16kPa"

"0~25kPa"

"0~40kPa"

如果压力全部为负值的情况：

步骤一：获取用于匹配量程的「量程压力」。

1、如果设计压力有值且为负值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是单个值且为负值（不是一个范围），比如 - 0.05MPa，那么取操作压力，乘以 1.5 倍获得量程压力。

3、如果设计压力为空，且操作压力是一个范围且最大最小都为负值，比如 - 0.098~-0.05MPa，那么通过取操作压力范围拿到最左侧最大的负值，如举例中的 - 0.098，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

最终要匹配的量程区间汇总：

"-1.6~0kPa"

"-2.5~0kPa"

"-4~0kPa"

"-6~0kPa"

"-10~0kPa"

"-16~0kPa"

"-25~0kPa"

"-40~0kPa"

"-100~0kPa" 转成 "-0.1~0Mpa"@常恃豪【已修复】

如果压力既有正值又有负值的情况：

步骤一：获取用于匹配量程的「量程压力」。此时要分别拿到正值的量程压力和负值的量程压力，分别取匹配量程范围的最小值和最大值。

符合这种情况的时候，操作压力肯定是一个范围值，最小值是负值，最大值是正值。

比如 - 0.098~0.2MPa，取最小值（负值）乘以 1.1 获取负值的量程压力；取最大值（正值）乘以 1.1 获取正值的量程压力。

步骤二：根据负值量程压力和正值量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

负值量程压力和正值量程压力，取绝对值大的取匹配量程。

最终要匹配的量程区间汇总：

"-0.8~0.8kPa"

"-1.2~1.2kPa"

"-2~2kPa"

"-3~3kPa"

"-5~5kPa"

"-8~8kPa"

"-12~12kPa"

"-20~20kPa"

1.3 选型为差压变送器，膜盒出现对应了法兰连接的情况，方式和规格都应该为内螺纹 / 1/2「NPT（F），所有的差压变送器，都缺少低压侧连接：单侧取压，应该是「接大气」，双侧取压，应该是「同高压侧」【待转化】@冯大龙

1.4 选型为差压变送器，管道钢衬，匹配为隔膜差压，测量形式膜盒错误应该为隔膜 ，且测量材质错误，和管道材质不匹配，且隔膜差压，精度应该是 0.2, 同时隔膜差压需要有填充液参数【待转化】@冯大龙

1.5 仪表量程不满足要求，正常值 1.5 倍，再上选获取量程，比如第一个应该是 0~10kPa，第二个 0~0.6M【已修复】

点击图片可查看完整电子表格

压力表的量程问题，除了量程上限偏低，还有量程缺少情况

微压的量程，出现问题比较多，很多匹配不了条件

1.6 压力变送器：选型为隔膜压力变送器，压力变送器法兰应该都是 S31603, 存在大部分缺密封液的情况，默认是硅油，发烟硫酸应该是氟碳润滑剂【待转化】

压力表选型为隔膜压力表的，除了法兰以外，问题同压力变送器

1.7 选型为压力变送器，匹配为普通类型出现对应了法兰连接的情况，方式和规格都应该为内螺纹 / 1/2「NPT（F）【待转化】

1.8 选型为压力变送器，低一些衬设备未能识别，应该选型为隔膜压力变送器，备注为设备自带的，不应该出数据表，测量元件，不是为隔膜就是膜盒，不能空白【待转化】

1.9 条件中特材没有识别

哈氏合金没有识别，没有按膜片压力表选型

条件中钛不识别

1.10 选型为压力变送器，未能识别条件中一些含固体颗粒情况，如固体产品粉碎，需要隔膜压力变送器【待转化】

1.11 选型为膜盒 / 膜片压力表的测量元件形式需要改为膜盒同时精度应该为 2.5 隔膜法兰只有直接连接，没有角型连接

1.12 泵入口的压力都需要考虑负压量程从 - 0.1 起，应该为 - 0.1~0.9M【已修复，同属于压力量程范围 bug】

1.13 压力表选型 DN15 的管子未能选择 M14X1.5 60 表盘 2.5 精度【已修改】

1.14 消防泵试验压力未按逻辑选型

选型逻辑

大龙：

1.13 和 1.14 的问题，第一次需求逻辑里都有。（2023-01-16）@常恃豪

1.15 爆破片出口压力未加备注【已修改】

选型逻辑

大龙：

已补充到二次需求迭代文档里。（2023-01-16）

02. 温度计

2.1 条件材质为非金属的特材，不能识别，套管材质不匹配【待转化】

2.2 管道小于 DN100 备注需要加上「管道扩径至 DN100」【已修改】

2.3 插入深度等未定项，需要写 hold, 用来以后核对，同时套管的插入深度应该是 U=【已修改】

2.4 温度变送器的测量范围全部缺失【已修改】

2.5 统一规定中的法兰接口 DN40 ，数据表没有反映【已修改】

2.6 温度高于 500 的未能选型热电偶

2.7 热电阻数据表，测量元件数量缺失默认为 1 结构形式缺失默认铠装

2.8 双金属温度计，直径缺少，与套管对接的过程连接错误，分别为 8 / 活动外 M20X1.5 (M), 同时缺少量程范围

03. 液位计

3.1 差压变送器逻辑修正【已修改】

原逻辑：

修正为：

3.2 磁性液位计的过程连接尺寸修正逻辑修改【已修改】【已回测确认】

原逻辑：

修正为：

3.3 液位计位号问题【已修复】

液位开关位号要改为 LS-

大龙（2023-01-15）：

原逻辑是集中液位计位号设为 LT - 开头，现逻辑：集中液位计里，类型为液位开关的，其位号设为 LS - 开头的。

3.4 液位开关缺失原理，根据选型逻辑确定

选型逻辑：

大龙：

先默认音叉液位开关，型式修改的逻辑验收后修改。（2023-01-15）

3.5 液位开关的过程连接丢失，同时钢衬的探头，法兰也需要钢衬四氟

大龙：

验收后修改。（2023-01-15）

3.6 磁性液位计和液位开关的密度参数都丢失【已修复】

3.7 磁性液位计的触液材质低于设备材质

大龙：

验收后修改。（2023-01-15）

3.8 磁性液位计都备注，排污阀配盲板【已修复】

3.9 雷达液位计缺少量程范围，根据工艺条件的液位范围确定，同时备注缺少测量原理，默认脉冲型，反应釜，用连续调频波

大龙：

液位计范围已修复，反应釜改为连续调频波验收后修改。（2023-01-15）

04. 开关阀

4.1 阀门作用形式缺失（FC FO FL），开关时间要按口径选择 ，阀门泄漏等级丢失，其他多处参数丢失【已修改】

大龙：

1、阀门事故开关 FO/FC 是因为工艺条件里的数据没填，填了这边就有了。

2、其他缺失的数据已补齐，下图是新导出来的（验收用的发酵模块数据）。

4.2 开关阀的阀门材质没有按逻辑要求选择，包括高温不低于管道材质等要求（验收后修复）

大龙：

逻辑待补充。（2023-01-14）

05. 调节阀

5.1 多处参数丢失，没有开度计算缺工艺条件参数【已修复】

06. 流量计

6.1 质量流量计匹配逻辑修改【已修改】

原逻辑：

逻辑更改为：

6.2 涡街流量计匹配逻辑修改【已修改】

原逻辑：

逻辑更改为：

同理，后面参数修正时用到此逻辑的地方也需要同步修改：

6.3 转子流量计匹配逻辑修改【已修改】

修改逻辑：

6.4 电磁流量计，未体现流量条件，缺电极材质 / 接地环材质和量程，其中接地环材质和电极材质的要求，请根据选型逻辑要求【已修复】

选型逻辑

6.5 电磁流量计判断逻辑错误，逻辑上空气不可能用电磁【已修复】

选型逻辑：

大龙（2023-01-15）：目前将气体和蒸汽的默认流量计设为了旋涡流量计，已补充到二次迭代的需求里。

6.5 DN250 以上的的电磁用逻辑上应该是插入式规格【已修复】

选型逻辑：

大龙（2023-01-15）：此项修改内容已补充到仪表选型的二次迭代需求里了。

07. 其他

7.1 输出信号和电气接口尺寸 2 个字段的数据取统一规定里的数据【已修复】

导出的数据表没有统一规定要求的信号和电气接口。

原需求文档里有相关逻辑的：

7.2 仪表的防爆等级缺少设备保护等级，隔爆要加 Gb 本安要加 Ga

大龙（2023-01-15）：添加后的形式是什么样的，逻辑待补充。验收后再做。

7.3 所有的仪表缺少显示方式，应该是写 LCD【已修改】【已回测确认】

大龙补充（2023-01-15）：基础库里很多远传仪表显示方式没填 LCD 导致的，目前已补充。

7.4 过程连接规格和标准号没有对应，如法兰是 HG/T 20592 1/2「NPT 是 GB/T12716  M20X1.5 是 GB/T 193, 目前错配，或者缺少【已修改】【已回测确认】

大龙（2023-01-15）：M20x1.5 (M) 没有标准号是因为基础库里没填标准号，目前已补充。

7.5 设备上的仪表接口希望能根据设备接口核对表匹配，括号里的插入深度，法兰间距可以匹配到数据表对应的规格里【已增加】【已回测确认】

7.6 数据表中温度压力流量条件抬头有 MAX/NOR/MIN 数据表的条件应该也有 / 区分条件状态

大龙：已补充到二次迭代需求（2023-01-15）。如果工艺人员填的仅仅有 - 0.098-0.3，最小最大值有，但正常值缺信息。待确认。

7.7 数据表的一些行需要设置分行缩径，不然无法全显

大龙补充（2023-01-15）：先把上图中涉及的字段 Excel 表里格式更改为分行的，后续遇到还需要分行的再单独加。字段包括：1）用途。2）编号，即仪表所在位置。3）介质。@常恃豪

冯大龙

01. 压力表

1.1 压力表 / 压力变动器 / 差压变动器测量原件的材质没有填充基础库里的默认值【已修复】【已回测确认】

按逻辑，成品数据表里，应该先匹配基础库（ks_measure_types）里的数据作为默认值。基础库里压力表的测量元件材质都是有值的。

1.2 压力表 / 压力变动器 / 差压变动器测量原件的材质逻辑有误【已修复】

需求里的逻辑如下：

导出的成品结果如下：

1.3 过程连接尺寸的修正没有用需求里的新逻辑【已修复】

成品表导出的结果如下：

这个结果是按老版逻辑走的：

需求里的逻辑：满足条件后，是修改过程连接方式为「工字型法兰」，而不是在备注里体现。需求截图如下：

02. 温度计

2.1 判断设备自带套管的判断逻辑优化（优化项）【已修复】

原逻辑：备注（assembly_comment）包含字符串「设备带套管」。

更改为：备注（assembly_comment）包含字符串「设备带套管」或「设备自带套管」。

2.2 一体化温度变送器的输出信号和电气接口尺寸没有填充基础库里的默认值【已修复】【已回测确认】

按逻辑，成品数据表里，应该先匹配基础库（ks_measure_types）里的数据作为默认值。基础库里温度计这 2 个字段是有值的。

2.3 设备带夹套时参数修正逻辑修改（原需求文档里字段写错）【已修复】

上图中的第 2 点：传感器形式（sensor_style）更改为：卡套 M27x2 (M)。

应该是修改过程连材质（process_material），而非传感器形式（sensor_style）。同时，下面置空的字段里把过程连材质（process_material）剔除，否则又会被覆盖。

03. 液位计

3.1 液位开关没有匹配【已修复】【已回测确认】

需求文档里：

功能代号不包含 I 的集中液位计，型号直接匹配为液位开关的。

3.2 磁性液位计变送器的形式 / 输出信号 / 电气接口未匹配基础表中的数据【已修复】

基础表（ks_measure_types）需要增加液位计字段变送器形式，默认值为「干簧管」。

3.3 雷达液位计的显示方式 / 输出信号 / 电源未匹配基础表中的数据【已修复】

问题同 3.2。

3.4 差压变动器逻辑匹配有误【无需修复】

需求文档里的条件 5，要 2 个条件同时满足才是差压变送器。

输入数据如下：

匹配出来的型号有误，设备高度超了 4500 了，不应该匹配出来差压变送器。

3.5 此致伸缩液位计逻辑匹配有误【已修复】

匹配结果如下：

3.6 液位计的差压变送器参数修正有误【已修复】

需求文档里的修正参数，只是针对液位计的差压变送器修正的，压力表那边的差压变送器无需修正，现在全部修正了。

3.7 成品数据表里温度和压力的单位要剔除的【已修复】

所有类型的仪表数据表里，温度和压力都要剔除单位的。

3.8 雷达液位计压力显示不出常压并且接口尺寸没有修正【已修复】

需求文档：

输入数据：

输出数据：

问题 1：压力「常压」没有到成品表来。

问题 2：连接的规格尺寸没有修正。

04. 开关阀

4.1 阀座阀芯材质 / 阀门填料材质未匹配基础表中的数据【已修复】【已回测确认】

4.2 阀门作用形式没有数据【已修复】【已回测确认】

需求文档：

输入数据：

上图中的阀门失能位置，要填到成品表里的阀门作用形式。

输出数据：

05. 调节阀

5.1 成品表后面数据的格式有问题【已修复】

5.2 增加钢衬四氟的全名：钢衬聚四氟乙烯【已修复】

搜索代码的逻辑，所有使用钢衬四氟的地方，要兼容它的全名：钢衬聚四氟乙烯。

比如：

5.3 阀体材质 / 阀芯阀座材质 / 阀门填料材质未匹配基础表中的数据【已修复】

5.4 根据阀前阀后压差来修正阀芯阀座材质有误【无需修复】

需求文档：

输入数据：

输出数据：

06. 流程计

6.1 转子流量计型号匹配有误【已修复】

原始需求文档：

输入数据：

上面的输入数据无法命中需求里的 5 个条件的。

6.2 质量流量计型号匹配逻辑修改【已修改】

6.3 质量流量计精度没有修正【已修复】

原需求文档：

输出数据：

6.4 涡街流量计导出的 Excel 表无法打开【未提供涡街流量计模板】

6.5 未匹配到差压流量计【无需修复】【已回测确认】

需求文档如下：

输出结果如下：

6.6 未匹配到超声波流量计【已修复】【已回测】

需求文档如下：

输出结果如下：

07. 其他

7.1 导出来的临时仪表数据表文件名后缀多了一个点 @余开毅【已修复】

7.2 无某个类型仪表时，导出数据时无需提示表述修改 @余开毅

如上图所示，我选了 6 个类型的液位计导出来，可能只有 2 个液位计有数据可以导成品表，另外 4 个没数据。这种情况是正常的，只需提示哪几个液位计没数据即可，无需现在显示的「导出失败」。

李云祥

1、导出成品压力表，未能获取到数据。【已修复】@常恃豪

2、成品表位号含有 Z , 确认备注是否填充：SIL 认证。【已修复】

3、仪表部分数据未完善【已修复】

4、确认 TZG-40302 属于哪一类？【已修复】

5、assembly_comment 列填写插入深度但是后面没有跟数字，结果未 I=0，插入深度后加了数值，结果为 I = 插入深度。【已修复】

6、差压变送器的未修正。【已修复】

7、如下图，此条件满足后没有修改为涡街流量计【已修复】

8、如下图，此条件满足后没有修改为容积式流量计【已修复】

9、如下图，此条件满足后没有修改为超声波流量计【已修复】

10、两类条件相同，分类不同【已修复】

11、逻辑 3 逻辑 4 无法按要求修改【已修复】

12、超声波流量计、超声波流量计无法导出【已修复】

13、仪表临时表修改在仪表专业上传后，修改不了数据库的数据。【已修复】

14、工艺临时表中，功能代码为 TG，仪表类别为 location，但导出的仪表临时表为一体化温度变送器【已修复】

15、如下图，将测量控制点名称改为压缩空气管道开关阀后，仪表名称还是开关阀【已修复】

改为压缩空气开关阀，仪表名称可改为电磁阀。

16、阀门失能位置对应开关阀数据表的哪条数据？@冯大龙

17、导出电磁阀报错【已修复】

18、调节阀阀体材质没有填写。【已修复】

19、修改部分参数后，条件阀导出，报错。【已修复】

[20221205092700_Excel 临时仪表数据表.xlsx]

20、容积式、超声波流量计的数据表数据完善。

需要求正的逻辑

20221104 仪表选型模块汇总