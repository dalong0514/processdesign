## 20230405华雷仪表选型逻辑修改

选型根据逻辑，在数据表原有默认参数下一步步修正

01 工艺仪表条件处理

1.1 逻辑中相关字段数值来源：

1、液位范围

条件列：差压 / 流量 / 物（界）位 / 分析 / 重量 - 最大（max）和差压 / 流量 / 物（界）位 / 分析 / 重量 - 最小（min），这两个字段的差值。

2、设备高度。

尺寸规格提取字符串 [x] 或 [X] 或 [×] 后面的数字。如尺寸规格为：φ1200/1300x1200（h），那么设备高度为：1200。

3、最大操作温度

对温度 - 操作字段进行处理：

1）常温，替换为 30。

2）填写的是温度范围，提取范围里的最大值。如：15-120，或 15~120，提取的最大操作温度为：120。

4、最小操作温度

对温度 - 操作字段进行处理：

1）常温，替换为 30。

2）填写的是温度范围，提取范围里的最小值。如：-20~-10，或 -20~20，或 -20-20，提取的最小操作温度为：-20。

5、最大操作压力

对操作压力字段进行处理：

1）常压，替换为 0。

2）填写的是压力范围，提取范围里的最大值。如：0.1-0.3，或 0.1~0.3，提取的最大操作压力为：0.3。如果压力是带 kPa 单位的，如 10-15kPa 或 10~15kPa，提取的最大操作压力为：15kPa。

6. 量程比

差压 / 流量 / 物（界）位 / 分析 / 重量 - 最大（max）和差压 / 流量 / 物（界）位 / 分析 / 重量 - 最小（min），这两个字段的比值。如果 max 和 min 这两个字段，有一个为空值，那么就不走此逻辑了。

1.2 仪表数据表内直接复制工艺条件对应的相关数据

用途 / 管道 / 设备 / 编号尺寸 / 材质 / 介质 / 温度 / 压力

1.3 仪表数据表中仪表位号根据条件中回路号编写：

当集中代码为 L 时，同回路号，

当集中代码为 LP 时，仪表位号前缀为 xT-

当集中代码为 P，且仪表类型包含「温度」时，仪表位号前缀为 xE-

当集中代码为 LP，且仪表包含「液位开关」时，仪表位号前缀为 xS-

如果回路号的前缀包含字母 [Z]，那么仪表位号的第二位增加 [Z]

1.4 成品数据表与统一规定的对应数据

1、电气接口尺寸（NPT/M）

2、输出信号 (4~20Ma+Hart/FF/ 开关量)

1.5 备注

如果回路号包含字母 [Z]，那么数据表备注填充：SIL2 认证。

02. 压力表选型逻辑汇总

2.1 压力表选型类型初步分类

满足下面任意一个条件的，仪表类型匹配为 [差压变送器]，后续生成 [差压变送器] 的成品数据表。

1、回路号是 PD 或 PZD 开头的。

2、操作压力带有 kPa 单位，且前面的数值小于 15。

2.2 压力表隔膜元件判断

满足下面任意一个条件的，按带隔膜元件的压力仪表选型

1. 备注包含字符串 [高粘度]、[易结晶] 、[固体颗粒]。

2. 备注包含字符串 [腐蚀]。

3. 材质为下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、聚丙烯、聚乙烯、316L、PTFE、PFA、PP、PE 和特殊材质如钛、哈氏合金等

4 . 介质中包含常见的强腐蚀介质：氟化物、氯气 、盐酸、硫酸、氢氟酸等

2.3 压力表测量元件类型判断

带隔膜元件同时量程 MPa, 那么该字段更改为：隔膜

带隔膜元件同时量程 kPa,, 那么该字段更改为：膜片

不带隔膜元件同时量程 kPa, 那么该字段更改为：膜盒

2.4 匹配到仪表类型之后部分参数的修正

01. 所有类型仪表的参数调整

1、测量元件密封液 - 前提条件是：带隔膜元件

如果组分及名称内包含字符串 [氯气] 或 [硝酸] 或 [过氧化氢]，测量元件密封液修改为 [氟碳润滑剂]。

2、测量元件材质 - 前提条件是：带隔膜元件

如果组分及名称内包含字符串 [发烟硫酸] 或 [HF] 或 [氟化物]，测量元件材质修改为 [哈氏合金 C]。

如果组分及名称内包含字符串 [盐水] 同时不含 [冷冻盐水]，测量元件材质修改为 [钛材]。

3、测量范围

01 最大压力大于等于 0.1 的量程获取

如果压力全部为正值的情况：

步骤一：获取用于匹配量程的 [量程压力]。量程压力的获取逻辑仅与 [设计压力] 和 [操作压力] 有关。

1、如果设计压力有值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是单个值（不是一个范围），如 0.35MPa，那么取操作压力，乘以 1.5 倍获得量程压力。

3、如果设计压力为空，且操作压力是一个范围，如 0.2~0.4MPa，那么通过取操作压力范围拿到最大的压力 0.4，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

将量程压力与压力量程表匹配出最合适的量程范围中

0~0.16M/0.25M/0.4M/0.6M/1.0M/1.6M/2.5M/4.0M/6M/10M/16 M/25 M/40 M/60 M

如果压力有负值的情况：

如果压力的最大值是正值，那么走下面的逻辑。

步骤一：获取用于匹配量程的 [量程压力]。

1、如果设计压力有值且为正值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是一个范围，如 - 0.098~0.4MPa，那么通过取操作压力范围拿到最大的压力 0.4，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

最终要匹配的量程区间汇总：

"-0.1~0.06M"

"-0.1~0.15M"

"-0.1~0.3M"

"-0.1~0.5M"

"-0.1~0.9M"

"-0.1~1.5M"

"-0.1~2.4M"

02 最大压力小于 0.1 的量程获取

如果压力全部为正值的情况：

步骤一：获取用于匹配量程的 [量程压力]。逻辑完全参考压力大于 0.1 的场景。

步骤二：根据量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

最终要匹配的量程区间汇总：

"0~1.6kPa"

"0~2.5kPa"

"0~4kPa"

"0~6kPa"

"0~10kPa"

"0~16kPa"

"0~25kPa"

"0~40kPa"

如果压力全部为负值的情况：

步骤一：获取用于匹配量程的 [量程压力]。

1、如果设计压力有值且为负值，直接取设计压力，乘以 1.1 倍，即为量程压力。

2、如果设计压力为空，且操作压力是单个值且为负值（不是一个范围），如 - 0.05MPa，那么取操作压力，乘以 1.5 倍获得量程压力。

3、如果设计压力为空，且操作压力是一个范围且最大最小都为负值，如 - 0.098~-0.05MPa，那么通过取操作压力范围拿到最左侧最大的负值，如举例中的 - 0.098，然后乘以 1.1 倍获得量程压力。

步骤二：根据量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

最终要匹配的量程区间汇总：

"-1.6~0kPa"

"-2.5~0kPa"

"-4~0kPa"

"-6~0kPa"

"-10~0kPa"

"-16~0kPa"

"-25~0kPa"

"-40~0kPa"

如果压力既有正值又有负值的情况：

步骤一：获取用于匹配量程的 [量程压力]。此时要分别拿到正值的量程压力和负值的量程压力，分别取匹配量程范围的最小值和最大值。

符合这种情况的时候，操作压力肯定是一个范围值，最小值是负值，最大值是正值。

如 - 0.098~0.2MPa，取最小值（负值）乘以 1.1 获取负值的量程压力；取最大值（正值）乘以 1.1 获取正值的量程压力。

步骤二：根据负值量程压力和正值量程压力匹配量程。

现在的量程压力的单位是 MPa，需要先转为 kPa，然后再去匹配量程区间。

负值量程压力和正值量程压力，取绝对值大的取匹配量程。

最终要匹配的量程区间汇总：

"-0.8~0.8kPa"

"-1.2~1.2kPa"

"-2~2kPa"

"-3~3kPa"

"-5~5kPa"

"-8~8kPa"

"-12~12kPa"

"-20~20kPa"

02. 隔膜压力表 / 隔膜抗震压力表 / 膜片压力表的参数调整

1、过程连接相关参数的调整

所在管线或设备是管道，根据管道编号的形式来判断，如上图所示。

步骤一：根据管道编号获取管径。如上图中的 FN340603-15-2F1，获取管径为 15。

步骤二：如果管径小于 25。

1）过程连接规格更改为：20-16RF。

2）过程连接方式更改为：工字型法兰。

03. 不锈钢压力表 / 不锈钢抗震压力表 / 膜盒压力表的参数调整

1、过程连接相关参数的调整

如果所在管线或设备是管道，根据管道编号的形式来判断。

步骤一：根据管道编号获取管径。如上图中的 FN340603-10-2F1，获取管径为 10。

步骤二：如果管径小于 15。

1）过程连接规格更改为：M14x1.5 (M)。

2）表头直径更改为：60。

3）精度更改为：2.5。

如果仪表用途为：消防泵试验压力。那么，

1）表头直径更改为：150。

2）精度更改为 0.4。

备注：此修正的优先级比所在位置是管道且管径小于 15 的优先级更高。

04. 压力变送器的参数调整

1、安装方式及精度修正

如果操作压力带有 kPa 单位，且前面的数值小于等于 20，那么：1）安装方式（更改为：引远安装。2）精度更改为：±0.055。

2、测量元件形式

备注：以下条件逻辑的优先级依次增高。

逻辑 1：参考就地压力表那边的逻辑判断隔离元件的形式是：隔膜、膜片、膜盒中的一个。

如果匹配出来的是隔膜压力表，那么该字段更改为：隔膜。

如果匹配出来的是膜片压力表，那么该字段更改为：膜片。

如果匹配出来的是膜盒压力表，那么该字段更改为：膜盒。

3、隔膜压力表相关参数的修正

对于压力变送器和差压变送器，如果测量元件形式为 [隔膜]，那么：

1、密封液字段更改为：硅油

2、测量元件连接该字段更改为：直接连接

3、过程连方式该字段更改为：法兰

4、过程连标准 ', 该字段更改为：HG/T20592

5、 过程连规格 ', 该字段更改为：50-16RF

05. 就地压力表的参数调整

1、备注修正

如果就地压力表的仪表用途包含字符串：爆破片出口。那么，备注更改为：带高限压力记忆指示功能。

03. 温度计选型逻辑汇总

3.1 温度计类型匹配逻辑

就地温度计最终匹配出来的仪表类型汇总：双金属温度计、液体压力式温度计。

集中温度计最终匹配出来的仪表类型为：一体化温度变送器、热电阻、热电偶。

1.1 就地温度计类型匹配

如果回路号是 TG，说明此仪表为就地温度计，仪表名称直接设为：双金属温度计。

1.2 远传温度计类型匹配

如果回路号不是 TG，说明此仪表为远传温度计，TT - 为：一体化温度变送器。TE - 为热电阻、热电偶。

3.2 匹配到仪表类型之后部分参数的修正

01. 双金属温度计的参数调整

1、套管插入深度

如果所在管线或设备是管道，根据管道编号的形式来判断

步骤一：根据管道编号获取管径。如上图中的 FN340603-65-2F1，获取管径为 65。当管径小于 100，备注：管径扩径至 DN100, 套管插入深度赋值为：U=200

步骤二：如果所在管线或设备不是管道。

如果备注不包含字符串 [插入深度] 直接返回为空。如果包含，那么取紧跟着 [插入深度] 后的数字，举例，插入深度 600mm，那么取值 600。然后将数字拼接为字符串 [U=600]。

2、套管材质

如果测量介质为腐蚀性介质，那么修正为：钢衬四氟。符合如下任何一个条件的即为腐蚀性介质：1）备注包含字符串 [腐蚀]。2）仪表条件表中，材质为下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯、PTFE、PFA、PP、PE。

3、套管相关的其他参数

备注包含字符串 [设备带套管]。

进行如下操作：1）套管型号更改为：设备带套管。2）传感器形式更改为：卡套 M27x2 (M)。3）套管形式、套管材质、套管直径、过程连接方式、过程连接材质、过程连接规格，上述字段全部置为空。

02. 一体化温度变送器的参数调整

1、套管插入深度

完全参考双金属温度计参数调整的逻辑。

2、套管材质

完全参考双金属温度计参数调整的逻辑。

3、套管相关的其他参数

完全参考双金属温度计参数调整的逻辑。

4、分度号

如果温度 - 操作大于 600，或者仪表用途包含字符串 [泵出口]、[风机出口]。那么：分度号更改为：K。

03. 测量范围获取逻辑

如果温度全部为正值的情况：

步骤一：获取用于匹配量程的 [量程温度]。量程温度的获取逻辑仅与 [操作温度] 有关。

1、如果操作温度是单个值（不是一个范围），如 25，那么取操作温度乘以 1.5 倍获得量程温度。

2、如果操作温度是一个范围，如 28~121，那么通过取操作温度范围拿到最大的温度 121，然后乘以 1.1 倍获得量程温度。

步骤二：根据量程温度匹配量程（测量范围）。

量程温度往上靠量程区间，如量程温度是 140，那么匹配出来的量程区间为：0~150。

最终要匹配的量程区间（测量范围）汇总：

0~50

0~100

0~150

0~200

0~300

0~400

0~500

0~600

0~700

0~800

3. 当操作温度在 0~5 之间，温度量程定为 - 40~80℃

如果温度有负值的情况：

1、如果操作温度是单个值且为负值（不是一个范围），如 - 15，那么取操作温度除以 0.5 获得量程温度为 - 30。

2、如果操作温度是一个范围，如 - 15~10，那么通过取操作温度范围拿到最左侧最大的负值，如举例中的 - 15，然后除以 0.9 获得量程温度。

如 - 15~10，获得的量程温度为：-17。

步骤二：根据量程温度匹配量程（测量范围）。

量程温度往大了靠量程区间，如量程温度是 - 17，那么匹配出来的量程区间为：-40~80。

最终要匹配的量程区间（测量范围）汇总：

-80~40

-40~80

04. 液位计选型逻辑汇总

4.1 液位计类型匹配逻辑

就地液位计最终匹配出来的仪表类型汇总：磁性液位计、玻璃板液位计。

集中液位计最终匹配出来的仪表类型汇总：液位开关、差压变送器、雷达液位计、伺服液位计、超声波液位计、电浮筒液位计、磁致伸缩液位计。

备注：液位范围，是公用逻辑中处理后得到的字段。

1.1 就地液位计类型匹配

如果回路号是 LG，说明此仪表为就地液位计。

仪表名称默认设为：磁性液位计。

如果同时满足下面 2 个条件的话，更改为：玻璃板液位计。

1）如果备注包含字符串 [玻璃板]。

2）液位范围小于等于 2000。

1.2 集中液位计类型匹配

如果回路号不是 LG，说明此仪表为远传液位计。

首先看回路号里是否含有字符串 [I]，如果包含，那么仪表名称默认设为：磁性液位计。否则，仪表名称设为：液位开关。

满足下面任何一个条件的，仪表名称更改为：差压变送器。

条件 1：备注包含字符串 [压差液位计] 或 [差压液位计]。

条件 2：最大操作温度大于 250。

条件 3：回路号中包含字符串 [C] 且液位范围大于 1000 小于 10000。

条件 4：备注包含字符串 [高粘度]、[易结晶]。

满足下面任何一个条件的，仪表名称更改为：雷达液位计。

条件 1：备注包含字符串 [雷达] 或 [顶插]。

条件 2：测量控制点名称（包含字符串 [水池液位]、[计量罐]、[反应釜液位]。

条件 3：设备高度大于 10000。

满足下面任何一个条件的，仪表名称更改为：电浮筒液位计。

条件 1：备注包含字符串 [电浮筒液位计]。

条件 2：设备高度小于 1000。

条件 3：备注包含字符串 [易汽化] 或 [宜汽化]。

满足下面任何一个条件的，仪表名称更改为：磁致伸缩液位计。

条件 1：备注包含字符串 [磁致伸缩]。

条件 2：回路号中包含字符串 [C] 且液位范围小于等于 1000。

4.2 填充仪表数据表初版数据

填充直接来自工艺条件的参数，见 1.2 仪表数据表内直接复制工艺相关数据

4.3 匹配到仪表类型之后部分参数的修正

01. 磁性液位计的参数调整

1、指示器触液材质

如果测量介质为腐蚀性介质，那么更改为：钢衬四氟。

符合如下任何一个条件的即为腐蚀性介质：1）备注包含字符串 [腐蚀]。2）仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯、PTFE、PFA、PP、PE。

02. 液位开关的参数调整

1、探头材质

如果测量介质为腐蚀性介质，那么更改为：钢衬四氟。

符合如下任何一个条件的即为腐蚀性介质：1）备注包含字符串 [腐蚀]。2）仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯、PTFE、PFA、PP、PE。

03. 雷达液位计的参数调整

1、过程连接规格

如果操作压力为：常压，那么更改为：100-16RF。

2、指示器触液材质

如果测量介质为腐蚀性介质，那么更改为：PTFE。

符合如下任何一个条件的即为腐蚀性介质：1）备注包含字符串 [腐蚀]。2）仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯、PTFE、PFA、PP、PE。

04. 差压变送器的参数调整

1、安装方式

更改为：

毛细管：LP:5mxHP:5m

2、附件

更改为：配不锈钢支架。

05. 开关阀选型逻辑汇总

5.1 阀门类型匹配逻辑

最终匹配出来的阀门类型汇总：开关阀、电磁阀。

仪表名称默认设为：开关阀。测量控制点名称（包含字符串 [压缩空气开关阀] 或 [压缩空气管道开关阀]，那么仪表名称更改为：电磁阀。

5.2 填充仪表数据表初版数据

01. 开关阀的参数调整

1、过程连接规格

开关阀所在管线或设备肯定是管道，根据管道编号获取管径。如上图中的 FN340603-65-2F1，获取管径为 65。那么过程连接规格更改为：65-16RF。

2、阀芯阀座材质

最大操作温度大于 100 且小于等于 180，那么更改为：304/RPTFE。

3、阀体填料材质

满足下面任意一个条件的话，那么更改为：柔性石墨。

1）最大操作温度大于 200。

2）最小操作温度小于 - 35。

3）组分及名称内包含字符串 [蒸汽] 或 [导热油]。

4）温度、压力线在阴影部分外

4、阀门失能位置

直接取仪表条件表里的阀门失能位置。

5、阀体形式仪表条件表

默认为 O 型球阀，如果仪表条件表备注有上展式釜底阀，改为上展式釜底阀，如果阀门口径大于 200，那么更改为：双偏心蝶阀。

如果仪表条件表备注有卫生型，改为卫生型隔膜阀

6、执行机构关闭时间仪表条件表

1、首先判断是否为 SIS 仪表。是否是 SIS 仪表前面逻辑做过，直接调用。

判断逻辑：回路号包含字母 [Z] 即为 SIS 仪表。

如果为 SIS 仪表，该字段直接设为：≤10s

2、如果不是 SIS 仪表，需要根据管径来匹配。

开关阀所在管线或设备肯定是管道，根据管道编号获取管径。如 FN340603-65-2F1，获取管径为 65。（这个逻辑之前很多地方用到，直接调用）

管径与执行机构关闭时间的对应关系汇总如下：

25：≤2s

40：≤2s

50：≤5s

65：≤5s

80：≤5s

100：≤10s

125：≤10s

150：≤20s

200：≤20s

250：≤20s

300：≤25s

400：≤40s

500：≤40s

600：≤50s

1000：≤60s

7、阀门附件修改

直接取仪表条件表里的阀门失能位置。

回路号包含字母 [Z] 即为 SIS 阀门。电磁阀 - 工作电压修改为【24VDC (3.7W) , 耐高温（H 级）绝缘线圈，长期励磁型】

阀门失能位置为 FL 时，电磁阀 - 形式改为【二位五通 / 单电控 / 电开】

06. 调节阀选型逻辑汇总

6.1 阀门类型匹配逻辑

仪表名称默认设为：调节阀。

6.2 填充仪表数据表初版数据

填充直接来自工艺条件的参数，见 1.2 仪表数据表内直接复制工艺相关数据

6.3 匹配到仪表类型之后部分参数的修正

1、过程连接规格

等同开关阀那边的逻辑。

2、阀体形式仪表条件表

备注：以下条件逻辑的优先级依次增高。

条件逻辑 1：符合下面任何一个条件的，那么更改为：波纹管密封单座。

1、仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯。

2、组分及名称内包含字符串 [HF] 或 [氟化氢]。

3、组分及名称内包含字符串 [NH3] 或 [氨气] 或 [H2S] 或 [硫化氢] 或 [导热油] 或备注里标注【剧毒】。

4、操作压力有值，且小于 0.1。

条件逻辑 2：所在管道为夹套管，那么更改为：偏心旋转阀。夹套管的获取逻辑：所在管道的编号形式与工艺专业的自定义管道编号里夹套管的编号形式相同。

3、阀体波纹管材质

备注 1：以下 if 条件逻辑的优先级依次增高。备注 2：此字段，默认为空，只在阀体形式仪表条件表字段更改为 [波纹管密封单座] 才会走下面的逻辑赋值。

1、仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯。此字段更改为：PTFE。

2、当管道材质为金属，且组分及名称内包含字符串 [HF] 或 [氟化氢]。此字段更改为：PTFE。

3、组分及名称内包含字符串 [NH3] 或 [氨气] 或 [H2S] 或 [硫化氢] 或 [导热油]。此字段更改为：S30408。

4、阀体材质仪表条件表

备注：以下 if 条件逻辑的优先级依次增高。

1、仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯、PTFE、PFA、PP、PE。此字段更改为：WCB+F46。

2、组分及名称内包含字符串 [HF] 或 [氟化氢]。此字段更改为：S31603。

5、阀芯阀座材质

备注：以下 if 条件逻辑的优先级依次增高。

1、仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯。此字段更改为：304+F46。

2、组分及名称内包含字符串 [HF] 或 [氟化氢]。此字段更改为：S31603。

3、组分及名称内包含字符串 [蒸汽]。此字段更改为：S304+ST。

4、阀前阀后压差大于 1.5。此字段更改为：S304+ST。阀前阀后压差的获取逻辑：仪表仪表条件表里，阀前压力字段和阀后压力字段的差值。

6、阀体填料材质

满足下面任意一个条件的话，那么更改为：柔性石墨。

1）最大操作温度大于 200。

2）最小操作温度小于 - 35。

3）组分及名称内包含字符串 [蒸汽] 或 [导热油]。

4）管道等级号的首个数字大于等于 4。管道等级号的获取逻辑：开关阀所在管线或设备肯定是管道，根据管道编号结合工艺专业那边的自定义管道编号形式，获取管道等级号。如管道号 FN340603-65-4J1，管道等级号为 4J1，管道等级号的首个数字为 4。

7、备注

备注：以下 if 条件逻辑的优先级依次增高。

1、最小操作温度小于 -20。1）如果此字段为空值。此字段更改为：低温型。1）如果此字段有值，如为：SIL 认证。那么此字段需要在原值后面拼接字符串 [；低温型]，更改为：[SIL 认证；低温型]。

2、最大操作温度大于 220。1）如果此字段为空值。此字段更改为：高温型。1）如果此字段有值，如为：SIL 认证。那么此字段需要在原值后面拼接字符串 [；高温型]，更改为：[SIL 认证；高温型]。

备注：因为在前面的逻辑 [01. 所有类型仪表共用逻辑汇总> 1.2 成品数据表内工艺相关数据填充] 会对备注字段进行处理，如果回路号包含字母 [Z]，那么备注填充：SIL 认证。所以备注字段此时可能有值，有值的话不能被覆盖掉，所以有值和空值的情况分开考虑。

6.4. 公称流通能力相关值的获取逻辑

2.1 最大阀门 Cv 值和正常阀门 Cv 值计算

看组装相态是液体、蒸汽、气体 3 种情况：

如果 [组装相态] 是 [液态] 或 [L]，那么：

Cv=Q*1.17*SQRT(ρ/((P1-P2)*10*1000))

Q：最大流量或者正常流量，字段 [max] 和 [nomal]

P1：最大 / 正常 / 最小流量时绝压 (MPaA)- 阀前压力

P2：最大 / 正常 / 最小流量时绝压 (MPaA)- 阀后压力

ρ：密度仪表条件表

t：温度 - 操作

如果 [组装相态] 是 [汽态] 或 [S]，那么：

如果 P1<2P2

如果 P1≥2P2

备注：过热温度先按 0 考虑，后续再补充查表的逻辑。

如果 [组装相态] 是 [气态] 或 [G]，那么：

如果 P1<2P2

如果 P1≥2P2

通过上面的计算公式，使用最大流量算出来的是最大阀门 Cv 值，使用正常流量算出来的是正常阀门 Cv 值。

最大阀门 Cv 值和正常阀门 Cv 值，填到数据库表里的下面位置，举例：26.63/38.89。

2.2 计算最大和正常阀门开度

1、获得计算可调比 R

如果阀体形式仪表条件表包含 [单座]，那么取值 50，否则取值 100。

2、查表获得公称流通能力。

通过：1）调节阀所在管道尺寸（很多地方用到此逻辑，如开关阀所在管道的尺寸）；2）阀体形式仪表条件表。这 2 个数据查表调节阀公称流通能力（ks_valve_rated_Cv） 获得公称流通能力。

[ks_valve_rated_Cv.xlsx]

通过计算最大阀门开度校验公称流通能力。

最大阀门开度计算：

LOG：数学上的对数，以 10 为底。

公称流通能力：查表获得的。

Cv：前面逻辑计算获得的最大阀门 Cv 值。

如果算出的最大阀门开度在 0.7-0.9 之间，满足条件终止。

如果算出的最大阀门开度小于 0.7，那么查表的时候缩小一档，缩档后还是无法满足小于 0.7，那么取最后一档的值。

如果算出的最大阀门开度大于 0.9，取算出来值。（后续逻辑迭代）

公称流通能力确定后，还是用同样的公式计算正常阀门开度计算：

LOG：数学上的对数，以 10 为底。

公称流通能力：前一步确定的。

Cv：前面逻辑计算获得的正常阀门 Cv 值。

最大阀门开度和正常阀门开度，需将小数转为百分比，如 0.84 转化为 84%，填到数据库表里的下面位置，举例：62%/84%。

07. 流量计选型逻辑汇总

7.1 流量计类型匹配逻辑

就地流量计最终匹配出来的仪表类型汇总：转子流量计、水表。

集中流量计最终匹配出来的仪表类型汇总：电磁流量计、转子流量计、质量流量计、涡街流量计、旋涡流量计、容积式流量计、差压流量计、超声波流量计。

1.1 就地流量计类型匹配

仪表类型仪表条件表为流量，且仪表类别为：L，那么此仪表为就地流量计。

仪表名称默认设为：转子流量计。

如果回路号为：FQ，那么更改为：水表。

1.2 集中流量计类型匹配

除就地流量计以外的流量计均为远传量计。

那么仪表名称默认设为：电磁流量计。但如果 [组装相态] 是 [液态] 或 [L]，那么默认流量类型是电磁流量计，否则默认的流量类型为旋涡流量计。

满足下面任何一个条件的，仪表名称更改为：质量流量计。

条件 1：备注包含字符串 [质量流量计]。

条件 2：组分及名称内包含字符串 [氢气] 或 [一氧化碳]。

满足下面任何一个条件的，仪表名称更改为：涡街流量计。

条件 1：组分及名称内包含字符串 [天然气]。

条件 2：1）所在管道为碳钢 / 不锈钢。2）同时，所在管道的管径小于 250。3）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值大于等于 20，且工作压力仪表条件表的值大于 0.1。

条件 3：1）组分及名称内包含字符串 [蒸汽] 2）同时，所在管道的管径小于等于 250。

满足下面任何一个条件的，仪表名称更改为：涡轮流量计。

条件 1：备注包含字符串 [涡轮流量计]。

条件 2：组分及名称内包含字符串 [天然气]。

满足下面任何一个条件的，仪表名称更改为：差压式流量计。

条件 1：备注包含字符串 [差压式流量计]。

条件 2：1）组分及名称内包含字符串 [蒸汽]。2）同时，所在管道的管径大于 250。

满足下面任何一个条件的，仪表名称更改为：容积式流量计。

条件 1：备注包含字符串 [容积式流量计]。

条件 2：备注包含字符串 [高粘度] 同时量程比小于等于 10。

满足下面任何一个条件的，仪表名称更改为：超声波流量计。

条件 1：备注包含字符串 [超声波流量计]。

条件 2：1）备注包含字符串 [高粘度]。2）同时，量程比大于 10。

条件 3：1）所在管道为金属。2）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，量程比大于 10。

条件 4：1）所在管道为金属。2）同时，所在管道的管径大于等于 800。3）介质为水

满足下面任何一个条件的，仪表名称更改为：转子流量计。

条件 1：备注包含字符串 [转子流量计]。

条件 2：1）所在管道为非金属管道或耐腐蚀金属；2）同时，状态仪表条件表为字符串 [液态] 或 [液相] 或 [L]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值小于 1。

条件 3：1）所在管道为非金属管道或耐腐蚀金属；2）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，量程比小于 10。

条件 4：1）所在管道为碳钢 / 不锈钢。2）同时，所在管道的管径小于 100。3）同时，状态仪表条件表为字符串 [液态] 或 [液相] 或 [L]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值小于 1 或者工作压力仪表条件表的值小于 0.1。

条件 5：1）所在管道为碳钢 / 不锈钢。2）同时，所在管道的管径小于 100。3）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值小于 20，且工作压力仪表条件表带有单位 kPa，值大于 10。

满足下面任何一个条件的，仪表名称更改为：电磁流量计。

条件 1：备注包含字符串 [电磁流量计]。

条件 2：所测量的介质导电。介质导电的判断逻辑：组分及名称内包含字符串 [循环水]、[冷却水]、[自来水]。

条件 3：1）所在管道为非金属管道或耐腐蚀金属；2）同时，状态仪表条件表为字符串 [液态] 或 [液相] 或 [L]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值大于等于 1；4）同时工作压力仪表条件表的值大于 0.1。

7.2 填充仪表数据表初版数据

填充直接来自工艺条件的参数，见 1.2 仪表数据表内直接复制工艺相关数据

7.3 匹配到仪表类型之后部分参数的修正

00. 所有流量计的参数调整（除转子流量计之外）

1、测量范围

步骤一：获取量程流量。

流量 1：正常流量（nomal）乘以 1.5 倍。

流量 2：最大流量（nomal）乘以 1.12 倍。

比较流量 1 和流量 2 哪个大，大的即为量程流量。

步骤二：圆整量程流量。

小于等于 10 的，往上取整数。如 8.3 取整为 9。 大于 10 小于等于 1000 的，往上取整为 5 的倍数。如 123 取整为 125。 大于 1000 的，往上取整为 50 的倍数。如 1243 取整为 1250。

步骤二：获得测量范围。

测量范围：0~ 圆整量程流量。

如圆整量程流量为 1250，那么测量范围为：0~1250。

01. 质量流量计的参数调整

1、精度

如果组分及名称内包含字符串 [氢气] 或 [一氧化碳]，那么更改为：1。

2、测量元件材质

所在管道为非金属管道或耐腐蚀金属，那么更改为：哈氏合金 C。

02. 涡街流量计的参数调整

1、备注

备注：以下条件逻辑的优先级依次增高。

符合条件逻辑 1，那么更改为：一体化压力补偿。

条件逻辑 1：1）所在管道为碳钢 / 不锈钢。2）同时，所在管道的管径小于 250。3）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值大于等于 20，且工作压力仪表条件表的值大于 0.1。

符合条件逻辑 2，那么更改为：一体化温度压力补偿。

条件逻辑 2：1）组分及名称内包含字符串 [蒸汽] 2）同时，所在管道的管径小于等于 250。

3、过程连接规格

根据所在管道编号获取管径，再缩小一档。如 FN340603-65-2F1，获取管径为 65，缩小一档为 50。那么过程连接规格更改为：50-16RF。

备注：管径缩档的逻辑详见发酵模块那边匹配管径时写的逻辑。

02. 涡轮流量计的参数调整

1、精度

更改为：0.5% of reading。

03. 电磁流量计的参数调整

1、过程连接规格

根据所在管道编号获取管径。如 FN340603-65-2F1，获取管径为 65。那么过程连接规格更改为：65-16RF。

2、电极材质、接地环材质

备注：以下条件逻辑只要匹配到一个直接跳出。

符合条件逻辑 1 或条件逻辑 2，那么电极材质、接地环材质更改为：哈氏合金 C。

条件逻辑 1：所在管道为非金属材质。

管道为非金属材质的判断逻辑：仪表条件表中，材质含下面任意一个的：钢衬四氟、搪玻璃、玻璃钢、聚丙烯、增强聚丙烯、聚乙烯、钢衬聚乙烯。

条件逻辑 2：1）所在管道为碳钢 / 不锈钢。2）同时，组分及名称内包含字符串 [浓硫酸]。

符合条件逻辑 3，那么电极材质、接地环材质更改为：Ta。

条件逻辑 3：1）所在管道为碳钢 / 不锈钢。2）同时，组分及名称内包含字符串 [浓硝酸]。

符合条件逻辑 4，那么电极材质更改为：哈氏合金 C。接地环材质更改为：N/A。

条件逻辑 4：1）所在管道为碳钢 / 不锈钢。2）同时，组分及名称内包含字符串 [Cl-]、[NaCl]、[氯离子]、[氯化钠]。

3、电磁流量计口径大于 250 时的参数调整

如果流量计所在管道的尺寸大于 250，那么：1）村里材质更改为：聚醛树脂（探头绝缘环）。2）过程标准置为空值。3）过程规格更改为：插入式。4）精度更改为：2.5。2）附件更改为：焊接套管、球阀。

04. 转子流量计的参数调整

1、附件

备注：以下条件逻辑的优先级依次增高。

符合条件逻辑 1，那么更改为：气阻尼。

条件逻辑 1：1）所在管道为碳钢 / 不锈钢。2）同时，所在管道的管径小于 800。3）同时，状态仪表条件表为字符串 [气态] 或 [气相] 或 [G]；3）同时，差压 / 流量 / 物（界）位 / 分析 / 重量 - 正常（nomal）字段的值小于 20，且工作压力仪表条件表带有单位 kPa，值大于 10。

2、转子流量计材质

转子流量计材质按 S30408 S31608 S31603 钛钢衬四氟选择，材质不低于管道材质，这个可以人工选择

3. 转子流量计的计算

转子流量计的口径和量程等参数计算通过自动计算数据表实现

05. 差压式流量计的参数调整

符合条件逻辑 1，那么备注增加：一体化温度压力补偿。附件增加：带冷凝器

条件逻辑 1：1）组分及名称内包含字符串 [蒸汽]。

符合条件逻辑 2，那么备注增加：一体化压力补偿。

条件逻辑 2：1）组分及名称内包含字符串 [空气]、[氮气]