## 工艺专业使用说明

## 流程图相关说明
 
## 01. 自动编号（贡献者汪晨、叶旭峰、郑飞宏）

V2.3 新增：算法改进，以前不按图号编号模式只能一整行一整行的编。此版本实现了所有数据全部一起编号，注意：必须先用「一键更新流程数据图号」功能，后台是根据图号顺序划分数据的。

V2.2 新增：所有管道、设备、仪表的自动编号，之前的排序逻辑只支持「先左右再上下」，新增「先上下再左右」的排序选项。

V1.2 版本新增了强化本自动编号操作，基本可以舍弃老版编号了。

1、点击数据流工具栏里的「加强版自动编号V2」。选择自动编号的三大类数据：管道、仪表和设备位号。

2、管道和设备编号支持常规编号、按流程图编号。仪表编号支持常规编号、按流程图编号和按设备位号编号（前提条件：设备上的仪表其所在位置要填号设备位号；管道上的仪表其所在位置要填号管道号并且管道的来去向要填好设备位号信息）。

3、编号前缀的信息是嵌入在「代号」和「编号」之间的信息。

以管道编号为例：主物料代号 PL 正常编号是 PL01、PL02、PL03、PL04....，那么我想把单项号「02」嵌入进去，编号前缀填「02」后编出来的是 PL0201、PL0202、PL0203、PL0204....。

详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-03.gif)

## 02. 批量修改数据（贡献者曾涵卫）

### 2.1 新版批量修改数据

V2.3 新增：导出临时 Excel 文件界面简化并增加框选数据功能。以前只能导全部数据，现在可以框选只导出部分数据。

基本的操作逻辑：CAD 中精确筛选出要修改的数据 => 导入到 Excel 临时文件 => 批量修改后反导回 CAD。

以批量修改管道数据为例，仪表数据与设备数据同理。具体操作：

1、点击数据流菜单里的「数据提取 => 导出数据流临时 excel」或者直接在工具栏里找到「导出数据流临时 excel」。

2、点击导出数据。看到导出临时文件状态变为「已完成」后，系统会自动在 D 盘的「dataflowcad」文件夹下的「data」文件夹里，自动生成管道的 excel 数据文件。管道数据为：pipeData.csv，仪表的数据为：instrumentData.csv、设备的数据为各类设备的英文名文件。

3、打开文件后，在 excel 里输入、修改数据。Excel 常规的所有操作均可在该文件实施，比如做筛选、排序等等。

4、导入数据。Excel 临时文件修改数据后，点「导入数据」，导入临时文件状态变为「已完成」后，系统会自动读取刚刚的 Excel 临时文件。

5、确认修改。点击「确认修改」，修改状态变为「已完成」后表明数据已反写回 CAD。

备注：1）做安全专篇的设备表时，可以直接从设备 Excel 临时文件里拷。2）做安全专篇所需的仪表点位信息可以从仪表 Excel 临时文件里拷。

![](http://192.168.1.38:8081/Images/V1.0-13.png)

## 03. 自动生成流程图下的一排设备位号（贡献者陈李荔）

首先确保自己的流程图中含有「设备位号」属性块。具体操作：1）点击数据流菜单里的「自动生成设备位号」。2）框选该张流程图里的所有设备块。3）空格键后，选择一个插入位置即可自动生成。

V2.2 新增：先一键更新数据的图号信息，确保每个设备位号中填有图号后，点击工具栏「流程-设备位号 => 一键生成流程图底部设备位号」或者菜单栏「设备位号生成 => 一键生成流程图底部设备位号」。并且后续设备位号修改后支持一键更新。

## 04. 图签自动编号，自动提取图号刷数据（贡献者王禹谋、张坤）

V2.1 新增：支持多行多列同时自动编图号。新功能使用的前提：同一行的所有图签必须放在一个水平方向（Y 轴定位必须一样）。

流程图图签自动编号，从图签自动提取图号，刷这张图里所有数据的「所在图号」属性。具体操作：

1、点击数据流菜单里的「自动编图签图号」。

2、点「选择图签」框选一排流程图的图签（目前只能一排一排的编号），比如示例图里选框了 11 张流程图图签，会自动提取目前图签里已有的图号数据。

![](http://192.168.1.38:8081/Images/V1.1-01.png)

3、输入图号的前面内容，比如 `S19A51-02-04-`，输入起始编号数字。起始编号如果小于 10 系统会自动在前面补上 0，如果从第一张流程开始编，填 1 或者 01 都可以。点「预览编号」，确认无误后点「确认编号」，编号状态显示「已完成」后，数据即写入了流程图图签。

![](http://192.168.1.38:8081/Images/V1.1-02.png)

## 05. 刷图纸里管道、仪表、设备所在图号的数据

V2.1 新增：一键更新流程里所有设备块、管道块、仪表块所在图号信息。所在工具栏：流程-数据修改；所在菜单：数据修改 => 一键更新流程数据图号。

旧版：

点击「刷数据所在图号」，选取一个图签后空格，CAD 命令栏下会显示出你提取到的该图签图号，接着按提示选择整张图纸的数据。刷完数据后会自动返回到交互界面，左下角会显示刷完的状态以及所刷数据的数量。接着点「刷数据所在图号」继续刷下一张图的数据。

![](http://192.168.1.38:8081/Images/V1.1-03.png)

具体操作详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-02.gif)

## 06. 批量刷仪表「所在位置」数据

V2.2 新增：刷仪表所在位置后，仪表块与设备位号块做了数据绑定，设备位号信息更改后支持一键更新。

具体操作（V2.0 版本做了改进）：

1、点击数据流菜单里的「刷仪表所在位置」或工具栏里的命令。

2、按 CAD 命令栏的提示选择一个设备（或管道）以及所要刷的仪表。空格完后，系统会将你选择的位置（设备或管道）批量写到所选仪表块里的「所在位置」。

## 07. 批量刷管道的起点和终点数据

具体操作：

1、点击数据流菜单里的「刷管道起点和终点」。

2、按 CAD 命令栏的提示，1）选择管道起点，设备和管道均可选择。如果直接空格表示不修改管道起点，此场景针对于刷共用工程的管道，设备端的在 CAD 端刷，总管端的请在 excel 里批量改。2）选择管道终点。3）选择要刷的管道，可批量选择。直接空格后，系统会将你选择的起点和终点批量写进要修改的管道块里。

备注：V2.0 版本新增了只刷管道起点或终点的命令。刷设备上公用工程管道起点终点信息的一个技巧：先不管设备是在起点还是终点上，批量把管道的起点都刷成该设备位号。最后刷完后在临时 Excel 文件那边修改公用工程的起点是设备端还是终点是设备端。

## 08. 批量刷属性块内的数据

### 命令版

1、点击数据流菜单里的「数据修改 => 命令版刷块属性」。

2、选择要提取的数据块，只能选择一个块。

3、选择要刷的数据块，可多选，且可选到不同类型的任意块。

后台自动匹配与源数据块内属性值字段相同的数据，并将源数据块内的属性值刷给所选块。

### 界面版

针对一些可复用的数据（工作介质、温度、压力等），可提取所选择块内的数据，批量刷到其他块内。具体操作：

1、点击数据流菜单里的「数据修改 => 界面版刷块属性」。

2、选择要刷的数据大类：全部数据、仪表和管道、管道、仪表、设备。

3、选择要提取的数据，可按住 ctrl 键多选（跟 office 常规操作一样）。

4、在 CAD 图纸里选择要提取数据的块后，面板里会显示出所提取到的真实数据。接着选择要刷的块，系统会自动将提取的数据刷到所选择的块内。

![](http://192.168.1.38:8081/Images/V1.1-05.png)

## 09. 自动生成辅助流程组件（贡献者叶旭峰）

大家可以看到，画辅助流程所需的几个关键信息（管子所在图号、管子所接设备以及设备位号），前面的管道块内都有这些数据，那么辅助流程的组件即可自动生成。具体操作：

1、首先将模板里的「辅助流程组件」块拷到自己的流程图里。点击数据流菜单里的「自动生成辅助流程」。

2、选择自总管（比如氮气管），或者去总管（比如放空管）。

3、通过通配符筛选要生成的辅助流程管道，比如 `N*` 筛出氮气管道。接着点「选择插入点」，在图纸里即可自动生成辅助流程组件。

![](http://192.168.1.38:8081/Images/V1.1-06.png)

![](http://192.168.1.38:8081/Images/V1.1-07.png)

## 10. 自动生成跨流程图的接图小箭头，并一键更新

V2.3 新增：支持批量生成接图箭头，比如泵出口的多根管道（贡献者叶旭峰）。

点击数据流菜单里的「自动生成接图箭头」，具体操作详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-04.gif)

作为数据源的管道数据更改后，只需使用数据流菜单里的「一键更新接图箭头」，即可同步更新数据。

## 11. 管道变等级变管径

1、点击数据流菜单里的「流程图辅助 => 刷变等级号信息」，或者直接用工具栏里的命令。

2、按 CAD 底部的提示，选择「变等级块」以及想要刷的管道（可多选）。空格后变等级号信息即被刷进管道块内，同一根管道导出的数据表会生成 2 个数据。

刷变管径信息同理，「流程图辅助 => 刷变管径信息」，或者直接用工具栏里的命令。

![](http://192.168.1.38:8081/Images/V1.3-01.gif)

## 12. 仪表自动拼接仪表控制点名称

仪表块的控制点名称属性（NAME）是可以自动拼接的。

### 常规逻辑

1、仪表块的 NAME 属性，你如果填的话，后台导出来的仪表条件以你填的为准。

2、如果空着的话，后台会自动拼接「仪表所在位置 + 仪表类型」。比如该仪表是个液位计，仪表块的所在位置填的是 V1101，那么导出来的仪表条件里，该仪表控制点名称后自动生成：V1101 液位。

### 隐藏逻辑

常规逻辑只能解决在设备上的仪表，而且设备不同位置也没法拼接的，比如反应釜内的和反应釜夹套的。如果仪表块的 NAME 属性，你填的信息里包含「拼接」这两个字，那么后台默认你知道你清楚隐藏功能，会走这条隐藏逻辑。分仪表所在位置是设备和管道的两种情况。

1、设备上的仪表。后台会自动拼接「仪表所在位置 + 你填的信息 + 仪表类型」。比如反应釜夹套上的一个温度计，仪表块的所在位置填的是「R1101」，控制点名称填的是「拼接夹套冷冻盐水」，那么导出来的控制点名称自动生成：R1101 夹套冷冻盐水温度。

2、管道上的仪表。后台会自动根据仪表所在位置的管道号去找这根管子的来去向信息，再进行拼接。

如果管子的两端都是设备，后台会自动拼接「从设备 A 到设备 B 的仪表类型」，比如一个开关阀，所在管道号 PL1101，PL1101 自 V1101 到 R1101，控制点名称填的是「拼接乙醇进口」，那么导出来的控制点名称自动生成：从 V1101 到 R1101 的开关阀。

如果管子的一端是设备一端是管道，主要是设备上放空、氮气、蒸汽、循环水等共用工程管道上仪表，后台会自动只提取管道来去向里设备的信息，自动拼接「设备 + 你填的信息 + 仪表类型」。比如储罐上氮气管的压力表，所在位置是管道 N1101，N1101 是自 N1001-65-2J1 到 V1101，控制点名称填的是「拼接氮气」，那么导出来的控制点名称自动生成：V1101 氮气压力。注意：管子来去向里一端如果是总管，不能填「氮气总管」这种，必须填写总管的管道号形式，管道号对不对无所谓，必须符合管道的形式「N1001-65-2J1 」，后台是根据这个形式来判断它是跟管子的。

备注：加「拼接」2 个字可以在临时文件里统一用 excel 的拼接函数实现，放在句首和句尾均可。

## 13. 设备临时件自动生成设备位号

通过设备的临时 Excel 文件自动生成流程图的设备位号以及流程设备图形块。具体步骤如下：

1、拿到业主的设备资料后，整理出需要的设备关键参数后，复制到各个设备的临时 Excel 文件。

2、点击菜单栏流程图绘制里「导入流程图设备位号及图形」或者工具栏里的相应按钮。

3、选择要导入的设备大类，可以按设备位号排序也可以按设备体积排序。点击「导入数据」按钮，状态变为「已完成」后在图纸里拾取一个插入点即可。

备注：自动匹配的设备图形库还未上线。

## 14. 画流程时自动生成仪表块

生成仪表块继承所在设备或所在管道的数据。除了常规的 copy 外，提供了另外一种画管道块和仪表块的方式。以设备（管道）为核心，生成的仪表块继承设备（管道）的部分数据。

V2.1 改进：

经使用反馈，自动生成的仪表会自动继承所在位置的介质、温度、压力等数据，但很多时候我们这几个数据会经常改。改进后的逻辑：自动生成的仪表只自动填充所在位置（设备位号或管道编号），而且支持自动更新（设备位号管道编号改了，仪表所在位置也可以一键更新）。介质、温度、压力等数据，如果跟设备或管道相同，只要空着，导成品时后台已经有功能可以去匹配关联的数据。所以自动生成的仪表填充所在位置信息即可。

## 15. 主物料管道的初始数据自动填充

管道的来源、去向这两个属性，只要填的是「设备位号」，那么可以自动填充来源设备里的「介质、温度、压力」3 个数据。有此初始数据后再根据实际情况做调整。

所在工具栏：流程-数据修改；所在菜单：数据修改 => 管道介质温度压力继承设备。

## 16. 自动填充公用工程管道的来去向设备位号

基本原理：每张图里筛选出公用工程管道（物料代号支持自定义），每个管子去找离它距离最近的设备位号块，就当是这个设备上的管子自动把设备位号填充进管道的来去向里。差不多 80% 以上是对的。剩下的 20% 按以前的方法刷，刷的同时也跟这个设备做了数据绑定，下次再使用「一键赋值公用工程管道」时，如果管道上已经绑定了数据，以你绑定的设备信息来更新，没绑定的话才会去找距离最近的。

所在工具栏：流程-数据修改 => 一键公用管道来去向设备位号；所在菜单：数据修改 => 一键公用管道来去向设备位号。

具体步骤：

1、确保所有管道数据包含所在图号信息，可以通过「一键更新流程数据图号」实现自动赋值图号数据。

2、系统自带了一些常用的公用工程管道物料代号，输入要添加的自定义公用工程物料代号后，点「增加」。一次添加一个。

3、框选部分图纸，或全部所有图纸，点击「更新」即可。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）