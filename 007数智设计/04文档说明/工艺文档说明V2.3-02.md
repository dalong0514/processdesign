## 布置图相关

## 01. 迁移流程图设备数据到布置图

具体步骤如下：

1、点击菜单栏布置图辅助里的「提取流程设备数据」或者工具栏里的相应按钮。提取成功的话会弹出提示弹窗。

2、在布置图里，点击菜单栏布置图辅助里的「迁移流程设备数据」或者工具栏里的相应按钮。选择一个插入点即可生成对应的布置图设备位号，以及「设备平面图形」。

备注：目前设备外形图形库只做了立式储罐以及 B 型支耳的搪玻璃反应釜（开式及闭式）。如果设备尺寸匹配不到相应的「设备平面图形」，而你手里又有比较好的设备图形，请提供给我。此功能的实现，需要大家一起把手里比较好的、厂家提供的设备外形图块放在一个公共图形库里。

## 02. 同步布置图中设备的平面图形

设备布置图平面图形根据设备代号自动匹配更新。

具体步骤如下：

1、点击菜单栏布置图辅助里的「更新布置图设备块」或者工具栏里的相应按钮。

2、点击「导出数据」，导出状态指示已完成后，系统会自动在 D 盘的「dataflowcad」文件夹下的「data」文件夹里，自动生成布置图设备图形的 excel 数据文件。管道数据为：gsBzEquipData.csv。

3、打开 excel 数据表后根据情况更改「设备类型代号」。具体代号规则详见后文。

4、导入数据。Excel 临时文件修改数据后，点「导入数据」，导入临时文件状态变为「已完成」后，点击确认更新，即可更新布置图中设备外形图形。

### 设备代号规则

目前设备外形图形库只做了立式储罐以及 B 型支耳的搪玻璃反应釜（开式及闭式）。

立式储罐代号规则：字母 V 后面是体积，单位为 L；字母 D 后面是直径，单位 mm；字母 `LS` 代表立式。比如体积 500 L、直径 700 的立式储罐，其代号为：`V500D700LS`。

目前库里已有的储罐图形：V50D350LS、V100D400LS、V200D600LS、V300D600LS、V500D700LS、V600D800LS、V800D800LS、V1000D1000LS、V1500D1000LS、V2000D1200LS、V2500D1200LS、V3000D1400LS、V4000D1400LS、V5000D1600LS、V10000D2000LS。

搪瓷反应釜代号规则：字母 V 后面是体积，单位为 L；字母 D 后面是直径，单位 mm；字母 `KSB` 代表开式 B 型支耳，字母 `BSB` 代表闭式 B 型支耳。比如体积 5000 L、直径 1900 的开式 B 型支耳搪瓷反应釜，其代号为：`V5000D1900KSB`。

## 03. 设备临时件自动生成设备位号

通过设备的临时 Excel 文件自动生成布置图的设备位号以及设备图形块。具体步骤如下：

1、拿到业主的设备资料后，整理出需要的设备关键参数后，复制到各个设备的临时 Excel 文件。

2、点击菜单栏流程图绘制里「导入布置图设备位号及图形」或者工具栏里的相应按钮。

3、选择要导入的设备大类，可以按设备位号排序也可以按设备体积排序。点击「导入数据」按钮，状态变为「已完成」后在图纸里拾取一个插入点即可。

## 04. 迁移建筑底图到工艺设备布置图

基本思路：1）自动抓取建筑图纸里特定的对象数据（柱子、墙、门、窗、楼梯）生成建筑底图，干净的建筑底图可以迁移到工艺设备布置图里。2）建筑底图的图层支持一键锁定和解锁。3）支持一键更新。建筑那边的图纸修改后可以更新到本专业底图。

具体步骤如下：

1、打开一张建筑底图。有些人的建筑图层是锁住的，先解锁。点击菜单栏，迁移建筑底图里的「解锁建筑底图」或者工具栏里的相应按钮。

2、点击菜单栏，迁移建筑底图里的「移出建筑底图」或者工具栏里的相应按钮。如果建筑图纸不规范，有问题的地方自己修补一下。

3、核对建筑图纸标签里的层高信息。我们的迁移功能是根据图签里的层高打标记的，一定要确认建筑图签里填有层高信息，建筑人没填的话自己加一下。

4、只有第一次用建筑底图的时候，需要自己手动拷到工艺的布置图上。下次建筑二版有更新的话，在建筑图纸里点击「提取建筑底图」，接着到工艺的布置图里点击「自动更新建筑底图」。

5、建筑底图的图层支持一键锁定和解锁。

## 05. 洁净空调条件/舒适性空调条件模块（贡献者郑飞宏、牟苏嫣）

插入洁净空调/舒适性空调块有如下两种方式（也可以复制）：

数据流菜单：布置图辅助 => 生成洁净空调房间块/生成舒适性空调房间块。

数据流工具栏：布置-布置绘制 => 生成洁净空调房间块/生成舒适性空调房间块。

房间编号可以通过「房间自动编号」完成，使用方法同流程图里的自动编号功能。其他数据建议导出到临时 Excel 文件内修改。

输入完数据后导出数据，直接进入桌面客户端的洁净空调条件/舒适性空调条件模块，点击「提取数据」，然后导出条件成品 Excel 表。

注意点：房间的温度、湿度数据，不同洁净等级的房间温湿度要求规范给定了数据：D 级温度 18-26℃，湿度 45-65%；其他级别，温度 20-24℃，湿度 45-60%。跟规范要求相同的请「空」着不要填，不一样的才填。已经暖通专业统一过。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）


## 其他


## 01. 其他模块

### 1.1 非标设备条件（贡献者陈宝锋、叶菁、方全利、高洋洋）

1、导出 CAD 数据。导出 CAD 数据功能里选择「非标设备条件」。

2、获取工程图模板 Excel。进入桌面客户端 => 工艺专业 => To设备专业，提取数据 => 导出设备条件模板。

3、Excel 补充数据。

1）主数据表。目前包含：储罐、换热器、反应釜模块。

所有设备的「设备是否生成工程图」默认都是「否」，设备条件输入完整的设备该属性设置为「是」即可在后续在 CAD 内生成工程图。

主设备表只需输入与工艺设备条件相关的数据。

2）管口数据。

目前从流程提取出的管口数据是与设备相连的所有管道、仪表的数据。并未自动合并共用一个管口的管道数据，目前需自己删除多余的管口数据（可以通过流程图号筛选，一张流程一张流程来做）。

3）支座数据。

4）其他要求。

5）其他相关。主要受压元件、设计制造检验与验收标准、制造与检验要求，这几块数据无需填写，是设备专业做工程图用的。

4、点击左上角的提取数据。进入 CAD，设计流菜单 => 设备相关 => 生成工程图。图纸里拾取一个插入点即可。

该模块操作说明细节待补充，需使用该模块的可直接找我演示学习。（2021-07-20）

### 1.2 介质物性匹配工具（贡献者陈康麟）

V2.3 版本新增：「危险化学品目录（2015 版）实施指南（试行）的通知」急性毒性数据。

1、桌面客户端 => 小工具 => 物性数据匹配 => 获取模板 Execel。

2、获取的 Excel 模板里填写项目号、介质的中文名称。注意：介质名称需放在同一列内。

3、点击左上角的「提取数据」，回到桌面客户端，提取数据 => 导出物性数据。

之前只匹配「危险化学品目录（2015 版）实施指南（试行）的通知」内的急性毒性 1 级、2 级的信息，该模块后续会不断匹配更多的规范数据以及介质本身的物性数据。

## 02. 技巧汇总

### 1.1 保留老版流程图数据的前提下使用新版的属性块

截至此版本，数据流涉及的属性块汇总如下。1）设备相关块：Reactor、Tank、Pump、Heater、Centrifuge、Vaccum、Custom。2）仪表相关块：InstrumentP、InstrumentL、InstrumentSIS。3）管道相关块：PipeArrowLeft、PipeArrowUp。4）外管相关块：OuterPipeLeft、OuterPipeRight。

数据同步具体方法：

1、将老版图纸整体拷进新版属性块模板里。模板文件路径：dataflow => allBlocks => GsLcBlocks.dwg。

2、点击数据流菜单里的「帮助 => 一键同步数据流属性块」，该功能可以同步除了管道块之外的所有数据流数据。

3、若需要同步管道数据，命令「BATTMAN」进入块属性管理器。依次选中管道块 PipeArrowLeft、PipeArrowUp，点击右上角的「同步」按钮。

## 03. 注意事项

### 1.1 管道数据需使用配套的材料等级表

管道数据表只有使用配套的等级号，压力等级、吹洗介质、无损检测比例、检测合格等级、泄露性试验介质、压力，这几个数据后台可以自动根据相关逻辑判断填充，否则只能在导出的数据表内自行修改。做外管条件表时同理。

配套的材料等级表详见之前发给大家的邮件，或者直接从我这边获取。

### 1.2 谨慎同步管道数据

请谨慎同步「管道块」。我们发现同步管道块后，所有管道的「数据 ID」会更改，而一键更新接图箭头和一键更新辅助流程，是与管道的数据 ID 关联的，同步管道块后这两个功能无法使用。所以本次更新的「一键同步数据流属性块」剔除掉了管道同步，也请大家如非必要，不要同步管道块。

## 04. 相关知识

### 1.1 通配符匹配原则

| 通配符 | 匹配原则 | 举例 |
| --- | --- | --- |
| `*` | 匹配任意数量的任意字符 | 比如：`VT*` 会匹配到任意以 VT 开头的管道；`VT-25-*` 会匹配任意管径为 25 的管道。`VT*-50-*2J1*` 会匹配任意管径为 50 的、等级号为 2J1 的管道。等等 |
| `[...]` | 范围描述符 | `[a-z]` 表示从 a 到 z 之间的任意一个；`[1-6]` 表示 1 到 6 之间的任意数据 |
| `[~...]` | 反向范围描述符 | `[~ac]` 表示除了 a 和 c 之外的任意字符 |
| `?` | 匹配任意单一的字符 | - |
| `#` | 匹配任意单一的数字 | - |

备注：通配符基本可以匹配刷选出你想要的任何数据。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）