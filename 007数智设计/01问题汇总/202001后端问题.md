## 01

奇葩的跨域问题，完全是自己 2B，弄了半天终于找到原因。后端代码里调试用的 `dd()` 函数没有删除。

一直报错跨域，访问不到数据，试了 N 多手段都无效。最后一点一点新建一个最简单的 get 请求，一步步试，也是无意中找到问题的。牢记这个坑！（2020-06-30）

## 02

2020-12-06

postman 调试的时候，一直显示「文件无效」，找不到原因。

找戴强解决：说报错这个说明文件没有上传上去，但自己已经上传了 txt 文件，后面还是他发现漏掉了上传文件的 `key`，得填上 source。

无语了，这种低级错误，自己真的好难发现，多做记录。

## 03

window 上打开 csv 文件是乱码，无意中发现只要在写文本前，文本前面加上 BOM 后显示就正常了，但是一旦在 window 上修改，一保存后又是乱码，根本原因感觉 utf-8 编码有关。

```php
// UTF8 csv 文件头前需添加 BOM，不然 window 打开会是乱码
fwrite($output, chr(0xEF).chr(0xBB).chr(0xBF));
```

网上找到一个解释很认同：没有一个说对的，因为 excel 根本就不支持 utf-8 编码，只支持 ANSI，要正确显示中文的话，把文件转成 GBK 或 GB18030 编码就行了。

1『感觉转成 GB2312 也是可以的，因为在 excel 那边看到默认的编号格式是 DB2312。（2020-12-08）』

所以之前的加 BOM 和去 BOM，从根子上没解决问题，因为还是 utf-8 编码的，加了 BOM 只是告诉 excel 软件，哦，我这是 utf-8 编码的，你显示的时候帮我显示出来，但 excel 也跟就不支持 utf-8 编码，一保存就成乱码了呗。

找了下实现各个编码类型互转的实现：[PHP 数组转换编码问题 GBK/UTF-8 | Howingwah](http://www.howingwah.com/program/php/759/)。但代码质量不行，待重构。

## 04

2021-01-13

内网导出压力数据表的时候报错，关键是外面的测试环境没问题的。一步步排查发现内网上，csv 字符数据转数组有问题，命名 30 个数据只产生 20 多个元素，最终定位到函数 `str_getcsv` 有问题，用函数 `explode`。