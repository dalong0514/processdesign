## 202100. 数智设计个人随笔

2021-03-03

1、点起点设备位置、终点设备位置，两个点去匹配距离最近的设备位号，自动生成折线，管道块自动插在最长的多段线上。

2、做一个自定义的多段线pl命令，用这个命名来化管线。画完管线后如何绑定管道号？

2021-03-04

1、生成管道和仪表可以用选择集选择2个数据源提取数据。仪表选一个设备（所在位置、其他共享属性）一个其他仪表（仪表位号）。管道选择一个设备和另外一个管道。

2、多段线拆解成多个直线数据：获取所有的位置点。去头形成一个数组，去尾形成一个数组，两数组中元素按顺序匹配成直线数据。

验证一个点是否在直线上：对于水平线，点的y坐标与直线y坐标相同（写一个约等于函数），点的x坐标在直线两个x坐标之间。

2021-03-05

1、工艺布置图里筛柱子时先剔除建筑图签。

2021-03-09

1、打开外部文件后，只要不释放，是不是意味着，图纸空间里已经生成了entity name，那么就可以直接通过handle获取entity name。

2、匹配不到的图形，用圆圈表示。这样让用户知道目前没有该类型库，可以与我联系。

2021-03-10

1、布置图的设备块，块名与流程图一样，修改临时文件的逻辑直接套用。

2、悬挂的设备，下层楼板的设备图形直接生成或更新。

3、布置图的设备图形块增加设备种类和体积。

2021-03-11

1、从csv读数据生成图形的改进，先形成位号块，根据位号块的的entity name过去属性点对数据，直接套用从流程图迁移数据的逻辑。这这种方式可以通过已经有属性名匹配。还有路径，读取出的csv先直接跟属性名形成点对数据集。

2、布置图设备代号所需的元素：设备类型、体积、直径，外加小类别，比如立式或挂耳。举例：GsBzTank-V1000D800LS。

3、建筑的轴线号的那个块不用自动生成，只是作为定格点。第一次自己拷轴线好到工艺的布置图中。

2021-03-12

1、借用布置图的思维。自动用临时文件生成流程图的设备位号和设备图形。

2、流程图和设备布置的信息匹配。左右两个界面：1）匹配到流程比布置多的数据；直接选取插入点生成这些数据。2）匹配到流程比布置少的数据；直接定位到这些设备的位置；一键清空这些设备信息（待确认是否需要）。

3、让用户没法破坏生成的大积木的标签。直接从用户的图纸里提取他们修改后的「模式」。自下而上的让用户自己生产内容。

4、在已有设备数据信息的情况下，根据临时文件导入生产位号、图形，也做一个数量的匹配。

5、流程图生成管道块前赋值的逻辑改进。之前按块属性的序列号匹配的，但上一个版本做竖向管道块时，version属性顺序弄在了第二位，导致赋值错位。还是生成图形后直接获取其entity name，然后根据属性名来匹配赋值。—— 已完成

6、数据流的所有图层名前加一个0，比如0DataFlow-Instrument，这样弄保证设计流的图层都在图层管理器顶部。—— 已完成

7、把数据导成csv存在本地，作为一个数据库用。

2021-03-13

1、设计流使用的流程（作业系统），做一个系统。

2、设备布置里设备图形块新增层高、外形尺寸（待确定）字段。

3、匹配不到的设备图形块，包括中心线所有图形单独放到那个设备图层里，方便全部隐藏掉。

4、输入积木关系的信息放在CAD实现，而且结合弹窗。两大类命令，生成积木的命令和修改积木的命令。修改积木的命令可以抽象成一个按钮，通过选择集选择的不同类型块匹配到去修改哪个积木界面。

比如母体积木。新建一个母体积木。点修改按钮选择该母体，弹出母体信息输入界面，比如需要的冷媒下来列表、需要的热媒下来列表、需要陪冷凝器的选项（而且可以选择不同的冷凝器形式）等等。

比如管道积木，先选择母体进行绑定后生成管道积木，一个积木里可以容纳多跟实际管道。分开的两个积木管道代表接入设备的两个接口。

补充：进口管积木、气相出口管积木，是母体积木的二级积分，以此实现多级嵌套。

补充：面板里收集的信息绑在母体的Xdata上，这样用户只能通过面板修改。

补充：积木区域可以固定在流程图图签固定位置，自动在该图签所在图框内生成。

2021-03-15

1、自动更新管道来源；自动更新仪表所在位置。

2021-03-16

1、生成的积木，里面的元素打个标签。随便选一个元素拾取该标签，然后可以整体移动该积木。

2021-03-17

1、管子超了2000因为处理超时导致导不出仪表条件。可以把匹配逻辑放到CAD端，这样也只需导出仪表数据。2021-03-18

1、直接把 excel 界面做前端界面。

做开发暖通设备表，实现了从 excel 里提取 csv 文件，那么反向操作。CAD 提取的数据我可以只用在 excel 用 VBA 提取本地的csv文件，通过 VBA 写输入进设备一览表模板里。exce 里添加几个「按钮」说白了跟前端界面就是一样的了。

2021-03-18

1、复杂和很多图像的数据，先打标签，然后打包成块。通过「偷」跨图，然后接上宏「炸开」，炸开后的各个实体对象因为有了标签，如何操作可以实现了。待验证是否可行。

2、写一个增加Xdata的界面版命令！方便打标签。

2021-03-19

1、跟夏老板聊天，确定了是生成图形而非匹配图形。

2021-03-21

1、建筑底图的轴线号直接用「复制宏」来挪移。—— 已完成

2021-04-06

1、一键自动生成流程底部的设备位号。

2021-04-08

1、想到实现CAD里数据流只能用一个月的方法了。设一个全局变量，加载的时候读取时间，每个宏命令使用前做逻辑判断，必须小于某个时间点。

2021-04-12

1、可以把项目信息单独生成一个纯文本。Electron 读文件是读多个文件成 list 的。项目的文件信息单独拎出来作为赋值给项目号单体号。补充：这种方式还是仅仅作为测试用，项目信息跟数据还是放在同一个文件里吧。这样可以直接把项目信息写进成品 Excel 表里。

2021-04-13

1、Electron 完全可以当作一个大的DCL面板用。所有的数据用本地的一个临时文本交互，互相读写。土建的按关键词搜索图集，面板直接在Electron里做，匹配到后点一个提取按钮。CAD 那边直接插入。

2、临时Excel文件的整合。以设备数据为例，因为种类最多。

写数据。一次性把所有的设备数据写到一个本地文件里，electron读该文件根据项目信息自动生成一个Excel文件（以项目单体号命名），该Excel表里7类设备7个表单。或者，CAD端借助VBA直接生成Excel，electron只是作为一个浏览文件夹，做一个数据流的临时设备页面，该页面里可以看到各个项目的临时Excel，并且可以直接打开，修好文件名。

读数据。直接借助于VBA。VBA里点击提取按钮，直接生成一个包含该文件夹下所有规范命名的临时Excel文件名的数据文件。CAD那边直接读这个文件名数据生成一个下拉列表框，选中该项目后点导入接着现实项目的名称等信息供用户确认，无误后批量导入CAD。甚至前面VBA生成文件名数据省略，直接CAD端读取该文件夹下的所有文件名。补充：这样没Excel那边点提取方便，因为改的那个单体信息一般Excel肯定正好打开的。应该是Excel那边点提取按钮只到处该文件的文件名，CAD端直接读改文件。

3、用户给自定义模块截图作为该模块的附属信息。electron可以调系统的截图功能，那么给该模块截图后直接绑在该模块数据上。

2021-04-17

1、直接根据目前的设备、管道、仪表数据做设备条件表活工程图。管道上有来去向，根据来去向分割数据，获得每个设备上所有的管道（管口）、仪表。

工程图以设备为单元单独建一个数据库表单。

2、结合迁移建筑底图里的思路，剔除掉不需要的 dxf 后直接生成实体对象。把 HGCAD 里的图集全部 json 化。

2021-04-22

1、Excel里直接做一个小型数据库，根据特定的数值去匹配一行数据。工程图受压元件材质的数据可以这么干。

2、暖通设备一览表里跳过空行的逻辑：直接判断位号那列是否为空值。空的跳过。

仪表材质变等级逻辑。管道那边把新替换的变等级材质存在一个不用的属性里。仪表材质匹配的时候多做一步判断。

2021-04-27

1、管理成品文件。带项目号单体号以及时间信息。

2、验证时间去一个时间段，比如大于 20210401小于 20210501

2021-04-28

1、一键生成流程图底部的设备位号。

2、共用工程管道，来去向里的设备位号一键更新。找离它最近的设备位号。
 
2021-05-07

1、工程图更新逻辑：1）以设备位号定位，删除所有的表格块。2）设备位号定位到图框，获取图框的基点，重新生成一遍表格数据（套用原生成逻辑）。

2、刷管道来去向的同时，绑定设备的数据 ID。

3、主物料的介质温度压力继承设备，筛选的逻辑更改为用户自己输入物料代号。

2021-05-12

1、流程图根据共用工程管道流向，自动插箭头。

2021-05-18

1、表格插入点抽象出一个变量。工程图里，初始插入点是最开始的表格，每插入一些表格模块后，重新计算初始插入点。

2021-05-29

1、暖通全面通风多页面数据提取。

2、设备布置图设备图形块。主题块和支耳块，2 个块的中心点做一个距离误差小于多少的逻辑判断函数。

3、支耳块。X 和 Y 方向的双向拉伸做动作关联。

2021-06-01

1、Excel 表作为方框图的输入界面。

2、工艺设备条件到工程图的逻辑。

CAD里点提取数据；客户端导出带宏的设备条件Excel版（简化版工程图Excel），修整数据后可以导CAD图形查看以及校核，最终以Excel上传的数据入项目数据库。

2021-06-02

1、写数据成 CSV 之前自动剔除掉英文单引号、双引号，分号替换为中文分号。

2021-06-09

1、工程图的图框比例抽象出来作为变量。表格块全部缩放到 1 倍作为基准块。

2021-07-16

1、暖通通风模块思路。框 PL，PL 内的设备块可以拿到，匹配流程里的数据，PL 内的物性数据可以拿到。那么就可以使用有害介质法来计算了。

2021-07-23

给排水其他发散后的模块（何小萍）

1、仓库喷淋布置。

2、车间卫生间。

3、消防泵房。

4、储罐消防泡沫。

2021-07-27

1、液位计最低最高值，空着的话默认填一个值。

2021-07-29

1、设备参数数据做成 json 格式直接放到服务器共享文件里，CAD 读取匹配。

2、数据标准，想到了仪表位号编号、管道编号的规则。能不能公司内强制统一？对业主强势一些。

2021-08-22

获取新版图签信息的方法（目前倾向于第二种方法，老功能的代码不用修改）：

1、复制一个图签偏移出去后，炸开，获取对应位置的多行文字数据，然后删除复制的图签。

2、批量在右下角插入一个缩小版的老图签。

2021-08-23

1、二维数据流的与三维模型数据核对。

管道、阀门、特殊件都可以。正巧当天发了一份「关于加强三维设计项目专业协调及材料统计工作的通知」。

2021-09-01

1、设备一栏表临时文件迭代优化设想。

导出所有设备类型的数据；设备综合 Excel 表里对。

2021-09-17

1、设备非标条件。填管口位置信息会大大增加时间成本。借鉴模块库那边的思维，数据和图形数据可以剥离，工艺提设备条件时不要在 Excel 表内填管口位置信息，自动生成一版默认的，然后用户自己在图上移动管嘴的位置。

2021-09-18

1、做模块库时想到的：借鉴生成阀门，选取一个管道块作为数据源，生成一个绑定相对位置纯管道号块，放到管道组件类别里。

2021-09-26

1、支座数据图形化放服务器，参考氢化流程的图形数据。因为无中文，可以直接在CAD调后端接口。

2021-11-23

1、仪表位号按设备位号编的话，直接在布置图的设备位号旁边插入一排位号。

2、工艺仪表条件：开关阀的名称最好是某个设备出口管开关阀，而不是从A设备到B设备的开关阀，这样的话仪表专业不好找这个阀门在哪。

2021-11-25

1、自下而上，用户自定义的模块自动加入公共池；看被引用的次数评判好坏；模块有个预览图。

2021-12-01

1、新版设备表临时 Excel。参考新版仪表条件分左右两块区域，左侧用于同步 CAD，右侧用于预览。此时预览的部分可以根据型号匹配相应的设备参数。