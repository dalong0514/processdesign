## 01. 需求建议收集

1、截图箭头批量生成。—— 已完成 V2.3

很多时候泵出口有多根管道，一个个点太慢，可以批量生成。

贡献者：叶旭峰

2021-07-07

2、修改块的字宽。—— 已完成 V2.3

贡献者：李恒、林骏、尚颜娜

李恒之前提到的想改管道号字宽，林和尚提到的是改仪表编号。

2021-07-12

3、王运发布的清理命令集成到小工具。—— 已完成 V2.3

```
(dictremove (namedobjdict) "ACAD_DGNLINESTYLECOMP")
```

4、布置图里的数据修改后直接更新到流程图。

贡献者：郑涛

2021-07-09

5、按流程图号编号逻辑改进。—— 已完成 V2.4

贡献者：李侦糠

2021-07-22

之前做的逻辑，按流程图号编号我们是强制数字「4」嵌入到主流程、数字「5」嵌入到辅助流程。改进后的逻辑更通用：默认不强制嵌入了，你要嵌入数字的话自己通过「编号前缀」嵌入。

6、增加 HV 数据表。

华雷：HV 是工艺没有和参数挂钩，就和开关阀一样，编号也是从 1 开始顺序编的，只是可以调开度的遥控阀门，因此是 HV。

贡献者：尚颜娜

2021-07-27

7、按图签自动编号新增自左而右、自上而下两种模式。—— 已完成 V2.4

贡献者：沈洋

2021-07-27

8、目录自动生成。—— 已完成 V2.4

贡献者：叶旭峰、曾涵卫、李侦糠、郑涛、华丽萍、沈洋、邢杰

2021-07-27

9、新增物性匹配规范。—— 已完成 V2.4

《HGT20698-2009化工采暖通风与空气调节设计规范》的闪点数据。

《重点监管的危险化学品名录-2013》是否为重点监管物质。

2021-07-27

## 02. 修改记录及 bug

### 工艺 bug

1、仪表按设备位号编号，功能代号与设备位号间加一个横线。—— 已完成 V2.3

贡献者：林骏

2021-07-06

2、刷管道终点的时候也把终点设备的数据 ID 绑定了。—— 已完成 V2.3

刷终点不需要绑定数据 ID，刷起点才绑。

贡献者：叶旭峰

2021-07-07

补充：改回去后，管道终点绑定不要紧，更新继承设备时之前做的逻辑是先过滤出 2 端都是设备的管道才更新。要绑定的原因是，按距离一键更新公用工程管道来去向时，要靠管道起终点是否有数据 ID 来更新共用工程管道来去向的数据，所以又改回去了。（2021-07-13）

3、设备一览表电机型号没填充。—— 已完成 V2.4

原因：之前设备一览表模板更新后，电机型号填充定位忘记更新导致的。

贡献者：蒋万忠

2021-07-30

### 仪表 bug

1、多行文字，一个图框内可能有多个，之前的逻辑只识别图框内的一个多行文字。

能写 60 多行的多行文字，只能在 2014 版本上使用，2014 以下版本，只能一竖条一个多行文字。

贡献者：华雷

2021-07-26

2、压力表选型，隔膜压力变送器匹配

隔膜、非隔膜之前只匹配了管道上的压力表，而且是根据管道的等级号匹配的，因为工艺目前大部分材质是空着的，更具等级号匹配材质填充到仪表条件的。

修复方案：先不管在管道还是在设备上，直接看属性所在管道设备材质（material）是否为：搪玻璃、钢衬四氟、聚丙烯、增强聚丙烯、钢衬聚丙烯。

贡献者：华雷

2021-07-27

## 03. 邮件记录

### 2021-07-28

单文件内图纸目录自动生成

各位：

1、图纸目录自动生成的功能呼吁人比较人，目前单文件内的图纸目录生成可以使用了，读取文件里所有图签内的数据生成目录。图幅、版本号这两个数据要自己去核对，图幅默认填写的A1，版本号默认填写的1。

2、图签自动编号做了升版（所有专业可以用）。支持一行一行自动编号，或者一列一列自动编号（自上而下、自下而上均可）。

备注：这 2 个功能都在「公共工具」栏里。

### 2021-07-26

邮件名：给排水设计流数据一体化升版V0.1

各位：

给排水设计流第一个模块水量平衡图已经可以使用了，V0.1 版正式发布（说明文档详见桌面客户端的文档说明部分）。数据流的最新软件以后都会放在公司内网共享盘：\\192.168.1.38\dataflow-install

### 01. 插件加载

1、存放插件。将压缩包「dataflowcad.rar」直接解压到 D 盘，解压后的文件夹一定要放在 D 盘下（即确保文件夹 dataflow 是直接在 D 盘下的），因为有些文件路径在插件里是写死的。

2、加载菜单插件。输入命令「menuload」，点击「浏览」按钮，选中插件文件夹中的文件 dataflow-ss.cuix 加载（各个专业加载的不同），以后再打开 CAD 会自动加载该菜单。

3、加载命令插件。1）输入命令「appload」，加载插件 dataflow.VLX（各个专业加载同一个文件）。2）设置 CAD 启动后自动加载。还是在刚刚加载命令的界面里，点击右下角「启动组」上的「内容」。在启动组里将添加命令插件。

4、数据流工具栏。目前数据流的所有命令除了菜单那边可以访问，也集成到了工具栏。如果没有显示工具栏，鼠标放在工具栏的任意空白位置，右键会弹出 CAD 工具栏的选项卡，选择数据流「DATAFLOW」勾选各个子选项，详见下面的动图。

### 02. 自动生成水量平衡图（贡献者：孙晨）

1、输入水量平衡数据。从共享文件夹内复制「SS水量平衡表V0.1.xlsm」到自己的电脑上。左侧表格部分是你们提供的模板，右侧有一列新增的「用水类型」，下拉选择：生产用水、生活用水和循环水（后续可根据你们的需求增加），目的是为没一行数据打「标签」。注意：大家新增数据的时候用水类型不能为空。输入完数据后点击左上角的「提取数据」。

2、生成水量平衡图。点击数据流工具栏内的命令「插入水量平衡图」，图纸内随便拾取一个插入点即可。

注意：1）此模块除了循环水量是后台将各单体水量累加，其余都是直接读取 Excel 内的数据，所以 Excel 里你们可以各类计算公式，不影响使用。2）如果生产用水的单体很多，超出了平衡图图框，图框右下角有个按钮是可以下拉的。

### 03. 通用型工具

所有专业共用的一些基础工具，比如一键去教育版、一键清理线性及清理图纸，在数据流菜单的公用工具面板上。


使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）


### 2021-07-21

邮件名：仪表设计流数据一体化升版V0.1

各位：

仪表设计流 V0.1 版正式发布（说明文档详见桌面客户端的文档说明部分）。数据流的最新软件以后都会放在公司内网共享盘：\\192.168.1.38\dataflow-install

### 01. 插件加载

1、存放插件。将压缩包「dataflowcad.rar」直接解压到 D 盘，解压后的文件夹一定要放在 D 盘下（即确保文件夹 dataflow 是直接在 D 盘下的），因为有些文件路径在插件里是写死的。

2、加载菜单插件。输入命令「menuload」，点击「浏览」按钮，选中插件文件夹中的文件 dataflow-ks.cuix 加载（各个专业加载的不同），以后再打开 CAD 会自动加载该菜单。

3、加载命令插件。1）输入命令「appload」，加载插件 dataflow.VLX（各个专业加载同一个文件）。2）设置 CAD 启动后自动加载。还是在刚刚加载命令的界面里，点击右下角「启动组」上的「内容」。在启动组里将添加命令插件。

4、数据流工具栏。目前数据流的所有命令除了菜单那边可以访问，也集成到了工具栏。如果没有显示工具栏，鼠标放在工具栏的任意空白位置，右键会弹出 CAD 工具栏的选项卡，选择数据流「DATAFLOW」勾选各个子选项，详见下面的动图。

### 02. 桌面客户端安装

1、进入公司内网共享盘：\\192.168.1.38\dataflow-install（地址直接拷进文件管理器顶部路径内即可）。双击「数智设计.exe」安装，默认安装路径将 C 改成 D，其他不变。

2、账户是大家公司邮箱全名，初始密码：tz123。登录后，进入各模块。常规操作一般都是 CAD 端导出数据后，这边相应的模块直接点「提取数据」，然后导出成品。

### 03. 仪表安装材料统计模块（贡献者：华雷、蔡翠平）

1、插入数据流块。点击数据流工具栏内的命令「插入安装材料块」，插入到图纸中，插入后可以直接用 CAD 复制命令拷。注意：一定要用数据流的块，后面所有的功能是基于此块的。

2、输入材料数据。安装材料块内输入数据，操作跟普通修改 CAD 块内属性一模一样。

3、自动提取仪表个数。点击数据流工具栏内的命令「自动更新仪表个数」，有 2 个模式：1）上面仪表位号用多行文字写的选择「多行文字」。2）单行文字写的选择「单行文字」。接着点击「更新数据」按钮，后台会自动识别上面有多少个仪表，并将个数写入安装材料块内的「MULTIPLE」属性内。

4、导出数据。点击数据流工具栏内的命令「导出数据」，有全选和框选两种模式，全选后点击「导出」按钮，面板上的导出数据状态变为「已完成」即可。

5、导出成品材料表。CAD 端导出数据后登入桌面客户端，仪表专业 => 导出仪表安装材料，直接点「提取数据」，看到项目号、单体号无误后，点击「导出仪表安装材料」按钮即可，导出的 Excel 默认放在电脑的下载文件夹。

另外：可以通过「导入导出临时文件」功能在外面通过 excel 批量修改安装材料块内的数据。点击数据流工具栏内的命令「导入导出临时文件」，全选后导出数据，在自己电脑的 D盘 => dataflowcad => ksdata 文件夹下面会生成一个临时 excel 文件，excel 内直接修改完数据后可以返导会 CAD 块内。

### 03. 仪表自动选型压力表模块（贡献者：华雷）

工艺专业如果是用设计流提的仪表条件，大家可以直接从项目数据库内提取仪表条件数据进行选型，并生成公司的仪表数据表。目前压力表选型模块已上线，大家用的时候多提改善意见，我们最大的优势是院里自己开发的产品，沟通成本低，可以根据我们自己作业模式来调整，怎么方便怎么来。在此特别感谢华雷提供的选型逻辑。

1、输入仪表类型基础数据。桌面客户端 => 仪表专业 => 导出项目仪表类型参数，会获得一个Excel 模板，此表内填好不锈钢压力表、不锈钢抗震压力表、膜盒压力表、隔膜压力表、隔膜抗震压力表、膜片压力表、隔膜压力变送器、压力变送器，这 8 类压力表的基础参数。后面具体的一个压力表如果匹配到是隔膜压力表，会自动填此处隔膜压力表的基础数据，然后在此基础上根据具体的工艺条件数据对参数调整，这个表的过程连接尺寸变更、测量元件参数变更等。

基础数据输入完后点击左上角的「提取数据」，返回桌面客户端提取刚刚导出的数据，项目号确认无误后点击「上传数据」上传到服务器上的项目数据库。

2、导出临时横表数据表。桌面客户端 => 仪表专业 => 仪表临时数据表。选择仪表类型（比如压力），输入项目号、单体号，点击「导出」按钮，会获得该单体所有压力表自动选型后的数据。在此横表内做核对、部分特殊场景下仪表参数的修改。数据修改完后点击左上角的「提取数据」。

注意：最终导出的成品数据表是以临时横表内的数据为准。

3、导出成品数据表。桌面客户端 => 仪表专业 => 导出仪表数据表。直接点「提取数据」按钮，确认项目号、单体号无误后，选择压力表导出压力表数据表，选择压力变送器导出压力变动器数据表。导出的成品默认在大家电脑里的下载文件夹。

使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）

### 2021-07-19

邮件名：设计流数据一体化升版V2.3

各位：

此版本开始，网页端的功能已全部迁移至桌面客户端，网页端以后将不再维护。数据流的最新软件以后都会放在公司内网共享盘：\\192.168.1.38\dataflow-install

1、CAD 端的插件（dataflow.rar）跟之前版本的操作一样，直接解压后放在 D 盘。

2、桌面客户端。所有专业共用桌面客户端，双击安装文件夹内的「V2.3数智设计」，只需将安装路径里的 C 盘改为 D 盘，其他无需改动。

V2.3 版本更新内容如下（具体操作详见说明文档）：

### V2.3 版更新内容

**设备条件相关：**

1、新增非标设备条件模块（贡献者设备专业）。

自动提取流程图内设备条件的相关数据到 Excel 模板，Excel 补充、修改相关数据后自动在 CAD 内生成设备条件图。

**流程图相关：**

1、自动编号算法改进（贡献者郑飞宏）。

以前不按图号编号模式，只能一整行一整行的编。实现了所有数据全部一起编号，前提是先一键将所有数据填充图号信息。

2、导出临时 Excel 文件界面简化并增加框选数据功能。以前只能导全部数据，现在可以框选只导出部分数据。

3、修改数据流块的字宽（贡献者李恒、林骏、尚颜娜）

场景：有时候管道号、仪表编号太长，一个个用原生的 CAD 方法修改块属性字体宽体太慢，新增功能批量修改管道块、仪表块内的相关属性字体宽度。

4、接图箭头批量生成（贡献者叶旭峰）。

场景：很多时候泵出口有多根管道，一个个点太慢，可以批量生成。

5、增加了双箭头外管块（贡献者王禹谋）。

6、设备块的材质外显。应多人要求，设备块的材质属性外显出来方便画图时核对。

**布置图相关：**

1、设备图形块旁边自动生成设备位号（贡献者徐骋）。

布方案时可以只管图形块，定稿时在设备图形块旁边一键生成设备位号块。

2、洁净空调块新增系统编号、楼层，服务于暖通洁净空调模块。大家提洁净空调数据流的块提，比原来的模式要块。更重要的是，数据可供暖通专业直接使用。

3、新增舒适性空调条件模块（贡献者牟苏嫣）。

**设备一栏表相关：**

1、设备一览表模板更换为公司 2017 年的那版（贡献者楼佳明）。

**其他：**

1、新增介质物性匹配工具（急性毒性数据模块，贡献者陈康麟）。

将项目涉及的物质拷到 Excel 模板后，后台自动与「危险化学品目录（2015 版）实施指南（试行）的通知」匹配，获取该物质是否为急性毒性 1 级、2 级的信息，该模块后续会不断匹配更多的规范数据以及介质本身的物性数据。

2、集成清理命令到公共工具（贡献者李奕峥、王运）。

另外：建筑设计流增加了「泄压面积自动计算」模块，工艺这边有些人排方案的时候是直接用天正建筑自己画的，如果你用的天正建筑可以找我学下该模块，排方案的时候直接看下泄压够不够，避免后面浪费时间。

### V2.3 版 bug 修复

1、导临时文件（成品 txt）前自动修复数据（bug 贡献者李侦糠、郑涛）。

发现好多人因引入英文逗号导致破坏掉临时性文件的数据结构，后台自动在导数据前进行修复。

2、仪表按设备位号编号，功能代号与设备位号间加一个横线（bug 贡献者林骏）。

### 2021-07-18

设备设计流数据一体化升版V0.5

各位：

附件为升版 V0.5 后的的相关文件，以后最新的软件都会放在内网服务器，大家自行复制。地址：\\192.168.1.38\dataflow-install

更新内容如下：

1、需求清单第 12 项：（管口表）工艺条件中的公称尺寸、连接面型式、法兰标准、法兰型式对应形成设备专业的标注型式。

2、需求清单第 13、16、17 项：（图形）管口定位自动生成、自动标注定位。管口图形的绘制，管嘴位置分为：罐顶（竖直、法向），罐壁（水平、斜插），罐底（竖直、法向、水平），并增加相应标注。

除了法向法兰外，其他已实现自动生成和标注。1）管嘴方向，常规罐顶竖直和水管壁水平不填，作为默认项，法向和斜插才需填写；2）法向法兰如果很少见可以手动修改，如果要实现自动绘制，需一起协商下绘制算法。3）补强圈自动绘制画法需进一步讨论。

3、需求清单第 18、20 项：设备封头总高度、整个设备最低最高总高度（卧式总长度），全部标注出来了。

4、需求清单第 21 项：（图形）增加接底板图形，数量和名称说明用引用线说明。

用的过程中有问题可以随时问我。

### 2021-07-04

建筑设计流数据一体化V0.1版

各位：

建筑设计流第一个模块可以使用了。泄压面积自动计算及生成示意图（T3 版），贡献者：李奕峥、华丽萍、经圣杰、汤蕾蕾、吴聪。

使用说明如下（后续会放到官方文档）：

### 01. 插件加载

1、存放插件。将压缩包「dataflowcad.rar」直接解压到 D 盘，解压后的文件夹一定要放在 D 盘下（即确保文件夹 dataflow 是直接在 D 盘下的），因为有些文件路径在插件里是写死的。

2、加载菜单插件。输入命令「menuload」，点击「浏览」按钮，选中插件文件夹中的文件 dataflow-js.cuix 加载（各个专业加载的不同），以后再打开 CAD 会自动加载该菜单。

3、加载命令插件。1）输入命令「appload」，加载插件 dataflow.VLX（各个专业加载同一个文件）。2）设置 CAD 启动后自动加载。还是在刚刚加载命令的界面里，点击右下角「启动组」上的「内容」。在启动组里将添加命令插件。

### 02. 泄压计算模块说明

泄压计算模块涉及到 3 个命令，菜单栏和工具栏里都可以看到。

1、生成泄压相关底图。点击该按钮后，会在右侧生成跟泄压计算相关的底图，主要包括：门、窗、泄压墙、柱子等。

注意事项：泄压墙请放到你们常规使用的「WALL-MOVE」图层。

2、划分泄压区域。此按钮与 PL 命令使用一模一样，先把要计算的泄压分区划分出来。

注意事项：要形成一个闭合的多段线。

3、泄压面积计算。长径比超后目前只开发了自动切割成 2 个分区。

初始输入数据：1）泄压比（0.11、0.2、0.25）。2）板底层高和梁底层高。

3.1 拾取泄压分区并自动计算。

点左下角的「拾取泄压分区」按钮选择自己之前划分的泄压闭合 PL 线。

按柱网切割：拾取后会自动计算长径比和泄压面积。一旦泄压面积超过 3，程序后一个跨距一个跨距的移动，把切割成 2 个泄压分区所有长径比同时满足小于 3 的方案找出来，去长径比最接近的为最优解。同时将 2 个分区的计算泄压面积单独计算出来。

按每 0.5m 切割：按跨距切割颗粒度太大，可能会错过 2 个分区长径比同时小于 3 的方案。此时在右上角的「分割方式」切换到「按 0.5m 分割」，程序会每 0.5m 一个个去分割，找长径比同时满足 3 的方案。

人工切割：如果按每 0.5m 切割还是找不到方案，说明 2 个分区无法满足长径比同时满足 3，此时可在左侧的「模式」里切换到「人工分割」，重新选择泄压分区 PL 闭合线，在切割点输入框内输入不同的切割点，不断更新计算确认人工要分割的位置。

3.2 计算实际泄压。

点面板底部「计算实际泄压」按钮，框选泄压分区边缘的门、窗、泄压墙、柱子，程序会自动计算成每个分区的实际泄压面积，显示每个分区的实际泄压边长。

注意：已经考虑了导出的 T3 图纸泄压墙是断线、不断线的情况，针对不断线的情况，泄压边长会自动把在穿泄压墙上的柱子边长减掉。

3.3 生成泄压简图。

设置要缩小实际尺寸的比例，目前默认设置的为 0.3。选择面板底部「生成泄压简图」按钮，随便选择一个插入点即可生成泄压分区示意图。除了常规显示的信息，我将 2 个分区的泄压比、实际泄压边长、切割点位置也一起生成了，供查看。

最后，在此特别感谢李奕峥，往往第一个模块很重要，因为有一个具象的东西，当你看到数据流能实现到什么程度后，大家才更容易想到还有哪些东西可以自动化、半自动化，减少重复工作。

使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）也可以先找李奕峥、华丽萍演示，他俩之前用过。