## 课题申报内容

在罐区的给排水设计工作中，给排水专业需要根据工艺专业提供的储罐物料水溶性、储罐形式以及尺寸等条件来确定泡沫混合液的供给强度、连续供给时间等，确定好相关参数之后可以计算出泡沫液的流量，进而进行泡沫产生器以及泡沫比例混合装置的选型。就我们公司的项目而言，工艺常用的储罐一般为固定顶储罐以及内浮顶储罐，使用的泡沫灭火系统种类相对较少，主要为低倍数泡沫灭火系统。针对这种情况，泡沫灭火系统的计算流程就具有了模块化的可能。

在储罐泡沫灭火计算设计模块中，通过读取工艺专业输入的储罐参数，程序可以用编辑好的公式得出给排水专业所需要的设计参数，减少了设计人员手动计算的时间。同时由于储罐类型相对较少，可以建立一个储罐泡沫灭火系统的图纸库，其中包含了我们公司项目所涉及到的储罐类型，以及所采用的的泡沫灭火系统。这样不仅可以导出给排水设计所需的参数，还可以导出储罐所对应的泡沫灭火系统大样图，其中储罐的大样图可以引用工艺专业的数据库。

综上所述，有必要对建立一个储罐泡沫灭火计算设计模块，以减少给排水专业的重复计算以及画大样图的工作，提高储罐给排水设计的效率。

本课题成果为开发出基于 excel 和 CAD 的应用插件，内容为可燃液体立式储罐泡沫灭火计算设计一体化模块。可以实现在 excel 上完成对各可燃液体立式储罐的设计参数输入和计算，导出泡沫系统计算结果并自动生成储罐泡沫产生器安装大样图。

## 开发过程记录

工艺专业：

1、工艺流程图提取数据 => 供给排水用的计算条件Excel。该 Excel 表可在罐区消防平面图上生成给排水的「设备一览表」。

给排水专业：

1、生成消防水量计算书模板（带有工艺数据）。

2、用户填数据。

问题：1）Excel 的哪些数据可以直接从规范里读取。

3、生成泡沫产生器安装大样图。

泡沫产生器以及泡沫比例混合装置的选型。低倍数泡沫灭火系统。

问题：1）没有图签？2）一个罐一张图纸还是同一类型一个图纸。3）大图里哪些数据是变量抽出来；哪些数据是通过计算书里的数据来的。

夏老板回复：

1、一个类型一个图。

2、拿到一个成品。

3、每个发生器的设备参数尺寸。根据设备参数。

细节汇总：

1、节点按 2500 分割。

2、提供类似的「管口方位图」。

需要给排水再提供的数据库：

1、不同型号对应的设备参数数据库。

2、法兰的数据库。

3、提供类似的「管口方位图」成品。最好一个整体性的成品。

### 交流记录

2021-09-29

1、基础高度是可变的，从工艺条件里提取。工艺的那个 Excel 表加一列。

补充：11.01 提供的成品模板里是没有体现基础高度信息的，是否是取消不体现了，确认一下。（2021-11-07）

2、储罐消防泡沫进口管，后面的不要了，就画到进罐子那个金属软件那边。

3、地坪标高的数据。可能是 ±0.00 也可能是 -0.20，可以考虑把这个数据作为全局参数，生成成品图纸的时候在面板里下拉做选择。

此项作为后续优化项。

4、管壁上泡沫立管。

节点的设置个数。不超过 3m 或 2.5m，均布。

夏老板：就按 2500 来均布好了。这里有个主意的，上面装泡沫产生器的地方，其支撑节点是固定尺寸的，那边设好后，接着往下走再按 2500m 来分布设置节点支撑。

竖向上，管壁到泡沫发生器的高度 250，这个值是跟泡沫发生器的规格挂钩的；横向上，离管壁的间距 L 是 250，也是跟泡沫产生器的规格挂钩的。

5、一个罐四周会有多个泡沫发生器（附带泡沫立管）。

采用管口方位图来表示。

夏老板：定泡沫发生器的个数以及角度，自动生成类似的管口方位图。

6、下面的非水溶性的图跟上面的水溶性图，有啥区别。

就泡沫发生器泡沫出口的那个挡板不一样，水溶性的是「缓释罩」，非水溶性的是「导板」。

要达到的效果：水溶性的生成缓释罩的图形样式，非水溶性的生成导板的图形样式，并且在旁边用文字备注。

补充：老的模板里，泡沫发生器单独画了个小详图，挡板的信息在这里。而第二次提供的成品模板里，取消了小详图，直接在储罐那边表示的。（2021-11-07）
 
7、需要给排水再提供给我的数据库。

汇总：1）不同型号对应的设备参数数据库。2）法兰的数据库。3）提供类似的「管口方位图」成品。最好一个整体性的成品。

### 后端实现逻辑

1、存数据：1）VBA 提取数据。2）存数据接口。

返回的数据结构：

01 流程图大组数据

1、每条数据增加图号字段（drawNum），图号信息根据对整个数据分组顺延递增 1、2、3、4。

分组逻辑，每条数据里：直径、高度、水溶性情况，3 个字段完全相同的分为一组。

2、每条数据增加字段，俯视图类型（topViewType）

前面分好组后，每个组里，组内每条数据的字段图视图是否镜像（mirrorStatus），全部为「是」的，该字段赋值为「TankFFTopView-Common」；全部为「否」的，该字段赋值为「TankFFTopView-Mirror」；既有是也有否的，赋值为「TankFFTopView-All」。

02 主体图形数据/俯视图图形数据

1、ss_module_graph，提取 module_type 为 TankFFMain 的数据。

1、ss_module_graph，提取 module_type 为 TankFFTopView-Common、TankFFTopView-Mirror和 TankFFTopView-All 的数据。

返回的总数据为：流程图大组数据、主体图形数据和俯视图图形数据，三大块数据的总和。

俯视图消防泡沫算法：

1、半截中心线和泡沫做成一个块。

2、按个数循环多少次，用repeat，旋转角度按360/个数递增。

1、P L4对应的法兰进出口参数，Java实现。

1、给俯视图园打一个xdata标签；过滤出园拿到圆的中心点。
