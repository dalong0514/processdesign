## 01. 单项功能

### 1.1 无损检测

方全利：无损检测数据，比如筒体，只要填一个检测率，其他数据（等级技术、检测标准、合格级别）都可以匹配出来。

叶菁：检测比例按焊接接头系数取，焊接接头系数 1.0 的，100% RT-II，其余 20% RT-III。

需求表（2021-06-08）中的无损检测：

1、筒体公称直径小于等于 1200 的椭圆封头：焊接接头系数取 1.0，检测率技术等级检测标准合格级别为一整行，标记为「整板制作」。

2、筒体公称直径大于 1200 的椭圆封头：焊接接头系数取 0.85，检测率 20%，技术等级 AB 级，检测标准 NB/T47003.2-2015，合格级别 RT-Ⅲ。

3、筒体公称直径大于 1200 的椭圆封头：焊接接头系数取 1.0，检测率 100%，技术等级 AB 级，检测标准NB/T47003.2-2015，合格级别RT-Ⅱ。

4、筒体公称直径小于 400 或者等于 400 的管材：筒体焊接接头系数取 1.0，检测率技术等级检测标准合格级别为一整行，标记为「整根制作」。

### 1.2 图形数据库

从 HGCAD 里薅图形数据。

设备法兰相关：

目前只做设备法兰的，垫片先不弄了。设备法兰需要的组合如下：

1、三个规范都要（JB/T4701-4703）。

2、只需要 RF 密封面的。

3、只需要主视图和俯视图。

4、不同的公称压力都做。

5、厚度默认按 8mm。

6、不同筒体直径的。

### 1.3 工程图重量计算模块逻辑

1、筒体重量。

中径 (mm) X 厚度 (mm) X PI X H (筒体长度) X 7850 (CS) 或者 7930 (SS)/10^9。

问题：1）中径的概念；2）算出的单位是 kg。

回复：中径是内径加上一个壁厚；按上面公式算出来的单位是 Kg。

2、封头重量。

查数据库。

壁厚没有的话，取平均值。比如壁厚 6 对应重量 100，壁厚 8 对应重量 200，那么用此方法，壁厚 7 对应的重量为 150。

补充：1）误解了，不是壁厚取平均值，壁厚都是按 6、8 这些整数值的，是筒体直径可能不是整数。2）换个实现方式，数据库里把筒体按 10mm 分割，所有的数据都先做成库，直接查表。其实可以按 50 分割，比如直接 1210 的情况很少的。（2021-12-05）

3、接管法兰重量。

查数据库。

普通法兰：

接管重量：1）计算公式同筒体计算公式；1）管子的壁厚按工艺管道等级号里的数据。

法兰盖重量：每个备用口配一个法兰盖。

人孔手孔重量：目前设备专业手动查数据填写。

补强圈重量：DN50 及以上的管口都查表补强圈的重量。

确认：工艺条件里没有仪表口的尺寸数据。（备注一下，先不做仪表的口，反正会导出一个中间文件）

4、支座重量。

查数据库。

支座数量：1）支腿式，规范里表格特定筒体直径、型号的支腿，数量是固定的。2）支耳的数量，筒体直径小于等级 300 的设 2 个支耳，大于 300 的设 4 个支耳。3）鞍座：按 2 个考虑，有极少情况下是 3 个，3 个的话安装角度都不一样，目前不考虑。4）支撑式：目前无法定死，设备人员自己输数量，支座数据Sheet里增加一列支座数量。

5、设备法兰重量。

查数据库。

需要三个信息：1）设备法兰形式：甲型平焊、乙型平焊、长颈对焊；2）压力等级；3）密封面形式：平面、凹面、凸面等。

实现逻辑：1）主数据表增加字段「是否包含设备法兰」，是的话才去匹配重量数据。2）增加一张设备法兰数据 Sheet，  包含的属性字段：设备位号、设备法兰型式、压力等级、密封面形式、设备法兰对数。

6、其他（人工填写）。

## 02. 非标设备条件相关

2021-07-21

非标设备条件改进：

1、用户不用输管嘴位置信息，默认生成，自己移过去。—— 已完成

2、容积信息放左上角。—— 已完成

3、设备材质。设备材质自动写到其他要求里去（待敲定）。—— 已完成

4、卧式罐管嘴偏移。

3、底部管嘴距离地面高度，标注。

2021-11-07

1、流程图里自己插管口图形，只导出有管口的设备条件。

1、温度计、液位计口放侧面。—— 已完成

1、新功能：绑定管口，流程图里刷。

2021-11-17

1、立式储罐直接关联耳式支座；卧式关联鞍座。—— 已完成

1、支座标准号匹配。—— 已完成

2021-12-05

1、鞍式支座的重量取值，何时取带垫板何时取不带垫板。待确认。

2021-12-07

1、设备法兰是「是」的，设备法兰数据表里没数据。

1、Excel 表里净重小数点保留 2 位。—— 已完成

2021-12-10

叶菁反馈意见：

1、Excel 工程图里，工艺数据有变动的话用不同颜色标出来。

2、设备法兰是否有，工艺设备条件图里增加一个表格。

3、设计温度、设计压力，有些设备是有特殊要求的，是工艺这边提的。目前定的：毕竟是少量的设备需要（其实一个项目里要么没有，要么有很多），就不在工艺的 Excel 表格里填了，直接在生成的工艺设备条件图纸里的表格里修改。

4、重量清单表格里，字段显示中文名修改，人孔手孔重量（设备填）、其他重量（设备填）。—— 已完成

5、Excel 重量清单表，重量数据保留小数点后两位；CAD 里的重量数据，网上圆整到 5 或 0。

6、顶部管口的定位设备专业自己移动；筒体侧管口定位，工艺条件图里管口块与上封头直线的距离自动提取（前提图形是 1 比 1 画的）。

2021-12-14

叶菁整理的内容：

1、工艺提交给设备后，又有改动的，变动处 Excel 红色另外标出。

2、关于设备法兰是否设置，工艺条件里增加一项，可以由工艺填也可以由设备填。工艺条件里空白，就是工艺没有设置，由设备来判断。

3、设计压力、设备温度，如果工艺有要求，由工艺填写；工艺条件里空白，由设备来判断。

4、人孔手孔重量由设备选型后填；其他重量设备填。

5、Excel表的重量保留小数点 2 位；工程图中重量向上圆整到整数的 5 或 0。

6、筒体侧管口的定位，由工艺 1:1 绘制后，从条件图里管口块与上封头焊缝线的距离自动抽取，不用设备填写。

7、封头上的接管中心圆，工艺没有要求的，由设备填写。

8、接管外伸长度，先按标准外伸长度根据保温层厚度设置，保温设备的接管外伸长度是否满足间距要求暂由设备人工判定，待后续大龙进行逻辑优化。

叶菁整理的内容：（2021-12-15）

7、工程图数据表，介质特性留白，由设备核对。

8、管口外伸长度设置默认值。—— 已完成

1『详见下面的其他细节里的实现逻辑。（2021-12-17）』

9、工艺给设备的条件更新后，除标记颜色外，其他设备已填的内容应该。

10、设备填写外伸长度，程序自动生成到中心线距离或是到封头焊缝线距离。

2021-12-16

1、缩放比例根据高度来调整。—— 已完成

## 03. 其他细节

1、筒体直边高度的确定。

跟筒体的直径相关。标准封头的直边段高度，筒体直径小于等于 2000 是 25mm，筒体直径大于 2000 直径的是 40mm。

2、支腿、支耳型号常识。

支腿是有 2 大类的，有垫板的 A 型和无垫板的 AN 型。

支耳只有有垫板的 A 型、B 型、C 型。

3、管口伸出长度。

管嘴做成动态块，长度和宽度参数化。暂时不跟实际数据关联，设备管嘴伸出长度是要计算的。工艺设备条件里没必须写伸出长度，写了设备也不是按这个来，都是计算出来的。

HGT 20583-2020文档页码27页的表格做成数据库，根据字段「设备保温材料」和「管口公称直径」2 个字段去查表获得管口的伸出长度。

如果设备保温材料为空，匹配的数据参考最小厚度（50-75）的数据，有区别的地方在于：管径小于 50 的管口，伸出长度取 120，其他数据参考表格内的。
