## 01. 单项功能

### 1.1 无损检测

方全利：无损检测数据，比如筒体，只要填一个检测率，其他数据（等级技术、检测标准、合格级别）都可以匹配出来。

叶菁：检测比例按焊接接头系数取，焊接接头系数 1.0 的，100% RT-II，其余 20% RT-III。

需求表中的无损检测：（2021-06-08）

1、筒体公称直径小于等于 1200 的椭圆封头：焊接接头系数直接取 1.0，检测率技术等级检测标准合格级别为一整行，标记为「整板制作」。

2、筒体公称直径大于 1200 的椭圆封头：焊接接头系数 0.85 的话，检测率 100%，技术等级 AB 级，检测标准 NB/T47003.2-2015，合格级别 RT-Ⅲ。

3、筒体公称直径大于 1200 的椭圆封头：焊接接头系数 1.0 的话，检测率 100%，技术等级 AB 级，检测标准NB/T47003.2-2015，合格级别RT-Ⅱ。

4、筒体公称直径小于 400 或者等于 400 的管材：筒体焊接接头系数取 1.0，检测率技术等级检测标准合格级别为一整行，标记为「整根制作」。

之前的逻辑是有问题的，重新梳理。筒体检测率和封头的检测率是分开的：（2022-03-15）

筒体检测的逻辑：

先确定是管材还是板材，直径小于 400 或者等于 400 的管材：筒体焊接接头系数取 1.0，检测率技术等级检测标准合格级别为一整行，标记为「整根制作」。直径大于 400 的是板材：1）筒体焊接接头系数是 1.0 的话，检测率 100%，技术等级 AB 级，检测标准NB/T47003.2-2015，合格级别RT-Ⅱ。2）筒体焊接接头系数是 0.85 的话，检测率 20%，技术等级 AB 级，检测标准 NB/T47003.2-2015，合格级别 RT-Ⅲ。

封头检测的逻辑：跟之前的逻辑一样。注意：封头的检测率都是 100%，之前没注意到这个细节。

补充：直径 400 的不一定都是用的管材，有些业主不听设备专业的，非要用卷材。

### 1.2 图形数据库

从 HGCAD 里薅图形数据。

设备法兰相关：

目前只做设备法兰的，垫片先不弄了。设备法兰需要的组合如下：

1、三个规范都要（JB/T4701-4703）。

2、只需要 RF 密封面的。

3、只需要主视图和俯视图。

4、不同的公称压力都做。

5、厚度默认按 8mm。

6、不同筒体直径的。

### 1.3 工程图重量计算模块逻辑

1、筒体重量。

中径 (mm) X 厚度 (mm) X PI X H (筒体长度) X 7850 (CS) 或者 7930 (SS)/10^9。

问题：1）中径的概念；2）算出的单位是 kg。

回复：中径是内径加上一个壁厚；按上面公式算出来的单位是 Kg。

2、封头重量。

查数据库。

壁厚没有的话，取平均值。比如壁厚 6 对应重量 100，壁厚 8 对应重量 200，那么用此方法，壁厚 7 对应的重量为 150。

补充：1）误解了，不是壁厚取平均值，壁厚都是按 6、8 这些整数值的，是筒体直径可能不是整数。2）换个实现方式，数据库里把筒体按 10mm 分割，所有的数据都先做成库，直接查表。其实可以按 50 分割，比如直接 1210 的情况很少的。（2021-12-05）

3、接管法兰重量。

查数据库。

普通法兰：

接管重量：1）计算公式同筒体计算公式；1）管子的壁厚按工艺管道等级号里的数据。

法兰盖重量：每个备用口配一个法兰盖。

人孔手孔重量：目前设备专业手动查数据填写。

补强圈重量：DN50 及以上的管口都查表补强圈的重量。

确认：工艺条件里没有仪表口的尺寸数据。（备注一下，先不做仪表的口，反正会导出一个中间文件）

4、支座重量。

查数据库。

支座数量：1）支腿式，规范里表格特定筒体直径、型号的支腿，数量是固定的。2）支耳的数量，筒体直径小于等级 300 的设 2 个支耳，大于 300 的设 4 个支耳。3）鞍座：按 2 个考虑，有极少情况下是 3 个，3 个的话安装角度都不一样，目前不考虑。4）支撑式：目前无法定死，设备人员自己输数量，支座数据Sheet里增加一列支座数量。

5、设备法兰重量。

查数据库。

需要三个信息：1）设备法兰形式：甲型平焊、乙型平焊、长颈对焊；2）压力等级；3）密封面形式：平面、凹面、凸面等。

实现逻辑：1）主数据表增加字段「是否包含设备法兰」，是的话才去匹配重量数据。2）增加一张设备法兰数据 Sheet，  包含的属性字段：设备位号、设备法兰型式、压力等级、密封面形式、设备法兰对数。

6、其他（人工填写）。

## 02. 意见收集记录

### 2021-07-21

非标设备条件改进：

1、用户不用输管嘴位置信息，默认生成，自己移过去。—— 已完成

2、容积信息放左上角。—— 已完成

3、设备材质。设备材质自动写到其他要求里去（待敲定）。—— 已完成

4、卧式罐管嘴偏移。

3、底部管嘴距离地面高度，标注。

### 2021-11-07

1、流程图里自己插管口图形，只导出有管口的设备条件。

1、温度计、液位计口放侧面。—— 已完成

1、新功能：绑定管口，流程图里刷。

### 2021-11-17

1、立式储罐直接关联耳式支座；卧式关联鞍座。—— 已完成

1、支座标准号匹配。—— 已完成

### 2021-12-05

1、鞍式支座的重量取值，何时取带垫板何时取不带垫板。待确认。

### 2021-12-07

1、设备法兰是「是」的，设备法兰数据表里没数据。

1、Excel 表里净重小数点保留 2 位。—— 已完成

### 2021-12-10

叶菁反馈意见：

1、Excel 工程图里，工艺数据有变动的话用不同颜色标出来。

2、设备法兰是否有，工艺设备条件图里增加一个表格。

3、设计温度、设计压力，有些设备是有特殊要求的，是工艺这边提的。目前定的：毕竟是少量的设备需要（其实一个项目里要么没有，要么有很多），就不在工艺的 Excel 表格里填了，直接在生成的工艺设备条件图纸里的表格里修改。

4、重量清单表格里，字段显示中文名修改，人孔手孔重量（设备填）、其他重量（设备填）。—— 已完成

5、Excel 重量清单表，重量数据保留小数点后两位；CAD 里的重量数据，网上圆整到 5 或 0。

6、顶部管口的定位设备专业自己移动；筒体侧管口定位，工艺条件图里管口块与上封头直线的距离自动提取（前提图形是 1 比 1 画的）。

### 2021-12-14

叶菁整理的内容：

1、工艺提交给设备后，又有改动的，变动处 Excel 红色另外标出。

2、关于设备法兰是否设置，工艺条件里增加一项，可以由工艺填也可以由设备填。工艺条件里空白，就是工艺没有设置，由设备来判断。

3、设计压力、设备温度，如果工艺有要求，由工艺填写；工艺条件里空白，由设备来判断。

4、人孔手孔重量由设备选型后填；其他重量设备填。

5、Excel表的重量保留小数点 2 位；工程图中重量向上圆整到整数的 5 或 0。

6、筒体侧管口的定位，由工艺 1:1 绘制后，从条件图里管口块与上封头焊缝线的距离自动抽取，不用设备填写。

7、封头上的接管中心圆，工艺没有要求的，由设备填写。

8、接管外伸长度，先按标准外伸长度根据保温层厚度设置，保温设备的接管外伸长度是否满足间距要求暂由设备人工判定，待后续大龙进行逻辑优化。

叶菁整理的内容：（2021-12-15）

7、工程图数据表，介质特性留白，由设备核对。

8、管口外伸长度设置默认值。—— 已完成

1『详见下面的其他细节里的实现逻辑。（2021-12-17）』

9、工艺给设备的条件更新后，除标记颜色外，其他设备已填的内容应该。

10、设备填写外伸长度，程序自动生成到中心线距离或是到封头焊缝线距离。

1『叶菁手绘了一张焊缝线长度的计算公式图片，存在专项功能文件夹下面的。（2022-05-11）』

### 2021-12-16

1、缩放比例根据高度来调整。—— 已完成

2、塔器的条件与储罐差别还是很大的，需要补充地震，风压，内件，变径段设置等很多内容。且有填料塔和板式塔的区别。

汪兵新和成有很多塔器，我到时整理好意见发给你。

### 2022-03-08

1、管口标记超出框了。比如框内的文字是 L1ab。—— 已修改

解决方法：把管口离的文字宽度调小。

2、图形与图框重合。—— 已修改

备注：截图显示，是卧式储罐左侧跟图框碰牢了。调整卧式储罐插入定位点的位置。

回复：1:1 的图框里，原来的定位点 X 轴左移动 583，现在卧式罐调整为左移动 543。（2022-05-12）

3、尺寸标记按比例拉开，间距 10mm。—— 已修改

备注：比例标注之间的间距。

4、文字标注放图形外面，不要碰尺寸线和图形。

备注：右侧封头的文字标注，椭圆封头，文字的位置移动到外侧。

5、椭圆封头，红色中心线往外伸出 5mm。

6、中心线的比例应按图形比例调整，否则打印时，太密集显示不出是中心线。

7、中心线伸出图形太长，下部尺寸线标注不应伸入图形之中。

备注：指的是，鞍式支座块里的中心线，顶部伸出太长了，调小一些。

8、标注文字：接地板，引出线太长，而且改不了。

备注：应该是做成了一个块，可以改为动态块。

9、实线交叉，图形里面应用虚线或者切线掉。

备注：图示里，是接地板与支座块交叉了，把接地板的块做一个区域覆盖，盖在支座块上。

10、封头直径 2200，厚度 10，598 应为 2200/4+40+10=600。

备注：封头尺寸的标注，用封头壁厚计算后填充到标准里的替换文字内。

11、带法兰盖的图形，跟常规管口相比，是多一条线的。

备注：把管嘴法兰图形做成动态块，自动切换为普通法兰和带法兰盖的。

12、外部定位尺寸在图形里面是不允许的。

备注：图示里，侧面有人孔导致的。比如侧面标注，标注里筒体的间距是 10，结果人孔往外突出来 10，跟标注碰了。

### 2022-03-10

1、立罐封头标注线应延长至中心线。上封头对的，下封头不对。

图示里，连续标注，最底部是定位封头的距离，标注的起点改到封头顶部的中心点。

2、支腿处补充备注。

比如上部文字：4-A4，均布；下部文字：支座 NB/T47065.2-2018。

3、内径定位的黄线不能显示出线型，对小直径设备，黄线太长。

4、V101 立式设备，Excel 这几个口外伸 120，图形显示 150。

备注：外伸长度还没做成数据驱动。

5、接地板与 A 型支腿配合时，应紧贴支腿外侧。

6、立罐的标注尺寸间距不应大于 10 乘以图形比例。尺寸间距之前逻辑是写死的，后面全部改成按图纸比例 x10；上次只把卧式罐下部的标注改了。

7、检测率对应的射线等级不对，当焊接接头系数是 0.85 时，对应 RT-III 级，当焊接接头系数是 1.0 时，对应 RT-II 级或者 (封头直径小于等于 1200 不检测)。

8、换热器图表简单，但里面的计算和图形比较复杂，你们还是要花时间研究一下，不像容器这么简单。

### 2022-04-26

1、管口表里，液位计的定位，表格里只有 1 个管口定位，实际有 2 个上下布置，有没有办法表示。管口表里，液位计口都是成对出现的，如果改为 2 行，可能有问题。

2、支承式支座高度，由设备提供距下封头最低点高度，电脑直接算。

1『设备输入的位置点待确认。（2022-07-01）已经确认：支撑式支座，Excel 表输入高度的值是支座底板到焊缝线的位置，但设备专业需要额外标注一个尺寸，支座底板到支座与下封头相交的点，这个标注需要程序自动计算标注上去。（2022-07-01）』

3、腿式 A 型支座重量需加上垫板重量，垫板厚度同筒体。

4、支座重量应按支座高度调整。

5、重量表里加一项人手孔补强圈质量。

6、支腿的数量和型号标记没有。

7、地脚螺栓中心圆尺寸没有。

8、气密性试验，小数位数，取 1.0，或者 1.25。

9、管口表 * 伸出长度系指法兰密封面至筒体外表面或封头焊缝线之间的距离。程序里填的，和表格里数据都是外伸长度，两者要经过转化。

### 2022-05-11

1、充水重量和操作重量，按之前给的 2 个公式计算。重量清单表里增加这两个字段。

### 2022-06-22

1、字体样式和高度修改。

叶菁找到了中引文一样高的字体 ascii，因这个样式的字体偏小，字高从 4 更改为 5。但存在上下标无法显示的情况。

2、工程图改为双线画法。带支座底板尺寸、表格不用管。

### 2022-07-06

做换热器工程图过程中的问题确认。

1、B 型支腿，有 2 个垫板待确认。回复：是的，一个是与筒体接触，一个是与封头接触。

2、鞍式支座的垫板，弧长和宽度 b 对应于垫板长和宽。回复：是的。

3、单位重量计算的和表里的差别比较大。回复：型号不同，本来就差别比较大。

4、支承式支座的 B 型，垫板是圆形的。乘以 0.785 做个转换，转为等价于计算一个矩形的面积。

5、材质能不能简化直接为不锈钢。不锈钢 7930、碳钢 7850。回复：还是不要简化，体积大的差别蛮大的。

6、支座和垫板重量的确认。回复：详见支座和垫板重量的计算逻辑，基本思路在于获得一个单位高度的支座重量。

7、管口长度的表示方式。回复：1）Excel 表里的伸出长度填的值为：接管底部到法兰面的距离，其实应该是到法兰凸台的距离，简化为到法兰面。2）生成的工程图表格里的管口伸出长度，是法兰面到设备面的距离。对于筒体上的接管法兰，法兰面到筒壁；对于封头上的接管法兰是法兰面到焊缝线的距离。

## 03. 其他细节

1、筒体直边高度的确定。

跟筒体的直径相关。标准封头的直边段高度，筒体直径小于等于 2000 是 25mm，筒体直径大于 2000 直径的是 40mm。

2、支腿、支耳型号常识。

支腿是有 2 大类的，有垫板的 A 型和无垫板的 AN 型。

支耳只有有垫板的 A 型、B 型、C 型。

3、管口伸出长度。

管嘴做成动态块，长度和宽度参数化。暂时不跟实际数据关联，设备管嘴伸出长度是要计算的。工艺设备条件里没必须写伸出长度，写了设备也不是按这个来，都是计算出来的。

HGT 20583-2020文档页码27页的表格做成数据库，根据字段「设备保温材料」和「管口公称直径」2 个字段去查表获得管口的伸出长度。

如果设备保温材料为空，匹配的数据参考最小厚度（50-75）的数据，有区别的地方在于：管径小于 50 的管口，伸出长度取 120，其他数据参考表格内的。

