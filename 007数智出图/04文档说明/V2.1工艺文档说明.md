## 公共使用说明

## 01. 插件加载

1、存放插件。将压缩包「dataflowcad.rar」直接解压到 D 盘，解压后的文件夹一定要放在 D 盘下（即确保文件夹 dataflow 是直接在 D 盘下的），因为有些文件路径在插件里是写死的。

2、加载菜单插件。输入命令「menuload」，点击「浏览」按钮，选中插件文件夹中的文件 dataflow.cuix 加载（各个专业加载的不同，此为工艺专业加载的菜单插件），以后再打开 CAD 会自动加载该菜单。

暖通专业加载 dataflow-ns.cuix。

3、加载命令插件。1）输入命令「appload」，加载插件 dataflow.VLX（各个专业加载同一个文件）。2）设置 CAD 启动后自动加载。还是在刚刚加载命令的界面里，点击右下角「启动组」上的「内容」。在启动组里将添加命令插件。3）启动组添加插件后如果还是自动加载不了命令，请用 360 查杀一下自己电脑里的「acaddoc.lsp」病毒，清除一下即可。

4、使用插件。加载插件后，CAD 顶部菜单栏会出现「数据流」菜单，点开即可使用各个模块的提取数据功能。

![](http://192.168.1.38:8081/Images/V1.3-02.gif)

## 02. 数据流工具栏

目前数据流的所有命令基本都集成到了工具栏。如果没有显示工具栏，鼠标放在工具栏的任意空白位置，右键会弹出 CAD 工具栏的选项卡，选择数据流「DATAFLOW」勾选各个子选项，详见下面的动图。。

![](http://192.168.1.38:8081/Images/V2.0-01.gif)

备注：1）最好把数据流的文件路径添加到 CAD 搜索路径中。具体操作：输入命令「op」进入设置里，在「支持文件搜索路径」里添加路径「D:\dataflowcad」。2）数据流涉及到的属性块，都在文件下「cadElement」下面。

## 03. 网页软件相关

内网地址：192.168.1.38；外网地址：wukong.hg101.vip。

注意：一定要使用谷歌的 Chrome 浏览器，IE 是不行的。请找信息技术部的楼一强安装 Chrome。

登录后，进入各模块，上传从 CAD 导出的 txt 文件，看到「上传成功」弹窗后点击各个「导出」按钮。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）



## 工艺专业使用说明

## 流程图相关说明
 
## 01. 保留老版流程图数据的前提下使用新版的属性块

截至此版本，数据流涉及的属性块汇总如下。1）设备相关块：Reactor、Tank、Pump、Heater、Centrifuge、Vaccum、Custom。2）仪表相关块：InstrumentP、InstrumentL、InstrumentSIS。3）管道相关块：PipeArrowLeft、PipeArrowUp。4）外管相关块：OuterPipeLeft、OuterPipeRight。

数据同步具体方法：

1、将老版图纸整体拷进新版属性块模板里。模板文件路径：dataflow => allBlocks => GsLcBlocks.dwg。

2、点击数据流菜单里的「帮助 => 一键同步数据流属性块」，该功能可以同步除了管道块之外的所有数据流数据。

3、若需要同步管道数据，命令「BATTMAN」进入块属性管理器。依次选中管道块 PipeArrowLeft、PipeArrowUp，点击右上角的「同步」按钮。

## 02. 自动生成流程图下的一排设备位号（贡献者陈李荔）

首先确保自己的流程图中含有「设备位号」属性块。具体操作：1）点击数据流菜单里的「自动生成设备位号」。2）框选该张流程图里的所有设备块。3）空格键后，选择一个插入位置即可自动生成。

## 03. 自动编号（贡献者汪晨、叶旭峰）

### 3.1 强化版自动编号（贡献者王禹谋、李恒）

V1.2 版本新增了强化本自动编号操作，基本可以舍弃老版编号了。

1、点击数据流工具栏里的「加强版自动编号V2」。选择自动编号的三大类数据：管道、仪表和设备位号。

2、管道和设备编号支持常规编号、按流程图编号。仪表编号支持常规编号、按流程图编号和按设备位号编号（前提条件：设备上的仪表其所在位置要填号设备位号；管道上的仪表其所在位置要填号管道号并且管道的来去向要填好设备位号信息）。

3、编号前缀的信息是嵌入在「代号」和「编号」之间的信息。

以管道编号为例：主物料代号 PL 正常编号是 PL01、PL02、PL03、PL04....，那么我想把单项号「02」嵌入进去，编号前缀填「02」后编出来的是 PL0201、PL0202、PL0203、PL0204....。

详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-03.gif)

## 04. 批量修改数据（贡献者曾涵卫）

### 4.1 新版批量修改数据

基本的操作逻辑：CAD 中精确筛选出要修改的数据 => 导入到 Excel 临时文件 => 批量修改后反导回 CAD。

以批量修改管道数据为例，仪表数据与设备数据同理。具体操作：

1、点击数据流菜单里的「数据提取 => 导出数据流临时 excel」或者直接在工具栏里找到「导出数据流临时 excel」。

2、点击导出数据。看到导出临时文件状态变为「已完成」后，系统会自动在 D 盘的「dataflowcad」文件夹下的「data」文件夹里，自动生成管道的 excel 数据文件。管道数据为：pipeData.csv，仪表的数据为：instrumentData.csv、设备的数据为各类设备的英文名文件。

3、打开文件后，在 excel 里输入、修改数据。Excel 常规的所有操作均可在该文件实施，比如做筛选、排序等等。

4、导入数据。Excel 临时文件修改数据后，点「导入数据」，导入临时文件状态变为「已完成」后，系统会自动读取刚刚的 Excel 临时文件，点「预览数据」可以确认修改后的数据。

5、确认修改。点击「确认修改」，修改状态变为「已完成」后表明数据已反写回 CAD。

备注：1）做安全专篇的设备表时，可以直接从设备 Excel 临时文件里拷。2）做安全专篇所需的仪表点位信息可以从仪表 Excel 临时文件里拷。

![](http://192.168.1.38:8081/Images/V1.0-13.png)

## 05. 图签自动编号，自动提取图号刷数据（贡献者王禹谋、张坤）

V2.1 新增：支持多行多列同时自动编图号。新功能使用的前提：同一行的所有图签必须放在一个水平方向（Y 轴定位必须一样）。

流程图图签自动编号，从图签自动提取图号，刷这张图里所有数据的「所在图号」属性。具体操作：

1、点击数据流菜单里的「自动编图签图号」。

2、点「选择图签」框选一排流程图的图签（目前只能一排一排的编号），比如示例图里选框了 11 张流程图图签，会自动提取目前图签里已有的图号数据。

![](http://192.168.1.38:8081/Images/V1.1-01.png)

3、输入图号的前面内容，比如 `S19A51-02-04-`，输入起始编号数字。起始编号如果小于 10 系统会自动在前面补上 0，如果从第一张流程开始编，填 1 或者 01 都可以。点「预览编号」，确认无误后点「确认编号」，编号状态显示「已完成」后，数据即写入了流程图图签。

![](http://192.168.1.38:8081/Images/V1.1-02.png)

## 06. 刷图纸里管道、仪表、设备所在图号的数据

新版（V2.1 新增）：

所在工具栏：流程-数据修改；所在菜单：数据修改 => 一键更新流程数据图号。

旧版：

点击「刷数据所在图号」，选取一个图签后空格，CAD 命令栏下会显示出你提取到的该图签图号，接着按提示选择整张图纸的数据。刷完数据后会自动返回到交互界面，左下角会显示刷完的状态以及所刷数据的数量。接着点「刷数据所在图号」继续刷下一张图的数据。

![](http://192.168.1.38:8081/Images/V1.1-03.png)

具体操作详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-02.gif)

## 07. 批量刷仪表「所在位置」数据

具体操作（V2.0 版本做了改进）：

1、点击数据流菜单里的「刷仪表所在位置」或工具栏里的命令。

2、按 CAD 命令栏的提示选择一个设备（或管道）以及所要刷的仪表。空格完后，系统会将你选择的位置（设备或管道）批量写到所选仪表块里的「所在位置」。

## 08. 批量刷管道的起点和终点数据

具体操作：

1、点击数据流菜单里的「刷管道起点和终点」。

2、按 CAD 命令栏的提示，1）选择管道起点，设备和管道均可选择。如果直接空格表示不修改管道起点，此场景针对于刷共用工程的管道，设备端的在 CAD 端刷，总管端的请在 excel 里批量改。2）选择管道终点。3）选择要刷的管道，可批量选择。直接空格后，系统会将你选择的起点和终点批量写进要修改的管道块里。

备注：V2.0 版本新增了只刷管道起点或终点的命令。刷设备上公用工程管道起点终点信息的一个技巧：先不管设备是在起点还是终点上，批量把管道的起点都刷成该设备位号。最后刷完后在临时 Excel 文件那边修改公用工程的起点是设备端还是终点是设备端。

## 09. 批量刷属性块内的数据

### 命令版

1、点击数据流菜单里的「数据修改 => 命令版刷块属性」。

2、选择要提取的数据块，只能选择一个块。

3、选择要刷的数据块，可多选，且可选到不同类型的任意块。

后台自动匹配与源数据块内属性值字段相同的数据，并将源数据块内的属性值刷给所选块。

### 界面版

针对一些可复用的数据（工作介质、温度、压力等），可提取所选择块内的数据，批量刷到其他块内。具体操作：

1、点击数据流菜单里的「数据修改 => 界面版刷块属性」。

2、选择要刷的数据大类：全部数据、仪表和管道、管道、仪表、设备。

3、选择要提取的数据，可按住 ctrl 键多选（跟 office 常规操作一样）。

4、在 CAD 图纸里选择要提取数据的块后，面板里会显示出所提取到的真实数据。接着选择要刷的块，系统会自动将提取的数据刷到所选择的块内。

![](http://192.168.1.38:8081/Images/V1.1-05.png)

## 10. 自动生成辅助流程组件（贡献者叶旭峰）

大家可以看到，画辅助流程所需的几个关键信息（管子所在图号、管子所接设备以及设备位号），前面的管道块内都有这些数据，那么辅助流程的组件即可自动生成。具体操作：

1、首先将模板里的「辅助流程组件」块拷到自己的流程图里。点击数据流菜单里的「自动生成辅助流程」。

2、选择自总管（比如氮气管），或者去总管（比如放空管）。

3、通过通配符筛选要生成的辅助流程管道，比如 `N*` 筛出氮气管道。接着点「选择插入点」，在图纸里即可自动生成辅助流程组件。

![](http://192.168.1.38:8081/Images/V1.1-06.png)

![](http://192.168.1.38:8081/Images/V1.1-07.png)

## 11. 自动生成跨流程图的接图小箭头，并一键更新

首先将模板里的「接图组件」块拷到自己的流程图里。点击数据流菜单里的「自动生成接图箭头」，具体操作详见下面的动图：

![](http://192.168.1.38:8081/Images/V1.2-04.gif)

作为数据源的管道数据更改后，只需使用数据流菜单里的「一键更新接图箭头」，即可同步更新数据。

## 12. 管道变等级变管径

1、点击数据流菜单里的「流程图辅助 => 刷变等级号信息」，或者直接用工具栏里的命令。

2、按 CAD 底部的提示，选择「变等级块」以及想要刷的管道（可多选）。空格后变等级号信息即被刷进管道块内，同一根管道导出的数据表会生成 2 个数据。

刷变管径信息同理，「流程图辅助 => 刷变管径信息」，或者直接用工具栏里的命令。

![](http://192.168.1.38:8081/Images/V1.3-01.gif)

## 13. 仪表自动拼接仪表控制点名称

仪表块的控制点名称属性（NAME）是可以自动拼接的。

### 常规逻辑

1、仪表块的 NAME 属性，你如果填的话，后台导出来的仪表条件以你填的为准。

2、如果空着的话，后台会自动拼接「仪表所在位置 + 仪表类型」。比如该仪表是个液位计，仪表块的所在位置填的是 V1101，那么导出来的仪表条件里，该仪表控制点名称后自动生成：V1101 液位。

### 隐藏逻辑

常规逻辑只能解决在设备上的仪表，而且设备不同位置也没法拼接的，比如反应釜内的和反应釜夹套的。如果仪表块的 NAME 属性，你填的信息里包含「拼接」这两个字，那么后台默认你知道你清楚隐藏功能，会走这条隐藏逻辑。分仪表所在位置是设备和管道的两种情况。

1、设备上的仪表。后台会自动拼接「仪表所在位置 + 你填的信息 + 仪表类型」。比如反应釜夹套上的一个温度计，仪表块的所在位置填的是「R1101」，控制点名称填的是「拼接夹套冷冻盐水」，那么导出来的控制点名称自动生成：R1101 夹套冷冻盐水温度。

2、管道上的仪表。后台会自动根据仪表所在位置的管道号去找这根管子的来去向信息，再进行拼接。

如果管子的两端都是设备，后台会自动拼接「从设备 A 到设备 B 的仪表类型」，比如一个开关阀，所在管道号 PL1101，PL1101 自 V1101 到 R1101，控制点名称填的是「拼接乙醇进口」，那么导出来的控制点名称自动生成：从 V1101 到 R1101 的开关阀。

如果管子的一端是设备一端是管道，主要是设备上放空、氮气、蒸汽、循环水等共用工程管道上仪表，后台会自动只提取管道来去向里设备的信息，自动拼接「设备 + 你填的信息 + 仪表类型」。比如储罐上氮气管的压力表，所在位置是管道 N1101，N1101 是自 N1001-65-2J1 到 V1101，控制点名称填的是「拼接氮气」，那么导出来的控制点名称自动生成：V1101 氮气压力。注意：管子来去向里一端如果是总管，不能填「氮气总管」这种，必须填写总管的管道号形式，管道号对不对无所谓，必须符合管道的形式「N1001-65-2J1 」，后台是根据这个形式来判断它是跟管子的。

备注：加「拼接」2 个字可以在临时文件里统一用 excel 的拼接函数实现，放在句首和句尾均可。

## 14. 设备临时件自动生成设备位号

通过设备的临时 Excel 文件自动生成流程图的设备位号以及流程设备图形块。具体步骤如下：

1、拿到业主的设备资料后，整理出需要的设备关键参数后，复制到各个设备的临时 Excel 文件。

2、点击菜单栏流程图绘制里「导入流程图设备位号及图形」或者工具栏里的相应按钮。

3、选择要导入的设备大类，可以按设备位号排序也可以按设备体积排序。点击「导入数据」按钮，状态变为「已完成」后在图纸里拾取一个插入点即可。

备注：自动匹配的设备图形库还未上线。

## 15. 画流程时自动生成仪表块

生成仪表块继承所在设备或所在管道的数据。除了常规的 copy 外，提供了另外一种画管道块和仪表块的方式。以设备（管道）为核心，生成的仪表块继承设备（管道）的部分数据。

V2.1 改进：

经使用反馈，自动生成的仪表会自动继承所在位置的介质、温度、压力等数据，但很多时候我们这几个数据会经常改。改进后的逻辑：自动生成的仪表只自动填充所在位置（设备位号或管道编号），而且支持自动更新（设备位号管道编号改了，仪表所在位置也可以一键更新）。介质、温度、压力等数据，如果跟设备或管道相同，只要空着，导成品时后台已经有功能可以去匹配关联的数据。所以自动生成的仪表填充所在位置信息即可。

## 16. 主物料管道的初始数据自动填充

管道的来源、去向这两个属性，只要填的是「设备位号」，那么可以自动填充来源设备里的「介质、温度、压力」3 个数据。有此初始数据后再根据实际情况做调整。

所在工具栏：流程-数据修改；所在菜单：数据修改 => 管道介质温度压力继承设备。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）



## 布置图相关

## 01. 迁移流程图设备数据到布置图

具体步骤如下：

1、点击菜单栏布置图辅助里的「提取流程设备数据」或者工具栏里的相应按钮。提取成功的话会弹出提示弹窗。

2、在布置图里，点击菜单栏布置图辅助里的「迁移流程设备数据」或者工具栏里的相应按钮。选择一个插入点即可生成对应的布置图设备位号，以及「设备平面图形」。

备注：目前设备外形图形库只做了立式储罐以及 B 型支耳的搪玻璃反应釜（开式及闭式）。如果设备尺寸匹配不到相应的「设备平面图形」，而你手里又有比较好的设备图形，请提供给我。此功能的实现，需要大家一起把手里比较好的、厂家提供的设备外形图块放在一个公共图形库里。

## 02. 同步布置图中设备的平面图形

设备布置图平面图形根据设备代号自动匹配更新。

具体步骤如下：

1、点击菜单栏布置图辅助里的「更新布置图设备块」或者工具栏里的相应按钮。

2、点击「导出数据」，导出状态指示已完成后，系统会自动在 D 盘的「dataflowcad」文件夹下的「data」文件夹里，自动生成布置图设备图形的 excel 数据文件。管道数据为：gsBzEquipData.csv。

3、打开 excel 数据表后根据情况更改「设备类型代号」。具体代号规则详见后文。

4、导入数据。Excel 临时文件修改数据后，点「导入数据」，导入临时文件状态变为「已完成」后，点击确认更新，即可更新布置图中设备外形图形。

### 设备代号规则

目前设备外形图形库只做了立式储罐以及 B 型支耳的搪玻璃反应釜（开式及闭式）。

立式储罐代号规则：字母 V 后面是体积，单位为 L；字母 D 后面是直径，单位 mm；字母 `LS` 代表立式。比如体积 500 L、直径 700 的立式储罐，其代号为：`V500D700LS`。

目前库里已有的储罐图形：V50D350LS、V100D400LS、V200D600LS、V300D600LS、V500D700LS、V600D800LS、V800D800LS、V1000D1000LS、V1500D1000LS、V2000D1200LS、V2500D1200LS、V3000D1400LS、V4000D1400LS、V5000D1600LS、V10000D2000LS。

搪瓷反应釜代号规则：字母 V 后面是体积，单位为 L；字母 D 后面是直径，单位 mm；字母 `KSB` 代表开式 B 型支耳，字母 `BSB` 代表闭式 B 型支耳。比如体积 5000 L、直径 1900 的开式 B 型支耳搪瓷反应釜，其代号为：`V5000D1900KSB`。

## 03. 设备临时件自动生成设备位号

通过设备的临时 Excel 文件自动生成布置图的设备位号以及设备图形块。具体步骤如下：

1、拿到业主的设备资料后，整理出需要的设备关键参数后，复制到各个设备的临时 Excel 文件。

2、点击菜单栏流程图绘制里「导入布置图设备位号及图形」或者工具栏里的相应按钮。

3、选择要导入的设备大类，可以按设备位号排序也可以按设备体积排序。点击「导入数据」按钮，状态变为「已完成」后在图纸里拾取一个插入点即可。

## 04. 迁移建筑底图到工艺设备布置图

基本思路：1）自动抓取建筑图纸里特定的对象数据（柱子、墙、门、窗、楼梯）生成建筑底图，干净的建筑底图可以迁移到工艺设备布置图里。2）建筑底图的图层支持一键锁定和解锁。3）支持一键更新。建筑那边的图纸修改后可以更新到本专业底图。

具体步骤如下：

1、打开一张建筑底图。有些人的建筑图层是锁住的，先解锁。点击菜单栏，迁移建筑底图里的「解锁建筑底图」或者工具栏里的相应按钮。

2、点击菜单栏，迁移建筑底图里的「移出建筑底图」或者工具栏里的相应按钮。如果建筑图纸不规范，有问题的地方自己修补一下。

3、核对建筑图纸标签里的层高信息。我们的迁移功能是根据图签里的层高打标记的，一定要确认建筑图签里填有层高信息，建筑人没填的话自己加一下。

4、只有第一次用建筑底图的时候，需要自己手动拷到工艺的布置图上。下次建筑二版有更新的话，在建筑图纸里点击「提取建筑底图」，接着到工艺的布置图里点击「自动更新建筑底图」。

5、建筑底图的图层支持一键锁定和解锁。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）



## 技巧汇总

## 01. 注意事项

### 1.1 管道数据需使用配套的材料等级表

管道数据表只有使用配套的等级号，压力等级、吹洗介质、无损检测比例、检测合格等级、泄露性试验介质、压力，这几个数据后台可以自动根据相关逻辑判断填充，否则只能在导出的数据表内自行修改。做外管条件表时同理。

配套的材料等级表详见之前发给大家的邮件，或者直接从我这边获取。

### 1.2 谨慎同步管道数据

请谨慎同步「管道块」。我们发现同步管道块后，所有管道的「数据 ID」会更改，而一键更新接图箭头和一键更新辅助流程，是与管道的数据 ID 关联的，同步管道块后这两个功能无法使用。所以本次更新的「一键同步数据流属性块」剔除掉了管道同步，也请大家如非必要，不要同步管道块。

## 02. 相关知识

### 1.1 通配符匹配原则

| 通配符 | 匹配原则 | 举例 |
| --- | --- | --- |
| `*` | 匹配任意数量的任意字符 | 比如：`VT*` 会匹配到任意以 VT 开头的管道；`VT-25-*` 会匹配任意管径为 25 的管道。`VT*-50-*2J1*` 会匹配任意管径为 50 的、等级号为 2J1 的管道。等等 |
| `[...]` | 范围描述符 | `[a-z]` 表示从 a 到 z 之间的任意一个；`[1-6]` 表示 1 到 6 之间的任意数据 |
| `[~...]` | 反向范围描述符 | `[~ac]` 表示除了 a 和 c 之外的任意字符 |
| `?` | 匹配任意单一的字符 | - |
| `#` | 匹配任意单一的数字 | - |

备注：通配符基本可以匹配刷选出你想要的任何数据。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）



## 更新内容记录

## V2.1 版更新内容

**总体相关：**

1、设计流自动生成图形时所需的「图形模块」全部放入了公司内部服务器，确保所有人调用的是同一个数据源。

2、网站里生成成品时，导出数据支持选择性导出。

3、图签支持多行多列同时自动编图号。之前只能一整行一整行自动编，新功能使用的前提：同一行的所有图签必须放在一个水平方向（Y 轴定位必须一样）。

4、管道、设备、仪表所有设计流的块，支持一键复制所在图号信息。以前要一张一张刷图号，现在根据流程图图框大小定位数据，自动赋值。

5、集成了去教育版功能。很多人的图纸目前都带教育版，一键去教育版目前集成到了「公共工具」栏里。

**流程图相关：**

1、改进上个版本增加的功能：生成仪表块继承所在设备或所在管道的数据。

经使用反馈，自动生成的仪表会自动继承所在位置的介质、温度、压力等数据，但很多时候我们这几个数据会经常改。改进后的逻辑：自动生成的仪表只自动填充所在位置（设备位号或管道编号），而且支持自动更新（设备位号管道编号改了，仪表所在位置也可以一键更新）。介质、温度、压力等数据，如果跟设备或管道相同，只要空着，导成品时后台已经有功能可以去匹配关联的数据。所以自动生成的仪表填充所在位置信息即可。

再次强调：设备、管道、仪表三个块的数据，仪表的数据很多可以不填，只要跟其所在位置（设备、管道）相同的都可以不填。

2、主物料管道的初始数据自动填充。管道的来源、去向这两个属性，只要填的是「设备位号」，那么可以自动填充来源设备里的「介质、温度、压力」3 个数据。有此初始数据后再根据实际情况做调整。（贡献者郑涛）。

## V2.0 版更新内容

2021-03-20

**总体相关：**

1、设计流所有组件封装到后台。

以后不用每次拷之前发布的模板 CAD 到自己的流程图里了，新建一个空白图纸也可以通过工具栏里的按钮生成管道、仪表、设备位号等属性块。

2、重新梳理了内网上的文档说明。

**布置图相关：**

1、流程图设备数据自动迁移到布置图。

目前流程图中的设备数据可以直接迁移到设备布置图里。一键生成对应的布置图设备位号，并根据设备尺寸匹配相应的「设备平面图形」。

备注：目前只设备外形图形库只做了立式储罐以及 B 型支耳的搪玻璃反应釜（开式及闭式）。如果设备尺寸匹配不到相应的「设备平面图形」，而你手里又有比较好的设备图形，请提供给我。此功能的实现，需要大家一起把手里比较好的、厂家提供的设备外形尺寸放在一个公共图形库里。

2、设备布置图平面图形根据设备代号自动匹配更新。排方案后，如果设备尺寸修改后，可以根据「设备代号」自动更新其外形图形。

布置图中的设备数据也可以导出到临时 Excel 文件，通过更改「设备类型代号」可以更新设备的外形尺寸图形。

3、迁移建筑底图到工艺设备布置图。

基本思路：1）自动抓取建筑图纸里特定的对象数据（柱子、墙、门、窗、楼梯）生成建筑底图，干净的建筑底图可以迁移到工艺设备布置图里。2）建筑底图的图层支持一键锁定和解锁。3）支持一键更新。建筑那边的图纸修改后可以更新到本专业底图。

4、通过设备的临时 Excel 文件自动生成布置图里的设备位号以及设备的外形尺寸图形。

针对的场景：拿到业主的设备资料后，整理出需要的设备关键参数后，复制到临时 Excel 文件，可以直接在布置图里生成设备位号以及匹配的设备的外形尺寸图形。

**流程图相关：**

1、生成仪表块继承所在设备或所在管道的数据（贡献者王小飞、曾涵卫）。

除了常规的 copy 外，目前提供了另外一种画管道块和仪表块的方式。以设备为核心，生成设备上的仪表块可以继承设备的部分属性数据。生成从设备出去的管道也可以继承设备的部分属性数据。详见内网说明文档中的「流程相关说明」。

2、新增批量刷只刷管道起点或者只刷管道终点。

3、通过设备的临时 Excel 文件自动生成流程图的设备位号以及流程设备图形块。

针对的场景：拿到业主的设备资料后，整理出需要的设备关键参数后，复制到临时 Excel 文件，可以直接在流程图里生成设备位号以及匹配的设备图形（设备图形库还未上线）。

4、取消了每次导临时 Excel 文件前必须选择「预览修改」的限制。

## V1.4 版更新内容

2021-01-27

**仪表条件相关：**

1、仪表位号新增按设备号自动编号。（贡献者王禹谋、陈仁勇）

使用前提条件：1）仪表块里「所在位置」的属性要刷好。2）如果仪表在管道上，该管道块「来去向」属性所连的设备位号要刷好。

基本逻辑：1）设备上的仪表，仪表所在位置填有该设备。2）管道上的仪表，找到仪表所在位置对应的管道，接着找该管道里来去向连接的设备（来去向都是设备位号的话以离仪表位置最近的设备为准）。

**设备相关：**

1、储罐、反应釜新增自定义字段。（贡献者孙伟昌）

储罐可能会有外盘管参数信息。储罐块、反应釜块新增了 2 个自定义属性，常规参数不够填往这里填。

2、各设备块的更多属性参数外显。（贡献者周星）

## V1.3 版更新内容

2020-12-30

**总体相关：**

1、数据流菜单规整。（贡献者郑飞宏）

工艺的数据流目前 6 大块功能模块。1）帮助：版本信息、一键同步数据流属性块；2）数据修改：刷数据图号、刷管道起点终点、刷仪表所在位置、命令版刷块属性、界面版刷块属性、强化版自动编号、图签自动编号；3）数据提取：导出数据、导出数据流临时 excel、导出通用块临时 excel；4）流程图辅助：自动生成接图箭头、自动生成辅助流程、自动生成设备位号、刷变等级号信息、刷变管径信息；5）布置图相关：洁净空调条件房间自动编号；6）保留的旧版功能。

在此特别感谢郑飞宏提炼出的功能分类模块。

2、新增数据流常用命令工具栏。（贡献者郑飞宏）

将常用的数据流命令做成了一个 CAD 工具栏，目前画图时你有 3 种方法使用数据流功能：1）菜单栏。2）工具栏。3）将数据流命令映射为自己喜欢的命令名称（CAD 里的工具 -> 自定义 -> 编辑程序参数）。大家根据自己的习惯自行选择。

3、新增一键同步数据流属性块功能。（贡献者徐骋）

以后不需要用命令 BATTMAN 一个块一个块点「同步」了，同步时将自己的图纸整体拷进「模板」CAD 中，点帮助里的「一键同步数据流属性块」即可。

特别提醒：请谨慎同步「管道块」。我们发现同步管道块后，所有管道的「数据 ID」会更改，而一键更新接图箭头和一键更新辅助流程，是与管道的数据 ID 关联的，同步管道块后这两个功能无法使用。所以本次更新的「一键同步数据流属性块」剔除掉了管道同步，也请大家如非必要，不要同步管道块。

4、规整字体、图层以及一些块的基点位置。（贡献者郑飞宏）

汇总：1）数据流数据字体统一样式命名「DataFlow」，里面的字体用公司常用的 tssdeng.shx；2）数据流块图层做了一些调整，外显的字调整到 0 层，保证整个块随意调整到其他层后可随层变化；3）仪表块的基点位置做了调整。使用过程中，有些人将块进行了镜像操作，此时同步块后会出现位置偏移。解决办法是将基点设为图形的中心。

此版已经将仪表块的中心作为基点，同步后你图纸里的仪表块会整体左移，通过 CAD 右键自带的选择类似对象筛选出仪表块，整体右移 5 即可复原位置。目前管道块的偏移问题还没找到好的解决办法，如果管道号文字居中设置且中心设置为基点，会导致不整齐结果。如果有人有解决办法请告知于我。

5、新增批量刷块属性功能。（贡献者郑飞宏）

数据修改的「命令版刷块属性」，可以提取一个块信息为源数据，批量将其属性值刷给后面框选的块，刷的块可以是不同类型的数据（后台自动匹配相关的属性字段）。

6、升级版导出导入 excel 文件。

数据提取模块中的「导出数据流临时 excel」。两点：1）数据流相关块的导入导出集中到一个功能面板，现在可以同时导出 7 大类设备块。2）取消导入临时文件的前置条件，旧版只有点击导出数据完成后才让用户导入。

7、导出通用块临时 excel。（贡献者屠立峰）

数据提取模块中的「导出通用块临时 excel」，可以导出 CAD 中任意同类型块数据，并且自动添加撇号转化为 excel 文本格式，解决一些被 excel 自动转化错的场景，如被当作科学计数法。

**管道数据相关：**

1、新增变等级号、变管径功能。（贡献者郑飞宏、徐骋）

通过给管道刷变等级号、变管径信息，管道数据表中生成相应的多根管道。

**仪表条件相关：**

1、新增自动补全仪表控制点名称隐藏功能。（贡献者徐骋）

自动抓取相关数据补全仪表控制点名称，需要「暗号」，具体操作详见说明文档的技巧篇。

**设备布置相关相关：**

1、新增洁净空调条件模块。（贡献者郑飞宏、牟苏嫣）

## V1.2 版更新内容

2020-11-19

**总体相关：**

1、自动生成跨流程图的接图小箭头，并实现一键更新。所有设备块新增「所在图号」属性，跨流程的管子包含起点终点的设备位号，设备块内又有所在图号信息，那么跨流程图的接图箭头可以自动生成。而且做了数据绑定，管道数据变动后，接图数据可以一键更新。

2、自动批量编号强化版。1）对于管道：后台根据物料代号自动分类，每一个小类自动编号，同时支持按流程图自动编号（如果业主没特殊要求的话，个人强烈推荐按流程图编号）。2）对于仪表同理。强化版的自动编号结合自动生成接图箭头（解决跨图号管道编号重复问题），管道和仪表编号自动化基本解决了。（贡献者王禹谋、李恒）

3、自动生成辅助流程图强化版。生成的辅助流程数据与主流程的管道数据做了绑定，主流程数据修改后，支持一键更新辅助流程。

4、配置「数据流工具选项板」，将设计流的相关属性块集中到一个工具面板上，类似于「天正电气」的那种界面，可以直接选择块插入到图纸里。有些人可能喜欢直接在图纸里 copy 块，看个人喜好。配置步骤详见说明文档里的「01 使用说明」部分。（贡献者郑飞宏）

备注：CAD 很多原生的功能我是不知道的，如果大家知道哪些功能可以跟「数据流」结合在一起，跟飞宏一样直接告诉我，我这边集成进来，至少让你多一个选项。

## V1.1 版更新内容

2020-11-09

**总体相关：**

1、流程图图签自动编号，以及从图签自动提取图号，刷这张图里所有数据的「所在图号」属性。（贡献者王禹谋、张坤）

2、自动生成辅助流程图主要数据。（贡献者叶旭峰）

3、通过选取数据源，批量刷属性块内的数据。（贡献者徐骋）

4、自动编号（管道、仪表、设备），新增「点选」功能。（贡献者徐骋）

5、数据块更新：1）管道的起点和终点数据外显；仪表所在位置数据外显。备注：方便刷完数据后确认。2）外管块内「图号」属性名修改。

**管道数据相关：**

1、通过选取数据源，刷管道的「起点」和「终点」数据。

**仪表条件相关：**

1、批量刷仪表「所在位置」属性。

以上所有具体操作，大家可以去网页端看「文档说明」中的技巧篇。

## V1.0 版更新内容

2020-10-27

**总体相关：**

1、数据流的菜单栏调整以及新增相关图形交互界面。

2、始终自动加载插件的解决方案。（贡献者张堃）

部分人即使在 CAD 插件的启动组里添加了数据流的插件，还是遇到无法加载的情况。请找信息技术部装下 360，查杀一下自己电脑里的「acaddoc.lsp」病毒，清除一下即可解决问题。

**管道数据相关：**

1、根据管道所在的坐标位置，自动批量编号。（贡献者汪晨）

2、批量修改管道数据。CAD 中精准刷选出要修改的管道数据 -> 导入到 Excel 临时文件 -> 批量修改后反导回 CAD。（贡献者曾涵卫）

**仪表条件相关：**

1、新增 SIS 属性块。

2、根据仪表所在的坐标位置，自动批量编仪表位号。

3、批量修改仪表数据。CAD 中精准刷选出要修改的仪表数据 -> 导入到 Excel 临时文件 -> 批量修改后反导回 CAD。（贡献者曾涵卫）

**设备数据相关：**

1、自动生成流程图底部的一排设备位号。（贡献者陈李荔）

2、根据设备所在的坐标位置，自动批量编号。（贡献者叶旭峰）

3、批量修改设备数据。CAD 中精准刷选出要修改的设备数据 -> 导入到 Excel 临时文件 -> 批量修改后反导回 CAD。（贡献者曾涵卫）

4、设备块数据新增，是否防爆（Y/N）、电机级数（2/4/6/8，填 1 为变频电机），后台会根据电机功率、级数、防爆信息匹配天书里的电机型号写进设备一览表。（李恒）

5、自定义设备，下面文字「参数 1-3」，碍事，删除掉。（贡献者范敬宜）

提示：以后做安全专篇的设备表时，可以直接从 Excel 临时文件里拷，节省时间。

以上具体操作详见文档说明里的「技巧汇总」。

## V0.6 版更新内容

2020-09-22

**总体相关：**

1、新增 CAD 提取数据的图形交互界面。具体设置详见文档中的「使用说明」。

2、修改用户密码。点击右上角的头像展开选项，点击「设置」，在弹出的面板后修改用户密码。

**仪表条件相关：**

1、仪表测量控制点名称自动拼接。（贡献者徐骋）

2、仪表自动关联管道数据匹配逻辑修改。（贡献者徐骋）

从原来匹配整个管段号到仅匹配最前面的管线号，例如仪表所在位置填的「PL1106-80-2J1-H5」，之前的逻辑是整个管段号去与图纸里的管道号匹配，有人反馈在画图过程中，经常会修改管道数据的信息（如管径），仪表所在位置已填的信息懒的再改。所以现在仪表所在位置的管道号只提取前面的「PL1106」去匹配管道数据。

3、备注里的保温厚度信息自动关联管道数据。（贡献者孙伟昌、徐骋）

仪表所在位置为管道的话，备注里的保温厚度不用填了，后台会自动提取所在管道的保温信息。

**外管条件相关：**

1、外管数据关联管道数据。外管块里的管道号会自动关联该管道上的相关信息，减少重复输入。备注：跟管道数据表一样，管道等级号必须使用数据流配套的「管道材料等级表」。

## V0.5 版更新内容

2020-09-07

**总体相关：**

1、新增用户系统。

每个人的账号为自己公司的邮箱名，密码默认为：tz123。账户密码修改系统下一个版本会更新。

2、各模块界面更新。

3、新增文档说明页面。

软件的使用说明、各个版本的更新内容、bug 修复情况等信息都会放在这个页面里。

**管道数据表相关：**

1、保温材料空值关联已有数据（贡献者徐骋）。

有保温符号的管道，保温材料信息，后台可以自动关联已填有的数据。比如 200℃ 以下的保温（符号 H、岩棉制品），200℃ 以上的（符号 H、硅酸铝），保冷（符号 C、聚氨酯），防烫（符号 P、岩棉制品）等。每个类型的，图纸里只要有一个数据填好了，其他的可以不填。

**仪表条件相关：**

1、新增控制阀条件表。开关阀和控制阀的信息放在控制阀条件表内。

2、仪表属性块增加「备注」字段。（贡献者张堃、孙伟昌、徐骋）

备注信息如：保温厚度、开关阀的气开气关、联锁逻辑等，这个属性字段的信息会自动填充到条件表里的备注栏中。

**设备一览表相关：**

1、自定义设备块的参数，如果为空值就不填充。

之前自定义块中，4 个自定义参数默认写的是「xx」，空值的话设备一览表的那一栏不会再填充，省得导出的表里要自己手动删除。

## V0.4 版更新内容
 
 2020-08-22
 
**管道数据表相关：**
 
1、新增管道数据表模块。
 
抽出来的管道数据，在设计流数据一体化平台上可以导出 2 个文件，一个是我们的成品管道数据表，一个是做管段表用的数据源（可导入公司做管段表的软件里用于统计材料）。
 
特别强调的是：管道等级号必须使用配套的材料等级表（附件）。只有使用配套的等级号，压力等级、吹洗介质、无损检测比例、检测合格等级、泄露性试验介质、压力，这几个数据后台可以自动根据相关逻辑判断填充，否则只能在导出的数据表内自行修改。
 
另：如果你项目里用到的物质在配套等级表里找不到相应的等级号，请与我联系。
 
**仪表条件相关：**
 
1、仪表数据与管道块、设备块数据关联。（贡献者冯大龙、顾川川、徐骋、蒋万忠）
 
仪表块、管道块和设备块内有相同的数据可以共用，减少重复输入。这个想法包括我自己在内，有多位同事想到并给我提了建议，目前已实现。
 
仪表块的中工作介质、温度、压力、所在位置的材质、所在位置的规格尺寸，这 5 个属性数据的提取逻辑如下：1）先判断仪表块里该属性有没有填，填了的话直接提取该数值。2）没填的话，后台会根据仪表块里的管道编号或设备位号，自动关联到对应的管道块或设备块，提取相应的数据。
 
简单说，如果管道块和设备块那边已经有了这 5 个属性数据，仪表块里只要在「LOCATION」这个属性里填上管道编号或设备位号，那 5 个数据可以不填了。
 
2、仪表属性块增加型号字段（贡献者张堃）
 
远传仪表，例如液位计，有雷达，磁翻板，液位开关等多种类型，但是在流程图里只有 LI 一种表示方法。而实际过程中，有些位置是需要判断液位计类型的。流量计同理，楔形、质量、旋涡等，也都有特定使用工艺。仪表属性块增加种类这一项，既可以方便业主审核，也可方便工艺自查。
 
3、仪表属性块增加图号字段。
 
4、集中仪表块新增区域覆盖。（贡献者徐骋）
 
流量计放在管道多段线上可直接覆盖底部管道，方便位置拖拽。
 
**设备一览表相关：**
 
1、新增了一个「自定义」设备块。（贡献者张坤）
 
如果设备不属于反应釜、储罐、换热器、输送泵、真空泵、离心机，可以使用这个块。
 
2、定型设备新增工作介质、温度、压力。输送泵、真空泵、离心机也新增这些属性，便于与仪表块数据关联用。

## V0.3 版更新内容

2020-08-03
 
1、新增外管条件（贡献者郑重、沈琦）。

已跟外管对接，接受附件里自动生成的 Excel 版的外管条件。有点着重说明，外管去向里必须包含「去」或者「自」这 2 个字符，后台是根据这 2 个字符判断起点或终点的。

使用数据流提外管条件，目前可以为你节省时间的地方：1）设计温度、设计压力自动计算；2）管道直径根据管道号信息自动提取。3）流速，根据流量及提取出的管径自动计算；4）管道材质根据管道编号信息自动填充；5）管道保温代号、厚度信息，根据管道编号自动提取。

## V0.2 版更新内容

2020-07-28

1、上线电气条件。

CAD 里用命令 gselectric 提取数据，进入网页端工艺模块中的「To电气专业」。

2、设备块的备注信息缩小（贡献者陈李荔），这样信息多的时候不会显得太挤。

3、所有属性做成了移动（贡献者林俊），目前块里的属性都是可拖动的，比如集中仪表里，高低报警符号可以根据使用情况拖动到合适的位置。

4、非标设备块增加添加工作介质信息（贡献者顾川川），总师办之前发了文，目前因多数项目的非标设备不是本公司设计，制造图纸为甲供，因此技术规格不完整会造成实际加工的差错，甚至引起事故。故要求非标设备的技术规格栏中还应填写操作条件，即操作温度、操作压力、处理能力、介质名称等。

5、增加了离心机设备块、真空泵设备块（贡献者李恒）。

6、各个设备块根据常规经验新增了一些必要的关键参数信息。

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）



## bug 修复记录

## V2.1 版 bug 修复

1、仪表按设备位号编号，增加支持「04C-V1101」这种设备编号规则。（bug 贡献者宗源）

2、修改部分管道变管径信息无法有效提取。

3、导出的临时 excel 文件错乱。原因：CAD 数据里包含的 `"` 字符导致的。解决方案：用 CAD 原生命令「FIND」剔除掉所有的 `"` 字符。（bug 贡献者李侦糠、郑涛）

4、修复部分仪表变等级不生效。（bug 贡献者郑涛）

## V2.0 版 bug 修复

1、自动编号时有些管道匹配错误。（bug 贡献者陈樟女）

物料代号 N（氮气）会匹配到 NEGR（乙二醇 ）。

2、仪表条件里液位的负值无法显示负号。（bug 贡献者牟苏嫣）

## V1.4 版 bug 修复

1、新版插件无法导出老版块的数据。（bug 贡献者郑涛）

2、新插件无法导出旧版管道块的临时文件以及 txt 数据。（bug 贡献者谢剑）

3、仪表自动编号时卡住。（bug 贡献者谢剑）

图纸里有些仪表的初始编号是「空值」导致的。解决方案：临时文件里核下一下初始编号，编号空值的仪表随意填写一个编号，确保仪表的初始编号不要为「空」。

4、介质名称太长超出数据表字段最大值。（bug 贡献者葛兰兰）

## V1.3 版 bug 修复

1、隔膜泵无电机，设备表删除该行信息。（bug 贡献者李恒）

2、插入的块会自动缩小比例。（bug 贡献者宗源）

解决方案：取消激活插入对象的自动缩放即可，输入命令 INSUNITS，将值设为 0。

3、编号出现待小数点。（bug 贡献者章圣望、葛兰兰）解决方法详见文档说明。

解决方案：标准精度设置导致的，点「标注」或者直接快捷命令 D 进入标准样式管理器，点「修改」，把精度改成 0.00 即可。

4、刷图号数据不应包含外管数据。（bug 贡献者曾涵卫）

5、excel 反写数据，临时文件里的数据 ID 有可能在图纸里不存在了。（bug 贡献者李侦糠）

## V1.2 版 bug 修复

1、导出设备数据时，如果自己图纸里的设备块类型不全导出报错。（bug 贡献者李侦糠）

## V1.1 版 bug 修复

1、隐藏仪表备注信息后，集中仪表块区域覆盖失效。（bug 贡献者曾涵卫）

2、批量修改泵数据模块，查看「设备型号」报错。（bug 贡献者李侦糠）

## V1.0 版 bug 修复

1、导出的设备表有该单体旧的数据。（bug 贡献者孙伟昌）

之前的「删除」逻辑是放在，判断是否有这个数据表之后的，该逻辑有问题，比如第一版里有泵数据，第二版里没有泵数据，那么就不会删除第一版的泵数据，所以应该放到判断之前。

2、保温材料自动关联 bug。（bug 贡献者范敬宜）

无论是 200 度以下的还是 200 度以上的，都有可能关联不到数据，这种情况下，insulationData 直接返回空数组。

## V0.6 版 bug 修复

1、保温材料关联不完善，比如防烫 P 的岩棉制品和保温 H 的岩棉制品不能分别关联。（bug贡献者孙伟昌）

2、CAD 数据缺失情况导致的 bug。比如图纸里没有高温（200℃ 以上）保温材料数据，导致后台无法识别。（bug贡献者曾涵卫、张坤）

## V0.5 版 bug 修复
 
1、设备表的数据中工作介质字段 string 长度设置过小导致无法写入数据。（bug贡献者李恒）

## V0.4 版 bug 修复
 
1、储罐块的基点偏移问题。（bug贡献者张堃）
 
上一版本V0.3 中，储罐设备块的基点位置有误，已修复。
 
2、cad 内特殊字符 \U+00B 等，导致数据读取失败。（bug贡献者牟苏嫣、张坤）

最后，使用过程中有任何问题可随时与我联系（手机号：15857183324，短号：663324。）





页边距的修改：
 
```css
/* 全局属性
 * 页边距 padding: 30px;
 * 全文字体 font-family: ptima-Regular;
 * 英文换行 word-break: break-all;
 */
#nice {
  letter-spacing: 0.05em;
  color:#595959;
  padding: 50px;
}
```
