# 数据流汇报

## 01 产品库重构

## 02 营销宣传

03 数据流一体化开发

# 数据流一体化汇报

跟产品库结合起来，比如风机选型。

## 目录——P1

01 Why——为什么要做数据流一体化

02 How——如何实现数据流一体

03 What——数据流一体化之全面通风演示

04 后续做的

物性数据的应用——暖通全面通风计算

产品库数据的应用——设备一览表

## 01 为什么要做数据流

先回答第一个问题，为什么要做数据流，我从公司内部和化工 101 这两个视角来说。

### 1.1 公司视角——P2

数据流一体化是谢雨东在他的个人技术工作计划里提出来的，我把它浓缩为下面这句话：

通过封装数据和算法，实现各专业间数据的传输、提取、计算和输出一体化。

这里面有几个关键词我要说明一下：

第一，封装数据和算法。数据包括：项目信息、各个专业的条件数据、物性数据、设备数据、规范里的数据。算法指各个任务的业务逻辑，是如何加工处理这些数据的具体规则，比如，暖通专业拿到上游数据如何把计算风量选好风机的，如何进行洁净空调、舒适性空调等计算。工艺专业拿到设备信息后如何把设备表做出来的，如何把数据转为为个各个下游专业的条件的。

数据做成一张张关系型数据表存到云端数据库。算法写进后端和前端的代码里。数据和算法封装成数据对象后，只对外暴露少量的接口给设计人员，只要我数据对象内部实现的好，没问题，上一层的设计人员只需要对几个接口的数据进行输入，极大的提高了效率和质量。

第二，各专业，目前数据流只针对公用工程专业，比如工艺、水、电、仪、暖通等。

### 1.2 化工 101 的视角，产品库重构——P3

之前化工 101 的产品是外包给外面团队做的，但为了以后能够进行产品的快速迭代，化工 101 的 2020 年度计划里有一项是，团队能够自己开发小程序。我们是在5 月初完成产品库重构的。重构后除了页面样式的调整，额外增加了 2 个模块，设备型号和物性。物性这边，一共 3 大块，第一个是 2800 多种危化品的基本信息；第二块是重点监管危化品；第三块是 2016 版的国家危废品目录，大概 500 条的样子。再来看设备数据这边，先做的定型设备，目前有 1000 多系列设备，设备信息基本上是我们自己写爬虫程序在网上爬下来的。

重构后的好处：一是我们可以随意的增加模块；二是数据的颗粒度我现在拆的很细，打上标签后就可以方便的进行逻辑处理，我知道应用场景会变多，但具体怎么用当时还没思路。同时，在重构产品库的过程中，我们也意识到一个很大的问题。化工 101 之前的定位就是服务企业端，小程序、公号上做影响力是没问题的，但真正服务企业，让数据产生生产力还是得电脑端，也就是网页端。虽然现在是移动互联网时代，大家上网基本都是用手机。但是在生产端，也就是干活的工具还是电脑。

### 1.2 化工 101 的时间，需求——P4

所以当时提到谢雨东提的数据流一体化时，其实对我的触动是很大的，把我脑子里的很多想法串起来了。它可以说是满足了我这边的 2 个需求：第一个是数据的应用场景，数据流一体化用到了我这边的物性数据库和设备数据库，比如很多计算模块要提前有害介质的物性数据，再比如暖通全面通风算好系统风量后进行风机选型可以用到我这边的产品库数据。第二个点促进化工 101 从移动端产品扩展到 PC 端产品，之前的产品库重构只是让我们具备了小程序端的开发能力，正好借着数据流一体化的开发可以让我们初步具备 PC 端的开发能力。

可以一拍即合。以上就是我们为什么要进行数据流一体化开发。下面接着来回答如何实现数据流一体化。

## 02 如何做数据流一体化

### 2.1 SaaS——P5

我们先看看常规的软件交付模式。

最左边是很早之前的传统软件服务模式，所有的东西都放在客户本地服务器上。右边 3 个是目前流行的 3 大类云服务。Laas（基础设施即服务）、Paas（平台即服务）以及 SaaS（软件即服务）。数据流一体化的服务采用的是 SaaS，软件即服务模式。所有的服务和数据都是放在云端，用户只要有网，通过网页浏览器即可访问软件，非常方便和灵活。

云服务按这些年的发展趋势来看，最终会像水电一样成为基础设置。不过对于我们行业来说，PaaS 应该更合适，数据和应用是放在本地的。顺便提一下，我在看云服务的时候，看到多云（Poly-Cloud 或 Multi-Cloud）这个近几年兴起的概念，意指企业不将全部业务放置在一个云服务提供商身上，他们会根据自己的策略，将不同种类的业务分配给不同的云服务提供商，例如根据云服务商的产品服务能力专⻓进行选择。有的企业则是根据云服务商与企业业务间的关系进行选择，还有的企业根据「云不可知论」追求跨供应商的可移植性。不论如何，多云的选用策略也将成为越来越多企业的部署模型，因为对于企业而言明显能够感受到的好处就有以下两点：1）能避免单一供应商绑定，拥有更高的灵活性和成本优化优势。2）供应商故障和灾难发生后，能最大程度保证业务可用性。

### 2.2 数据流开发的技术栈——P6

前端：JavaScript，其抽象封装后的框架 Vue

后端：PHP，其抽象封装后的框架 laravel，外加 python 进行数据爬取和清洗。

数据库：MySQL

### 基本逻辑流程——暖通全面通风——P7

设计人员的交互界面，除了第一步是在 CAD 里，其余同时在网页 web 端。前 2 步是上游专业干的，这里是工艺专业。第一步在 CAD 里提条件，要提哪些信息我们在块里规定好。接着从 CAD 里把条件信息抽取出来，在网页端里加载下，这里有个确认环节，条件数据会在网页端呈现出来，确认没问题后提交到后端数据库。第 3 步，暖通专业从网页端按房间提取数据，输入一些缺失的数据，存入数据库计算。最终要得到 2 个东西，一个是单个房间的通过量，一个是多个房间的系统风量。

大家可以看到，这里涉及的有4 大类数据，一个是上游专业在 CAD 端的输入数据、一个是本专业需要在网页端的输入数据，我们是想尽可能的减少这个界面的输入，另外两个是数据库里已有的。

### 2.3 前端框架——P8

用 vue 开发实现的可扩展交互界面。

我们目前按专业来划分，收集这个专业需要做哪些任务。这些任务基本都是三大步：输入、处理、输出。输入源有 3 块：上游专业的条件数据、后台公共数据库里的数据以及网页里暴露出来的输入接口的数据；处理是各个任务的业务逻辑；输出有 2 类，一个是供下游专业使用的，直接存入后台数据库，一个是直接生成成品图纸的，比如设备表这种。

暖通专业目前的任务收集的最全：全面通风计算、局部通风计算、洁净空调计算、舒适性空调计算、采暖计算、冷热源计算。

目前实现的前端框架一大特定是好扩展，后面增加新模块，只需新增一个页面即可。

### 2.4 后端计算逻辑——P9

计算模块：1）房间参数计算。2）室外通风参数计算。3）消除余热计算。4）消除余湿计算。5）稀释有害物质计算。6）防爆通风计算。7）平时通风计算。8）事故通风计算。9）通风系统计算。

### 2.5 数据库表——P10

我现在以暖通的全面通风模块为例来说明所涉及的数据库表。

公共数据方面有：1）物性数据，密度、相态、爆炸极限、危害程度等。2）室外气象参数库，全国各省各个城市的室外温度和湿度——「工业建筑供暖通风与空气调节设计规范GB50019」的附录A。3）有害物质的职业接触极限，比如最高容许浓度 MAC、时间加权平均容许浓度 PC-TWA——「GBZ2.1-2019 工作场所有害因素职业接触限值第一部分：化学有害因素」。4）有害物质的换气次数—— HG/T20698-2009 的附录。

业务逻辑方面：1）项目数据表单。2）单体数据表单。3）房间数据表单。4）房间内所含有害物质的表单。5）房间所含散热设备的表单。

03 产品演示

孔总的建议：

01

先讲做这件事的意义和目标：

1、数字化的工作。

我们这个数据流是在给公司数字化工作添砖加瓦。侧重于设计人员的设计环节里具体作业的数据化。

不仅仅是文件的数字化，要实现颗粒度更细的数字化方便加载算法。二维图纸里颗粒度更细的数字化。

这里放产品库的重构。

颗粒度。

2、提高设计品质。

1、规则固定。准确性

2、统一的规格。举例设备一览表、流程图样式。

这里放谢雨东的架构图。

3、提高工作效率。

抛具体的数据。按谢雨东的估算，四五天的工作量可以半天做完。

仪表、电气条件节省 40-50%的条件

仪表条件节省的工时；设备表节省的工时。

接着进行演示。然后再讲怎么实现的。

项目信息不用自己输，提前输好，到时告诉吴总这边是可以增删改查的。

02 说明 2 个差异：

1、我们跟天正暖通、天正水道、天正电气，现有的东西的差异。

我们要在现有软件的基础上，把我们天正的经验加载进去。

目前这些天正软件只是针对民用行业的。

2、和现有的设计流程的差异。

我们在保留现有的作业模式的前提下，我们做了哪些优化来提升它的能效。

在 CAD 里举例设备表、仪表条件、特性表，是在原有工作模式上进行的。


与谢的交流：

第二块的演示谢来做。

对比表。以前的作业环节，现在的作业环节。

原来很多设计的数据时经验值。第一个，我们现在要把它精细化。第二个，原来的一些作业的方法比较单一，比如全面通风计算，之前只是用的换气次数法，我们现在这套系统里的这个模块如果能普及的话，我们还可以用有害物的散发量法，多个维度方法的话我们就可以做比对验证了。数据多了，可以做成多个数据方案，对我们来说只是鼠标点点做选择，具体实现固化到算法里了。

可以把上面的优点放到提升设计品质里去。

最终的目的。

最终的畅想场景。1）做一个客户的输入接口，比如客户的 URS，我们把客户要输入的信息固定好，客户直接在里面输入就行了，直接到我们的数据库。2）一体化的解释：各个专业都有自己的界面。我不需要管其他的专业，其他专业的数据都是在他们自己的界面里输入、处理、输出到数据库，作为我这个专业只需要在自己的界面里调数据作业（提条件）就行了。这个解释放到第一部分里讲。

设备信息这一块，对总包的采购很有用，数据直接抽出来。

跟我们院目前各个共用工程在用的天正系软件相比。以天正暖通为例，它里面都是一些很通用型、基础性的东西，它的功能基本都是在后端，也就是画图的时候用到的工具。因为本身就是面向民用行业的，它里面是没有针对项目的东西的。我们的数据流一体化基本上是在处理前端的作业，即画图前，比如上游专业的 u rs、业主的 urs。

我们是针对工业设计院用的，主要是加载了工业设计方面相关的经验、算法进去。跟那些天正软件一点都不冲突的，是很大的补充和完善。而且这种完善很适合我们院自己的作业模式，因为本身是我们自己开发的。

这些软件没有数据连续性的功能。比如做一个风管计算，它要把风管画完后才出来。

传统作业：暖通专业收到条件后，先进行计算，然后设备选型，然后方案确认，条件表的填写，校审，然后下发到各个下游专业。现在的作业输入几个接口的数据、点点鼠标。