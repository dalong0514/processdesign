# 0106. 先乔自控软件

[软件产品](http://www.cnindesign.com/instrument.htm)

## 借鉴汇总

软件的功能很全面（16 个模块），可以挖掘、借鉴的东西多（华陆的模板）。

1『这个思路蛮好的，把「管线或设备」上的仪表通用信息（材质、法兰等）提炼成单独的一个模块。不过先乔 V2.0 版目前在「项目参数」里已经没有「管线设备表」了，不过在工艺条件面板里还有，应该还能用。（2020-10-28）』

仪表索引模块用于管理回路及回路的构成，生成仪表索引表成品，该模块为整个软件的核心模块，后面的各个模块都会用到这里的数据。包括以下三部分：回路分类、回路、回路内容。

1『回路的这 3 大块内容很值得借鉴。（2020-10-28）』

用于定义数据表模板的公式，界面为：XXXX。

1『里面各个仪表数据表很全面，有些信息可以借鉴。』

## 功能介绍

先乔自控辅助设计软件 —INDesign Instrument（V2.0）是上海先乔信息技术有限公司专为石化 / 化工 / 石油 / 纺织 / 矿冶等各行业设计院 / 工程公司自控专业开发的新一代辅助设计软件，可以实现工艺条件向自控专业的成批导入和自控专业大部分设计成品的生成，也可以和 Intergraph INtools 软件连接，把在 INDesign Instrument 软件里面完成的部分设计数据直接导入 INtools 数据库，减少用户在 Intools 软件中的数据输入。

软件以石化 / 化工行业标准设计规定为依据，参考了国内各大石化 / 化工设计院的常规设计习惯，并充分借鉴了国外工程软件的先进设计思想，利用最新的开发技术开发，为一个以项目数据库为核心的网络版协同辅助设计软件。软件集成了「种子库」的概念，建立一个标准种子库后，可以为以后各个类似项目直接引用，大大提高设计效率。

1『借鉴处：1）项目数据库为核。2）种子库。』

软件主界面为：

INDesign Instrument 主要模块有：项目管理、报表、图纸目录、工艺条件、仪表索引、数据表、汇总表、条件提交、I/O List、监控数据表、报警联锁、安装图、DCS 接线、电缆表、回路图、工程计算以及 INtools 接口。

INDesign Instrument 软件主要功能有：

1、工艺条件模块：1）导入工艺专业提供的条件表，直接生成仪表索引。2）工艺条件表的模板可以自定义。3）条件变动后再次导入，自动列出变动内容。3）支持管线设备表导入，根据管线 / 设备号，自动更新数据表上的管道材质、法兰标准、法兰等级、法兰密封面、法兰材质等参数。4）特别提供原有手工仪表索引表导入功能，导入后利用数据直接生成数据表、安装图、接线和回路等后续模块，大大方便已有仪表索引成品的项目的使用。

2、仪表索引模块：1）允许用户方便地维护仪表索引，仪表索引录入的数据可以直接生成 I/O List、监控数据表、联锁报警设定值表等后续成品。2）支持回路参照和回路排序等方便性操作，回路排序方式自定义。3）删除的回路支持回收功能；支持仪表索引导出到 Excel 修改后导入进软件。4）根据自定义模板生成索引表成品。

3、数据表模块：1）可以以表格方式成批编辑数据表，也可以按照最终 Excel 方式单张预览数据表生成效果；工艺条件导入内容只读，不允许编辑。2）同类数据表可以快速参考，以方便快速填写。3）常用内容允许自定义下拉。4）数据表模板允许自定义；录入数据表数据后，成批生成数据表成品以及数据表目录、位号索引表等成品。

4、仪表汇总表模块：1）支持为每个数据表指定汇总字段，对某个工段或者整个项目的仪表进行分类汇总，可以根据每一分类检索到位号明细。2）支持汇总表成品生成，成品上包括位号明细，可以指定每一行能容纳填写的位号个数。

5、条件提交模块：1）自动获取仪表索引、数据表的内容生成各类提交的表格。2）支持提交表格模板自定义及成品的成批生成。

6、I/O 清册模块：1）自动根据仪表索引生成 DCS/ESD/PLC 等 I/O List 数据表。2）可以选择监控系统，生成各监控系统的 I/O List。3）根据自定义模板生成成品。

7、监控数据表模块：1）自动根据仪表索引生成监控数据表。1）可以根据 DCS、ESD、PLC 等分类生成各类监控数据表。3）根据自定义模板生成成品。

8、报警联锁设定值表模块：1）自动根据仪表索引生成报警联锁设定值表。2）可以根据 DCS、ESD、PLC 等分类生成各类报警联锁设定值表。3）根据自定义模板生成成品。

9、安装图模块：1）允许自定义各类安装图模板及材料明细。2）为仪表指定安装图模板，自动汇总统计安装材料。3）CAD 安装图成品生成，安装图号返回到仪表索引。4）提供 CAD 批量打印文件生成功能，可以一次性成批打印安装图。

10、DCS 接线模块：1）完成从仪表 -> 接线箱 -> DCS 机柜的图形化接线，接线数据用于生成回路图。2）支持 DCS 厂家提供的卡件分配表的导入。3）支持 Excel 格式接线表成品的生成。

11、电缆表模块：1）支持电缆表的 Excel 导出，成批修改长度后导入。2）根据电缆的型号、规格汇总每类电缆的长度。3）提供电缆分盘功能，自动生成电缆分盘表。

12、回路图模块：1）图形化界面定义各类典型回路图的回路图模板。2）为接线回路指定各类模板，根据回路图模板成批生成回路图成品。3）回路图号返回到仪表索引。

13、工程计算模块：1）提供调节阀建议算法，自动读取工艺条件，根据液体 / 气体 / 蒸汽三种介质状态计算 Cv 值，根据选择 Cv 值计算最大开度。2）计算结果可以返回到数据表。3）提供多阀门成批计算功能。

14、INtools 接口模块：1）支持把在 INDesign Instrument 软件生成的仪表索引数据导入 INtools 数据库。2）自动创建仪表名称、管线编号、设备编号等各类关联表。3）相关数据自动进入 Intools 的 Process Data、Index、Spec 模块。4）支持 Intools6.0 和 Smartplant Instrument2007，并且随着 Intools 版本升级而升级。

## 0101. 项目管理

项目管理只允许项目主设人或者管理员使用，用于完成新建项目、修改项目参数等设置工作。功能有：

### 1.1 新建项目

新建项目用于建立一个新的工程。在软件中，新建一个项目必须通过参照已有的一个项目来生成。在软件中，一个项目是一个独立的数据库，所有的配置信息都保存在该数据库中，通过参照可以把原有项目的设置参数直接引入到新的项目中。

要求输入的内容有：1）项目代码：唯一的项目代码，如果项目代码已经存在，提示出错，该内容可以出现在成品上。2）项目名称：项目的完整名称，该内容可以出现在成品上。3）参考项目：选择已有的一个类似的项目，参照后可以修改项目参数。4）业主名称：该项目的所属业主 ，该内容可以出现在成品上。5）设计阶段：当前项目的设计阶段，该内容可以出现在成品上。6）编码方式：提供了多种编码方式，化工 / 石化行业一般选择 ISAHG 即可。

### 1.2 修改项目

包括修改项目参数、目录定义、工程目录、用户管理。

#### 1.2.1 项目参数

修改包括项目基本信息、仪表索引排序、仪表索引 <-> DCS 接线、基础数据、系统参数、管线设备表、仪表数据表等参数信息。包括：

1、基本信息。修改项目代码、 项目名称、编码方式等项目信息。输入的信息内容基本和新建项目一致。

一个重要的设置是：编码开头 `UnitCode`。一般位号格式是 FT-1001，但是有的项目要求位号带上工段号，即 `711FT-1001` 这种格式，需要在这里设置上编号开头为 `[UnitCode]`，如果不需要的话设置成空。

2、仪表索引排序。

仪表索引表有一个功能：排序，用于实现仪表索引按照用户想要的排序方式生成，在此自定义该排序方式。

排序方式有以下选择：

含义分别为：1）先按照 TPFL 分类排，每个分类先集中后就地。先按照温度、压力、流量、液位排序，每一类里面先集中后就地。例如：

```
TI-101,TIC-102,TG-101,PI-101,PI-102,PG-101,FI-101,FIC-102,FG-101….
```

2）按照 TPFL 分类排，集中和就地混排。按照这种方式排序，集中和就地不分开了，直接按照回路序号排。还是上面的回路构成，排成：

```
TI-101, TG-101, TIC-102,PI-101, PG-101, PI-102,FI-101, FG-101，FIC-102….
```

因为 TI 和 TG 都是 101，排在一起了。

3）按照回路第一个字母排序，先集中后就地。这种方式不按照 TPFL 排序，而是根据回路的第一个字母，先集中后就地，排出来的效果为：

```
AI-101,AIC-102….FI-101,FIC-102,FG-101,PI-101,PIC-102,PG-101,TI-101,TIC-102,TG-101….
```

4）按照回路第一个字母排序，集中和就地混排。这种方式不按照 TPFL 排序，而是根据回路的第一个字母，集中和就地混排，排出来的效果为：

```
AI-101,AIC-102….FI-101, FG-101, FIC-102,PI-101, PG-101, PIC-102,TI-101, TG-101, TIC-102….
```

5）自定义排序，根据「报表」中「回路「的定义排序。这种排序方式一般不太用得到，用于特殊情况下的自定义排序。为代码为 LoopList 的报表修改排序方式后，直接启用该排序方式进行回路排序。

6）702TE-001,RL-702H01A 两种编码格式共存。这是种特殊格式，装置号的位置可能是开头，也可能在位号中间，需要选择该方式，软件自动识别出装置号后再根据回路字母排序。

3、仪表索引 <-> DCS 接线。定义仪表索引表和接线表之间的同步字段对应关系。

仪表索引和 DCS 接线用到的数据是独立的，仪表索引的数据包括仪表索引表、数据表等，DCS 接线的数据用于接线和回路图生成。在回路图生成的时候需要用到部分仪表索引的数据，例如：I/O 类型、信号名称以及回路图生成时要用到的位号 / 回路号分段拆分（TI-101 拆分成 FuncCode=TI, FuncNum=101）等信息。

在该界面设置仪表索引和 DCS 接线两个表格之间的字段对应转换关系。

如果现在回路图上想要体现数据表上的型号这一栏，我们要做的工作是：1）在「报表」中找到「DCS 接线表」这一分类，把其某一个字段，例如：UDF100 定义成「型号」。2）在该界面把数据表中的「型号」这个字段，例如：SPUDF20 和 UDF100 设置同步关系。3）在回路图上可以用「UDF100」这个公式生成「型号」数据了。

4、基础数据。定义软件里面的内部设置。这部分设置请慎重操作，切勿擅动。

主要包括：1）报表分类定义，即报表模块的报表大类定义。2）回路图块类别定义。本软件除支持模板方式的回路图外，也支持自定义块方式自动组合回路图。这里定义回路图块的分类。3）回路功能定义，即仪表索引模块对回路进行分类的定义。备注内容为每一类的分类条件。功能号 T 开头的都是温度类，P 开头的都是压力类等等，最后一类「其它」可以不要设置过滤条件，剩下的默认都归到其它类中。

5、系统参数。定义软件内部可以修改的设置信息。包括：

1）项目成品存放路径。定义软件成品成品后，默认的成品存放路径。

2）文件名格式。生成成品时候默认的文件名。

3）I/O 安全栅判断。I/O 清册生成时，软件自动生成输入安全栅和输出安全栅编号。由于不同设计院的设计习惯不同，如何从仪表索引上识别出安全栅编号需要一定的标识。软件默认根据仪表名称中包括「安全栅」三个字的为安全栅位号，很多设计院习惯把功能字母 N 作为安全栅，例如：TN、FN、AN，那我们也可以把定义修改成：`FuncCode like ‘% N%’`。

6、管线设备表。

用于定义「工艺条件」模块的「管线设备表」中的数据返回到数据表的特定字段。管线设备表内容为：XXXX。软件自动根据管线等级 / 设备号的定义，把所有该管线或者设备上的仪表的管道材质、法兰标准、法兰等级、法兰密封面、法兰材质等数据表上的内容定义成特定值。具体定义到数据表的哪个字段上，就在此设置。界面为：XXXX。左边是数据表的字段，右边为管线设备表的字段，设定好对应关系后，在「工艺条件」模块中执行「更新」功能时，自动更新数据表的相应内容。

1『这个思路蛮好的，把「管线或设备」上的仪表通用信息（材质、法兰等）提炼成单独的一个模块。不过先乔 V2.0 版目前在「项目参数」里已经没有「管线设备表」了，不过在工艺条件面板里还有，应该还能用。（2020-10-28）』

7、仪表数据表。

根据工艺条件生成法兰标准、法兰等级后，数据表上如果是「法兰标准及等级」- 即把两项合起来了，只要在这里做相应设置，数据表上自动会填充合起来后的内容。设置界面为：XXXX。例如我们设置了 UDF17 法兰标准及等级 = 法兰标准 UDF20+’ ‘+ 等级 UDF21。还可以设置数据表上的某几列自动去掉空格，例如：UDF17,UDF18。

#### 1.2.2 目录定义

各个设计院生成各类成品的图号是比较有规律的，一般是项目代码 + 工段 / 装置号 + 专业号 + 序号。各类成品的图号规则在此定义，界面为：XXXX。

值得注意的是：对于软件能够生成的那些成品，在成品类型一栏中要选择相应的类型。点「确定」为每一个装置生成具体的图纸目录。在目录定义修改和增加工段后，一定要点一下「生成」按钮才能刷新目录。

#### 1.2.3 工程目录

工程目录是每一个装置的最终成品图纸目录，由「目录定义」生成而成。界面为：XXXX。

左边是装置号和装置名，右边是该装置的目录结构。首先在左边维护装置，装置的唯一号是内部号，在第一次录入后，不要再次变动！装置号是可以修改的，如果修改了装置号，在「目录定义」中重新生成一次即可。

#### 1.2.4 用户管理

用于管理登陆用户以及对用户进行授权。界面为：XXXX。

左边是项目列表，右边是所有用户列表。每一个用户名分三级权限：1）管理员：能维护所有装置包括系统设置在内的所有功能。2）主设人：能完成包括部分系统设置在内的大部分功能。「同步」功能、「汇总表」模块的设置定义、用户管理等功能只有管理员才能操作，主设人也没有权限。3）普通设计人员：不能完成所有系统设置功能，但是能进行授权的装置的设计。只有在授权用户列表中打勾的用户才能登陆选择项目，如果是普通设计人员，如果在授权装置中没有打勾，也不能登陆。

### 1.3 删除项目

删除不用的项目，该功能只删除数据库文件，成品文件仍然保留，需要手工删除。如果当前需要删除的项目有人使用，则提示数据库正在占用的失败信息。

### 1.4 项目备份

项目完成到一定的阶段或者需要进行大批量修改，最好进行一次项目备份，以便意外情况下进行数据恢复。该备份只备份数据库文件，图纸文件需要手工备份。备份前必须输入备份说明，以方便恢复前可以查明上次备份的情况。备份后在服务器上的 INPowerServer\DB\Bck 下建立一个项目代号 + 时间组合的.bck 文件。

### 1.5 项目恢复

把整个项目的数据库内容从一个备份文件中进行还原。界面为：XXXX。首先必须选择项目，注意：不能为当前登录项目，否则由于数据库正在占用而不能恢复。

恢复方式有三种：1）一种是从备份历史，即前面备份时候产生的记录，备注中显示备份说明。2）另外一种是从一个服务器上的数据库文件恢复，需要输入该文件在服务器上的完整文件名。3）最后一种是从客户端的一个数据库文件恢复，输入当前机器上的数据库文件名。确定方式后，点恢复即可。

## 0201. 报表

### 2.1 报表定义

定义一个报表需要给定的内容有：

1）报表代码、报表名称、次序、是否系统报表（系统报表不允许删除）、默认报表（如果是默认报表，进入「设备清册」前允许选定该报表）。只有默认报表，允许在此选择查看。

2）显示列。定义一个报表查询结果中需要显示的列，例如：仪表索引表需要指定哪些列，I/O List 需要显示哪些列。通过打勾选择列，选中的列在界面上显示，并可以通过上下移动调整列的显示次序。在右边，有移到最上、上移、下移、移到最下、删除一列、删除所有列的功能，可以调整一个报表显示列的次序

3）过滤条件。过滤条件指定该报表查询的数据范围，主要稍微了解一些 SQL 语法基础，您基本可以实现所想要的任何条件组合。一般常用的过滤字段为：FuncCode、CmpntCode、CmpntName 等。

FuncCode。FuncCode 为功能号，即 TT-1001 中的 TT。例如：要查询所有 TT 的仪表，查询条件为：FuncCode=TT 或者 `CmpntCode Like ‘% TT%’`。在软件中，经常作为过滤条件的字段有：XXXX。

1『上面的这张表蛮有用的。（2020-10-28）』

4）排序方式。排序方式是该报表查询数据的排序字段定义。如果只需要根据设备编码排，只需要定义为：CmpntCode。如果根据 T、P、F、L、A 等回路功能号排序，一般定义为：customsort, cmpntsort。

### 2.2 Excel 模板设置

在软件中，用户可以为每一个报表定义任意多的模板，进入报表后，可以选择其中任意一个模板生成成品。模板维护功能在：报表 -> 模板 中，显示为：XXXX。定义一个模板的过程为：

1）新增一个模板，输入模板代码（不能重复）、模板名称、模板文件。

2）把模板 Excel 文件拷贝到文件对应目录下，建议存放路径为：`Symbol\Module\`。

3）确定是否需要增加扩展公式。一般情况下，生成成品上的一列和一个显示列对应，但是有的情况下，模板的列更少，所以需要把几个显示列合并到一个 Excel 列上。例如：对于电缆，显示列分「电缆型号」、「电缆规格」、「备用」三列，但是成品可能只要「电缆型号 - 电缆规格 - 备用」一列体现。这就是一个扩展公式。在上面界面中，设备清册中把设备的型号、规范分成两列，但是最终成品要体现「型号规范」一列，所以增加一个列公式「StyleSpec」，内容为：`CmpntStyle+' '+CmpntSpec`，表明是数据库两列 CmpntStyle 和 CmpntSpec 以空格连接。多个模板的扩展公式如果类似，可以用进行扩展公式的复制、粘贴，设置完成后用保存扩展公式定义。扩展公式中，公式不能写错，否则导致成品生成失败，可以用检查公式设置是否正确，如果正确，显示查询结果，否则包错。

4）设置模板公式。运行 XX，选择「启用宏」后，自动打开模板文件，并出现「模板公式设置」对话框，显示为：XXXX。在「模板公式设置」对话框，列出了报表定义中所有选中的列以及定义的扩展列，用「设置公式」把当前选中的公式填写在选择单元格中。公式设置后，可以用「公式预览」查看设置是否正确，在当前公式位置显示该公式的名称，用于检查。如果设置正确，用「取消预览」取消公式名称。保存退出，模板定义完成。

## 0301. 图纸目录

图纸目录用于维护、管理当前工段的图纸目录和文件。可以生成图纸目录成品。

1、查看文件。查看客户端的文件，修改后不替换掉服务器上图纸。需要替换必须用「上传」功能。

2、文件夹。查看客户端成品所在的文件夹。

3、增加文件。把已有的一个成品挂到当前工段目录下。

4、删除文件。多选文件后，删除图纸目录和客户端文件（文件删除到垃圾箱）。服务器上文件保留不删除。

5、文件导入。成批把硬盘上的文件导入到当前成品分类上。点击后出现选择文件界面，多选后，出现修改图号、图名界面：XXXX。在此修改图号、图名后即把当前这些文件挂到成品分类下，并上传到服务器。

6、上传、下载。把选中的文件上传到服务器或者从服务器下载到本地。

7、图纸目录成品生成。

## 0401. 工艺条件

该模块用于导入工艺专业提给自控专业的条件表，自动生成仪表索引；工艺条件变动后，重新导入该条件表，自动列出工艺参数变动记录。如果条件表上位号有删除，则提示仪表索引表上是否也删除。

包括：工艺条件表模板定义、工艺条件导入、管线设备表、条件浏览四项功能。

### 4.1 模板设置

根据不同单位的做法，有的单位把温度、压力、流量、液位、调节阀各类条件列在一个大表中，有的则是分别列在多个表格中。软件通过模板设置支持以上两种做法，不过一般还是建议尽量采用大表的做法，修改和维护起来比较方便。

点击按钮，出现以下界面：

在该界面提供「增加模板」、「删除模板」、「查看模板」、「设置公式」、「公式读取」以及「模板查找」等功能。这里我们预先定义了两个模板，分别是工艺数据表导入和仪表索引表模板模板。后面一个模板用于在已有仪表索引表情况下直接把索引表导入。

「设置公式」功能和「报表」模块的模板定义功能类似，也是通过可视化界面定义模板的公式，界面为：XXXX。在该界面上，列出了所有的仪表索引字段，选择一个相应字段并选择 Excel 上的位置，点一下「设置公式」，即添加了一个公式。公式数量都是 1，只有数据表公式数量都大于 1。定义完模板公式后，必须用「公式读取」把公式读取进入数据库。

### 4.2 条件导入

条件导入过程。点「下一步」，出现文件和模板选择界面，选择需要导入的条件表以及对应的模板：（注意：条件表的格式和模板必须一致）。

在该界面选择导入参数，其中：1）导入所有 Sheet，适用于多 Sheet 的 Excel 文件。2）进行位号删除检查：选择该选项后，如果删除了一个位号，软件提示是否删除整个回路。3）支持多工况导入：参见下面章节。4）功能号以 G 结尾（例如：TG、PG 等）为就地仪表，如果不是 G 作为识别，也可以修改成其他字母。下一步点「导入」，以进度方式显示导入进入，直至导入完成，导入后显示导入位号数量，同时列出本次导入的变动记录。

1『试验的时候，第一行是空着的。其中以 XX 结尾的为就地仪表，这里只填写 G。（2020-10-28）』

### 4.3 工艺条件修改导入

如果工艺专业又提了一个版本的工艺条件，我们直接导入软件，软件能识别出和上一个版之间的差异。如果工艺专业删除了某些编号，则提示用户是否从仪表索引上删除记录。

例如，本次记录导入后发现位号需要删除，出现以下界面：XXXX。一般情况下应该选择删除，保证工艺条件和仪表索引之间数据的一致性。软件提示本次导入的变动情况。包括：增加的位号，修改的内容，删除的位号提示，变动记录可以导出成 Excel 文件，如果导入记录过多，建议删除，以免数据量太大而影响数据库性能。

1『先乔把数据修改的记录在导入的时候体现出来，而我目前考虑的是在 web 那边体现。这点还需要考虑。（2020-10-28）』

### 4.4 管线设备表

工艺条件导入的时候每一个仪表都有安装位置：即管线 / 设备号，每一个仪表在数据表中需要填写管道材质、法兰标准、法兰等级等内容，而这些内容实际和管线 / 设备号关联。为了减轻在数据表中录入的工作量，在此为每一个管线 / 设备定义相应的工艺参数，这些参数自动返回到数据表上。界面为：XXXX。

最主要是管线等级 / 设备号一栏，只要仪表的安装位置中包含着里面的内容，例如：管线号实际为 `1"-12-NA04-A2E-ST`，相应的管道等级为 `A2E`，其管道材质 = 00Cr19Ni10，法兰等级 = CL150，法兰密封面 = RF。点「更新」则更新数据表上的内容。万一遇到某种特殊情况不符合该规律，则在「例外」中定义特殊规则。

### 4.5 工艺条件浏览

工艺条件导入后，点按钮可以进行数据查看。选择报表后以及根据回路或者位号的过滤条件，点「确定」，显示结果为：XXXX。

颜色说明：黄色的为回路编号；白色的为回路下的构成；浅蓝色的为就地表。

上面数据的报表定义在「报表」模块中：1）显示列的内容自动根据模板中的公式获得。2）报表的过滤条件为：ISProcess=1，表示所有内容为工艺条件导入的内容。在仪表索引表中手工增加的内容 ISProcess 值为 0，不会出现在该报表中。3）排序方式为：表示先按照 T, P, F, L, A 等回路功能排序（CustomSort），之后按照一个回路之内的先后次序（CmpntSort）排序。

### 4.6 多工况工艺条件表导入

有些涉外项目存在一个位号存在多个工况的情况，这样从条件表上就需要支持一个位号多个工况的条件导入，在数据表和录入和生成时也能支持多个工况。

由于条件表一般不能随便新增加一个项目，建议通过在已有的列上填入工况，我们建议填写在「仪表功能」这一列上，例如：针对于 1561PV-101A 这个位号，共分 4 个工况，位号只在第一个工况上填写，工况之间不要有空行。在条件表导入界面，需要把「功能号」内容为工况选上：功能号。如果当前项目不需要支持工况，则设置成：无。

## 0501. 仪表索引

仪表索引模块用于管理回路及回路的构成，生成仪表索引表成品，该模块为整个软件的核心模块，后面的各个模块都会用到这里的数据。包括以下三部分：回路分类、回路、回路内容。

1『回路的这 3 大块内容很值得借鉴。（2020-10-28）』

回路分类。回路分类用于区分每一个回路大类，一般分为温度、压力、流量、液位等，允许自定义。设置在「基础数据」设置的「回路功能分类」中。例如：「一、温度」过滤条件为「Funccode like 'T%'」表示功能号以 T 开头的归到这一类中。回路分类下再按照功能号分类，并显示每类的数量。

回路。回路显示为当前回路分类下所有符合条件的回路编号等内容。显示的内容由代码为「LoopList」的报表定义。回路区分集中回路和就地表两种，由字段「回路类型 —LoopType」区分：0 - 集中回路、2 - 就地表。（另外还有 1 为集中回路下的仪表）。

回路内容。对于集中回路，回路内容为回路下的构成，例如：TI 回路下的内容为 TT，TIC 回路下的内容为 TT、TV。对于就地表，回路内容为就地表本身，也就是就地表的回路和回路下内容就是同一条记录。

1、增加集中回路。增加回路包括：增加集中回路和增加就地表两种方式。菜单为：（右键）。增加集中回路的过程为：

1）在「回路」中输入回路编号和回路用途。

2）在「回路内容」中选择「插入仪表」或者「增加仪表」，出现：XXXX。默认位号 T-1068 是根据回路的功能「T」和序号「1068」自动生成的，这时候需要修改一下功能号就可以了，例如位号为：TT-1068。把位置定位到仪表名称上，此时根据位号的功能号「TT」出现下拉，选择合适的仪表名称。关于仪表名称的定义参看「仪表名称定义」说明。

1『这里，仪表名称（温度变送器、一体化温度变动器），要一个个点选，很不友好而且低效。（2020-10-28）』

3）定义完整的回路构成。

2、增加就地仪表。1）选择「增加就地表」，在「回路」中输入就地表编号和用途。2）把鼠标定位到「回路内容」，出现了刚才输入的就地表编号内容，在此输入仪表名称等内容即可。

3、集中回路和就地表的切换。集中回路或者就地表的类型是在增加的时候用户自己选择的，如果需要修改，可以通过进行切换。

4、删除回路。回路可以成批选择后删除，在「回路」中把需要删除的回路选中后，选择「删除回路」，出现确定删除界面，确定后直接删除，删除回路时删除回路下的构成。回路删除后可以回收，用「回路回收」功能。

5、回路回收。点 XX 按钮，出现回路回收界面。选择需要回收的回路，点「回收」按钮进行回收，点「删除」功能确定最终删除。回收界面分「回路 / 就地表」和「仪表」两页，根据回路回收会把回路下的构成一起还原，而仪表回收只是单独回收当前选择的仪表。

6、回路参照。选择一条参照源回路，点击「参照」，出现参照界面：XXXX。上面界面列出了所有和参照源回路功能号相同的回路列表，打勾选择哪些需要参照，确定即可。回路参照出错的处理。

1『回路参照，完全没有直接在 excel 里批量修改来的快。（2020-10-28）』

7、下拉值。下拉值用于为每一个字段定义常用下拉值，允许方便地选择。选择当前需要定义的字段，点出现以下界面：XXXX。输入常用值，确认即可。

8、回路排序。在仪表索引中增加过数据后，在生成仪表索引成品前，都必须执行该功能实现回路排序。回路的排序方式定义在「项目设置」中：XXXX。这里的排序功能直接读取「项目参数」中已经设定的排序方式进行排序。各排序方式的含义参看「第一章」内容。选择「确定」即可。

9、仪表名称定义。仪表名称是根据仪表的功能号自动出现下拉的，在此设置功能号和仪表名称之间的对应关系，一个功能号对应多个仪表名称可以以逗号间隔。

10、回路浏览。按照排序后的次序浏览回路数据，直接调用报表定义中编号为 LoopList 的报表。在此可以成批修改回路的数据，但是对回路编号的修改建议在仪表索引界面修改。

11、仪表索引浏览。该界面显示回路 + 回路构成的完整结构，并生成仪表索引成品。界面为：

在此界面允许成批修改仪表索引的数据，并且可以导出成 Excel 文件。「统计」功能可以实现自定义字段分类统计，例如：XXXX。成品生成界面如上，在此双击目录自动给定图号、图名等参数，并选择相应的模板，生成仪表索引成品。在此给定图号、图名等参数，并选择相应的模板，生成仪表索引成品。

12、仪表索引导入 / 导出。如果索引表做完后需要进行备份，或者下班后需要到家里继续工作（家里需要安装本软件），可以通过该功能把整个仪表索引（注意：包括了工艺条件表、仪表索引表、I/O List、监控数据表、导出条件表、仪表数据表等所有内容）导出成文件，把该文件进行备份或者复制，需要的时候从文件进行导入操作即可。

1『不可控性多。比如：1）导出仪表索引成品时，excel 里的宏（VBA，显示没有注册类，先乔里报错：RPC 服务器不可用）运行错误，目前无法解决。2）软件里涉及「设置公式」的功能都用不了，因为也是涉及到 VBA。回复：仪表索引表在「数据表」模块那边可以跟仪表的数据表一起导出来。导出文件的位置是在 D 盘下「INPowerProduct」文件夹下面的项目文件夹下。（2020-10-28）』

## 0601. 数据表

数据表模块用于为各类仪表录入数据表的内容，并成批生成成品。该模块主要功能有：

### 6.1 模板设置

用于定义数据表模板的公式，界面为：XXXX。

1『里面各个仪表数据表很全面，有些信息可以借鉴。』

在此可以增加、修改、删除模板并且定义模板的公式。导出模板用于把当前选择的多条模板导出到一个文件夹，导入模板则是反向操作。注意：导入、导出模板除了模板文件的拷贝外，还包括该模板对应规格项的设置信息，和单独拷贝模板文件是不同的，单独拷贝文件会缺少规格项参数信息。点击「设置公式」，出现以下界面：XXXX。

在软件中，分工艺数据和规格数据两类数据库字段，这两类字段的区别是：1）工艺字段的字段名称是固定的，也就是在报表定义中已经给定了的，所有数据表中都是这一个名称，例如：用途、仪表名称、P&ID 图号、安装位置等等。2）规格数据的字段名称不是固定的，而是根据每一个数据表再定。例如：温度类仪表需要字段：分度号，阀门数据表需要：选用 Cv。。。。。。。由于这些字段名称叫法比较灵活，不适合全部固定掉（这样会导致工艺字段过多，也不方便选择），所以在每类仪表中由用于自己命名。界面为：XXXX。

### 6.2 数据表查询 / 选择模板

选择一类仪表名称以及对应的数据表模板，例如：XXXX。该界面上的「修改」按钮选择后，用「自动模板」按钮把和仪表名称一致的数据表模板自动匹配，当然也可以手工选择数据表模板。如果上面列出来的有些仪表名称的确是不需要选型的，则可以把最后一列打勾去掉，由于选项打开了，不需要生成的不在这里列出来。

### 6.3 数据表维护

选择「查询」后进入数据表录入界面：XXXX。灰色的是工艺条件导入参数，不能修改。如果需要修改，需要进入工艺条件模板修改。

数据表维护界面包括：

1、横向录入。以横向表格方式录入，支持 Excel 导出，修改数据后导入。成批修改只能用「批修改」方式，不支持选中一片范围的拷贝粘贴。

2、竖列录入。以竖向的方式录入，支持选中一片范围的拷贝粘贴。这是建议最常用的手工录入方式。

3、Excel 预览。数据输入后，预览成品生成的效果。预览界面不允许数据录入。注意只能预览一个位号的效果，不支持多个位号的显示效果。

4、下拉。下拉功能用于为当前选中规格项定义常用值并且自动下拉。界面为：XXXX。下拉设置。下拉定义的值有些是和某一个数据表相关联的，例如：型号，每一类数据表都有自己的型号；有些规格是所有数据表可以通用的，例如：防爆等级。软件通过该按钮设置哪些规格项是和数据表相关联的。界面为：XXXX。打勾的那些列下拉值和每一个数据表关联。

5、参考。下拉功能用于参考其他位号的规格项数据，允许参照本工段、本项目其他工段、其他项目的所有位号。界面为：XXXX。

参考项目、参考工段默认为当前登陆项目和登陆工段。左边为当前选型的所有位号，默认全部选择，中间的参考位号相当于数据源头，如果觉得其他项目后者其他工段的 FT 位号可以参考，则修改参考项目和工段后选择一个位号，点「参照」按钮即可。当前参考前可以用「查看」看一下数据源的内容：XXXX。右边的参考字段相当于哪几个规格项的内容从数据源拷贝过来。

6、隐藏列。有些数据表，例如：调节阀，由于工艺项数据太多，导致规格项录入界面非常小，在这种情况下，可以把某几列无关紧要的项目隐藏掉，以便放大输入界面。界面为：XXXX。直接把需要隐藏的列去掉打勾即可。

### 6.4「字段复制」设置

监控数据表中有些位号，例如「磁致伸缩液位变送器」的「量程范围」没有内容，这是因为监控数据表的「量程范围」用了字段 MeasureRange，而「磁致伸缩液位变送器」这一项内容是录入在一个规格项字段上了，导致获取不到。解决办法：

1、重新定义规格书模板，把「液面测量范围」这个规格项字段用 MeasureRange 代替。代替后，原来输入的内容需要重新输。这么操作比较麻烦，而且可能涉及一系列的数据表模板。不建议采用该操作。

2、在数据表录入工具条上，增加了功能「字段复制」。界面为：XXXX。选择左边的 MeasureRange 字段，再选择右边的 SPUDF4 字段，点「增加对应」，增加了一项设置。相当于把 SPUDF4 的内容更新到 MeasureRange 上，设置后，退出数据表录入界面的时候自动更新内容。

注意：1）该设置每一个数据表都可以单独设置。2）如果两个数据表设置相同，第一个模板设置后，点「拷贝」，之后进入另一个模板点「粘帖」。3）在数据表模板设置界面的，也可以进行该设置。一个项目设置后，把数据表模板同步到另外一个项目的时候自动带上该设置。4）退出数据表录入界面的时候自动更新内容。

### 6.5 多工况数据表的录入

如果一个位号有多个工况，在「竖向录入」只显示第一个工况的内容，而完整工况在「多工况录入」界面中维护，界面为：XXXX。多工况界面的操作和单工况操作基本类似，修改后点保存即可。

### 6.6 成品生成

成品生成用于最终成品的生成，界面为：XXXX。这里面列出了所有需要生成的数据表，排列次序和数据表模板的次序一致。如果需要调整数据表生成的先后次序，只要进入数据表模板界面，把次序一列的内容修改一下即可，界面为：XXXX。

由于一般数据表是一个大图号，返回到仪表索引的时候数据表号都是相同内容，不太好区分，所以允许返回到仪表索引的是子图号，默认为：[DwgNo]([Page])，相当于是大图号 +（每类数据表开始页号），例如：07032-191J-P-3 (002)，07032-191J-P-3 (010)......

成品生成有几个参数：

1、总页数、开始页号。数据表上的页号生成有两种方式：一种是用公式生成，[Page] 代表当前开始页，[PageCount] 代表总页数，另一种方式是利用 Excel 的页眉自动生成页号。我们建议用户采用后一种方式，如果手工插入一个 Sheet 或者删除一个 Sheet，页号能自动连续。如果采用公式生成页号，如果只想生成中间的一类或者几类数据表，软件自动根据用户手工给定的这两个参数，在成品上填写公式。

2、数据表图号。默认采用 [DwgNo]([Page])，代表每类数据表的图号是大图号 +（每类数据表开始页号），例如：07032-191J-P-3 (002)，07032-191J-P-3 (010)。如果采用 [DwgNo]-[NO] ，代表每类数据表的图号是大图号 +（每类数据表流水序号，即 1，2，3。。。），例如：07032-191J-P-3-01，07032-191J-P-3-02。。。。。。

3、页号长度。上面数据表图号中用到了 [Page]、[NO] 这两个子图号，如果页号长度为 3，则 Page 和 NO 最终生成的数字为 3 位长度，例如：001，002；如果页号长度为 2，则为 01，02。。。。。。

3、生成数据表目录、生成数据表位号索引。如果把这两个参数选上，生成完数据表内容后，直接生成这两类成品。此时如果「成品合并到一个文件」打勾了，则最终的成品为一个文件，内容次序依次为：数据表目录 + 数据表位号索引 + 数据表内容。

4、Sheet 命名方式。每类数据表往往生成很多个 Sheet，Sheet 名一般根据第一个位号进行命名。当然也可以选择序号命名。设置界面为：XXXX。

5、成品合并到一个文件。如果选择了该选项，最终的成品为一个文件，内容次序依次为：数据表目录 + 数据表位号索引 + 数据表内容，文件名为按照图号命名，例如：07032-191J-P-3.dwg。如果该选项没有选择，成品文件拆分为多个。

1『导出文件的位置是在 D 盘下「INPowerProduct」文件夹下面的项目文件夹下。（2020-10-28）』

### 6.7 多工况成品

多工况的位号，在成品生成后作了以下设置：

１、Sheet 命名带上了「工况名」。

２、用途中带上了「工况名」。

３、修改标记（数据表公式中字段为「REV」）中带上「工况为：工况名」。

### 6.8 仪表安装条件索引

仪表安装条件索引用于给工艺提资，内容包括每类需要安装的仪表名称、位号及 P&ID 图号。成品格式为：XXXX。首先在报表模块里可以看到以下报表：XXXX。

该报表定义在「条件提交」下，但是由于不是默认报表，在条件提交生成时不会出现，只是内部报表，模板里定义了成品模板格式。进入「数据表」模块，首先需要读取模板公式，界面为：XXXX。

在「数据表」模块的「安装条件索引」下选择「模板定义」，可以看到定义了一个模板文件，点一下「公式读取」，自动读取模板公式（每个项目只需要读取一次；或者一个项目公式读取后，退出的时候选择需要同步，把公式同步到其它项目，别的项目可以不需要进行公式读取）。

模板定义后，在数据表查询界面，打勾选择哪些仪表名称需要生成，界面为：XXXX。默认是需要「生成数据表」的也都生成「安装条件索引」，但是对于安全栅等部分需要不需要生成，可以点击「修改」去掉打勾，之后保存。

最后就是成品生成，点击「安装条件索引」，出现界面为：XXXX。默认图号取当前项目的图号格式，允许手工修改并且记忆，点击生成按钮生成最终成品。

## 0701. 汇总表

仪表汇总表是对每类仪表按照一定的规格项进行汇总后生成的成品，可以用于仪表概算。该模块的数据来源于仪表数据表和索引表。界面为：XXXX。

软件进入之前选择数据汇总范围：XXXX。默认汇总当前工段，也可以选择整个项目仪表的汇总。主界面左边是当前的所有数据表，软件显示了每一类数据表对应的仪表数量。右边是每一个数据表的所有工艺项和规格项，由用户决定每一个数据表进行汇总的项目。例如：不锈钢压力表，需要按照：刻度范围、测量元件形式、测度盘直径、精度等项目进行汇总，只要这些项目中的一个值不同，就会汇总分成不同的类。底下是最终每类数据表的汇总结果，每一类结果选择后，会显示当前类别下的位号和用途，以便查询。

1『汇总表也可以自己开发。（2020-10-28）』

1、汇总字段定义。选择一个数据表后，显示了该数据表的所有字段，包括工艺项和规格项，只要打勾就说明该字段要汇总，不打勾就不要汇总。打勾后，点「保存」按钮保存设置。注意：只有管理员才能保存汇总字段。

2、成品生成。点「成品」按钮出现界面：XXXX。一行能容纳的位号数量用于成品中的位号超过一行的填写格式。例如：一共是 5 个位号，现在一行能容纳 3 个位号，则分两行，第一行 3 个位号，第二行 2 个位号。效果为：XXXX。确定后，出现以下界面：XXXX。成品格式为：XXXX。规格项内容相同的放在一起，之后是不同的项以及位号等信息。

3、模板定义。进入「报表」模块的「仪表汇总表」，看到模板设置：XXXX。点设置模板，界面为：XXXX。

## 0801. 条件提交

该模块用于生成自控专业向其它专业提交的各类条件表，条件表上的数据可以来自仪表索引或者数据表，并成批生成成品。主界面上左边为所有定义的条件表以及每一个条件表对应的位号数量，右边为当前条件表的具体内容，允许修改。注意：为了使条件表防止遗漏某些应该提交的位号，报表定义中过滤条件应该尽量定义正确。

1『各个类型仪表的条件很全（华陆的），值得借鉴。』

1、维护条件表。定义条件表功能在「报表」模块的「条件提交」分类下，在此定义报表代码、名称、显示字段、过滤条件、模板。界面为：XXXX。

2、模板公式定义。

点击工具条上的按钮，定义模板的公式。界面为：XXXX。该界面中没有增加、删除模板的功能，因为模板的增加和删除需要在「报表」模块管理，这里只是显示了所有条件提交的模板。用「设置公式」功能设置模板的公式，设置后用「公式读取」读取。「公式设置」界面和数据表的模板设置完全一致，这里不再重复。

3、成品生成。点击「成品」按钮生成条件提交成品，界面为：XXXX。该界面只列出所有位号数量不为零的条件表，给定图号、版次以及是否需要合并成一个文件生成，软件自动调用 Excel 生成最终的成品。

## 0901. I/O List

软件自动根据仪表索引表上的内容自动生成 I/O List。自动生成的条件为：1）仪表索引中仪表必须填写 I/O 类型和信号类型。2）仪表索引中区分信号进入 DCS 还是 SIS 系统。3）根据仪表索引找到安全栅位号，根据 I/O 类型决定是输入还是输出安全栅。

1『这章的信息对自己开发 I/O 表应该很有用。（2020-10-28）』

I/O 系统列出了该工段所有的系统，例如：DCS、ESD 等。界面为：XXXX。选择 DCS，就显示 DCS 的 I/O List；选择 ESD，就显示 ESD 的 I/O List。一个位号可以同时进入 DCS 和 ESD，这个位号在两个系统的 I/O List 同时出现。这种情况下，仪表索引输入界面为：XXXX。最前面的是 DCS 的信息，后面的是 SIS 系统的信息。

进入前的参数：如果打勾，进入的时候首先重新生成 I/O List，否则只是读取上次生成的信息。如果仪表索引表修改过了，切记一定要更新 I/O 才能看到最新数据。

该 I/O List 可以根据自定义模板生成最终成品。进入报表模块，我们看模板定义，是否冗余这一项在生成如果要生成打勾，需要进行转换：XXXX。当是否冗余 NeedResu=1 的时候才返回打勾，否则空。

I/O 清册模块有个「统计」按钮，可以汇总信号的点数，界面如上，汇总结果可以导出成 Excel。

常见问题：I/O List 不选择」DCS」，出来的数量是对的，选择了」DCS」数量不对。这个问题原因在于仪表索引中的数据录入：DCS 系统和 SIS 系统用于 I/O List，监控系统用于监控数据表。监控系统里填写了 DCS，但是 DCS 系统没有填写，在 I/O List 中，选择了 DCS 就显示不出来了。解决办法：1）到仪表索引这个补充 DCS 系统或者 SIS 系统。2）进入「报表定义」-> IOList，把 IOSystem1 和 IOSystem2 两个字段选上：XXXX。之后进入 I/O List，选择所有数据查看：XXXX。在这里的 DCS 系统和 SIS 系统中补充内容，这些内容自动返回仪表索引。

## 1001. 监控数据表

监控数据表也是自动根据仪表索引表生成，生成条件为：在仪表索引中的「监控系统 —LinkSystem」字段中填写 DCS/PLC/ESD 等监控系统。在监控数据表中可以选择 DCS/PLC/ESD 系统，列出所有进入该系统的位号，界面为：XXXX。

在仪表索引表上填写监控系统举例为：XXXX。可以根据模板格式生成最终成品。

## 1101. 报警联锁

报警联锁模块用于生成报警联锁设定值表，该功能和监控数据表非常类型，也是根据过滤条件直接从仪表索引表上取数。报警联锁设定值表的设定条件是：高、高高、低、低低这 4 项报警值中有内容才在该表中体现，报表中定义为：XXXX。利用定义的模板直接生成成品。

## 1201. 安装图

安装图模块是利用典型图方式，建立常用的安装图集，一张安装图可以有多个适用条件，每一个适用条件对应一批材料。用户通过在仪表索引中的仪表和安装图的适用条件建立关联，自动统计所需的安装材料，并生成带位号和材料明细的安装图成品。主界面为：XXXX。

整个界面分三部分：1）第一部分是安装图纸目录和图纸的预览。图纸目录分三层：第一层为安装图分类，第二层为具体的安装图，第三层为该安装的材料选型方案。2）第二部分为一个选型方案对应的具体材料明细。3）第三部分为采用该安装图和材料明细的仪表数量。

### 12.1 安装图目录界面

1、增加安装图分类。安装图分类是一批安装图的大类名称。例如：1）温度，2）压力等。在软软件中，允许用户自定义新的分类并在该分类下增加图纸。注意：常用是当前工段所有用到过的安装图，为软件自动产生。显示界面为：XXXX。

2、增加安装图。在当前的安装图分类中增加一张新的安装图，图号不能重复。界面为：XXXX。增加时，要求 CAD 文件已经存放在相应路径下。

3、增加材料分类。为当前选择的安装图增加一种材料分类。界面为：XXXX。分类代码不能重复，而且分类代码必须包含安装图代码的内容。例如：安装图图号为 HK211，则该图纸的所有材料分类代码一般都应该 HK211 开头。由于不同的分类材料明细可能不同，而导致安装图上的材料数字编号有所差异，多个分类不一定能合用一张图纸生成成品。所以，在每一个分类界面允许录入一个 CAD 文件，如果不录入，以上面一层定义的为准，否则，以当前分类给定的图纸为准。

4、修改。根据当前选中的内容进行修改，如果选中安装图方案，则修改安装图方案；选中安装图，则修改安装图。

5、删除。删除当前选中的材料分类或者安装图。

6、复制。复制当前选择的安装图，直至粘贴才把复制的安装图添加上去。

7、粘贴。根据已经复制的安装图，增加一张相同安装图。粘贴后，出现界面，要求输入新的安装图号：XXXX。

### 12.2 材料明细界面

为一张安装图的一种适用条件用到的所有材料。软件提供「材料库」，把所有用到的材料用编号方式统一管理，这里是从材料库中取部分材料并给定数量。

1、增加材料。为当前材料分类增加一条材料。增加后，在材料代码中选择一条材料后返回。如果所需的材料在材料库中不存在，则首先增加后再选定。

2、删除材料。从该材料方案中删除选中的多条材料明细。

3、复制。复制该材料分类下的所有材料明细，用于在多张图之间材料明细的快速参照。

4、粘贴。把复制的材料明细粘贴出来并替换掉原有的所有材料明细。

### 12.3 安装图仪表界面

对应一张安装图的一种适用方式所用到的仪表，也提供所有仪表的查询。该界面包括两页：「当前安装图仪表」显示所有使用当前安装图的仪表；而「所有仪表」显示清册上的所有仪表，可以用过滤条件进行定位。

1、选定仪表。为当前选择的一批仪表指定一张安装图和一个材料分类。选定后，在「安装图」和「材料分类」两栏自动出现选中内容

2、取消选定。为当前选择的一批仪表取消指定安装图和材料分类。选定后，在「安装图」和「材料分类」两栏自动取消内容

3、刷新。刷新当前数据显示。

### 12.4 材料管理

维护整个材料库。每一条材料按照材料编码进行编号，编号必须唯一。包括增加、删除，以及 Excel 导入导出等。

### 12.5 安装图块定义

进行安装图生成的具体参数，包括块的文件、块的绘图位置，以及附页的参数定义。安装图生成时，如果位号过多（默认定义 10 个），一张图纸上放不下，自动添加附页，默认附页为 2 列，每一列 49 个位号，块文件的定义允许用户修改。

### 12.6 成品

安装图成品生成，界面为：XXXX。安装图生成时，总图号为成品上显示的图号。由于需要把图号返回到仪表索引，每一类安装图可以定义各自的图号，软件默认图号格式为两种：1）总图号 + 开始页数，例如：901-1-12 (03), 901-1-12 (08)….2）总图号 + 流水号，例如：901-1-12-01，901-1-12-02。安装图成品生成时，同时可以生成安装图目录以及位号索引成品。

### 12.7 安装材料汇总

当前所有安装图材料的统计，界面为：XXXX。利用「成品」功能，可以生成最终安装图材料成品。该材料汇总中，不包括附件厂供的仪表的安装材料。

## 1301. DCS 接线

DCS 接线用于完成现场仪表 -> 接线箱 -> 端子柜 / 安全栅柜 -> DCS 控制柜的整个接线过程，接线数据初可以生成接线表外，还直接被回路图模块利用，用于回路图的生成。

主要功能包括：1）设备类型定义。2）电缆类型定义。3）仪表导入。4）设备创建。5）电缆创建。6）接线箱接线。7）端子柜接线。8）更新接线表。9）导入 DCS 卡件分配信息。10）模板设置。11）接线箱成品。

### 13.1 设备类型定义

软件默认对设备区分了三种类型：仪表、接线箱、端子柜（安全栅柜）。设备类型相当于每一种设备的常用方式，例如：仪表类型包括 2 线制、3 线制，接线箱类型包括 24 端子接线箱、36 端子接线箱等等。利用定义好的设备类型可以快速直接创建具体的接线设备。

在「设备类型」窗口点按钮或者右键中的「增加」菜单，出现新建设备类型窗口，界面为：XXXX。软件把一个设备可以定义多个端子排，每一个端子排可以有任意多的端子。例如：24 端子接线箱，定义端子排为 1 个，端子数量为 24。端子排和端子的命名都是有规律的，例如：端子排命名为 TS-1,TS-2,TS-3…. 我们把编号格式选择为：TS-[NO]，选择绿色的按钮后出现编号后的端子排结果，例如：XXXX。

对端子的编号也是如此，如果端子数量为 24，端子编号格式为：[NO]，则端子号依次为 1，2，3。。。如果端子格式为：+,-，则端子号依次为 +,-,+,-……定义好设备类型后，点「确定」返回到主界面。

### 13.2 电缆类型定义

电缆类型用于定义常用的电缆规格，在实际需要用到该规格的电缆时用类型建立电缆更加方便。软件中把电缆定义为有多个对、每一个对有多个芯的层次结构。界面为：XXXX。最上面部分为电缆的信息，包括编号、名称、型号、规格等。注意：「成批电缆规则：」这一项，如果是分支电缆必须收入，因为分支电缆编号一般和位号有关，在引入仪表的时候可以自动生成分支电缆。设置效果为：XXXX。[CmpntCode] 为位号，[CmpntCode] C 相当于分支电缆编号为位号 +「C」。

「需要统计」这一项用于表明这一根电缆是否要汇总统计。一般接到接线箱的分支电缆是不统计的，而现场直接拉到端子柜的分支电缆是需要统计的，建议在建立电缆类型的时候就给定这个标记，这样最终的电缆会分成两部分：需要汇总的和不需要汇总的，界面为：XXXX。电缆对的定义和设备的端子排定义效果一致；电缆芯定义和设备的端子定义也一致。

### 13.3 仪表导入

「仪表导入」是指现场接线仪表成批导入进项目，导入的时候自动创建分支电缆。现场接线仪表应该就是 I/O 清册的内容。在软件中，需要接线的仪表定义在代码为 ConnectList 的报表上，I/O List 定义在代码为 IOList 的报表上，这两者的过滤条件应该是相同的。只有过滤条件相同，才能保证 I/O List 的位号 = 需要接线的仪表。设置界面为：XXXX。

导入仪表过程为：首先选择「接线设备」中的「仪表」，界面为：XXXX。只有点工具条上的按钮，出现导入界面：XXXX。这里面的仪表分为两类：「未导入」和「已导入」。「未导入」的通过「导入」功能自动放入「已导入」，「已导入」的通过「取消导入」又能放回到「未导入」里面。

在未导入界面，成批选择需要导入的位号，并选择分支电缆的类型和仪表的类型，点「导入」功能，出现提示界面：XXXX。确定即可。导入后可以到「已导入」查看所有导入的位号，界面为：XXXX。这里可以用「取消导入」功能取消导入，但是注意：导入的工程中已经自动创建了分支电缆，取消导入不自动删除取消点的分支电缆，需要手工删除。此时返回到主界面，可以看到导入后的结果：XXXX。

### 13.4 设备创建

设备创建主要是创建接线箱和端子柜 / 安全栅柜。创建过程为：XXXX。在设备类型中，选择需要创建的对象类别，例如是：24 端子接线箱，点图标或者右键选择「创建设备」，效果为：XXXX。在创建设备界面输入设备编号，例如：JB-1001。

创建端子柜的过程也类似，例如：XXXX。创建后在「接线设备」查看：XXXX。一般常用的接线设备应该包括：接线箱、端子柜、安全栅柜、电源柜等。在本软件中，把这些设备都抽象成一种设备：一个设备对应对个端子排，端子排编号可以自定义，每一个端子排对应任意多的端子，端子编号也自定义。

### 13.5 创建电缆

由于分支电缆在仪表导入的时候自动创建，这里要创建的电缆是接线盒和端子柜、安全栅柜后面出来的电缆。在「电缆类型」中，点 图标或者右键选择「创建电缆」，效果为：XXXX。可以输入电缆编号、电缆长度、套管长度后确定。在「电缆」中可以看到新创建的电缆：XXXX。

### 13.6 接线箱接线

接线设备和接线电缆都建立后，可以完成设备的接线过程了。在「接线设备」页，选择一个接线箱，例如：JB-1001，点图标或者右键选择「接线」功能：XXXX。出现设备接线界面：XXXX。最上面的是端子排选择。如果该设备有多个端子排，可以在这里切换。右边的是接线电缆，可以成批选择电缆（针对于分支电缆）或者成批选择电缆的对（针对于多对的电缆），点图标或者右键选择「连接」，则在当前选择的设备端子上进行接线。

上面的界面，我们首先把光标定位在左边的第一个端子上，选择 4 根分支电缆接线；之后把光标定位在右边的第一个端子，选择 JB-101C 的 4 对进行接线。如果 JB-1001 的 9，10 端子是空的，接下来要接 11 端子，只要把当前光标定位到端子 11 上，进行电缆接线即可。

### 13.7 端子柜接线

端子柜接线有两种情况，一种是接线箱出来的电缆接到端子柜，另外一种是分支电缆直接接到端子柜。选择端子柜后，选择「接线」功能：XXXX。接线界面显示为：XXXX。刚才的接线连接了 JB-101C 这根电缆的一端，在这里选择 JB-101C 的这 4 对连接到 MB-1001 的 TS-1 上，从而完成这根电缆两边的完整对接。不经过接线箱的分支电缆也可以直接接到端子柜上。如果一根电缆已经两端接完，继续进行接线，会出现以下界面：XXXX。

### 13.8 更新接线表

上面的接线过程最终完成后，需要把接线过程形成的数据返回到接线表上去，才能生成最终的成品。在工具条上看到该按钮：「更新接线表」，点击一下即可。更新结果可以点「接线表」，在以下界面看到：XXXX。这个表格里面，分支电缆的接线信息、就地接线箱、接线箱电缆、端子柜等信息都是自动生成的。但是这几列数据是空的：XXXX。DCS 机柜号、通道号、卡槽号的信息可以通过导入 DCS 卡件分配表进行补充。

### 13.9 导入 DCS 卡件分配信息

上面的接线过程已经完成，但是最终生成的回路图上还缺少了 DCS 机柜和卡件、通道等分配信息。这些信息一般都是 DCS 厂家提供的。在本软件中，可以通过 Excel 表格把这些数据导入进来。在上面的「接线一览表」界面，我们看到 DCS 机柜号、通道号、卡槽号这几列信息是空的，我们只要这么一个格式的 Excel 文件：XXXX。

表格第一行是标题，标题和软件里面的列名称必须完全一致，列的次序和位号的行次序可以任意，只要这个文件里面补充了 DCS 机柜号、通道号、卡槽号这三列数据，通过「向导」功能中的「1. 接线表导入」进行导入：XXXX。导入后我们在这几列中看到了数据，就可以了。

说明：虽然 DCS 厂家提供的分配表格式各不统一，但是我们对这个文件只有最基本的要求：1）每一个位号一行。2）除了位号外，只需要卡件分配的几列数据。3）列的标题修改成和软件的列名一致。

软件中对 DCS 分配表的列名命名也可以修改，进入「报表」模块：XXXX。这里的字段名称修改一下，保存即可。

### 13.10 模板设置

模板设置用于设置接线箱接线图的模板，界面为：XXXX。模板设置公式过程和设置数据表模板完全一致。注意的是，设置完公式后，需要点「公式读取」功能读取公式数据。这里设置的模板，在设备类型定义中可以直接选用，例如为 24 端子接线盒指定模板：XXXX。

### 13.11 接线箱成品

该功能用于生成以接线箱为单位的接线图。点击「接线箱成品」，出现界面为：XXXX。选择「生成」即可，最终成品效果为：XXXX。如果补充了 DCS 卡件分配表，该表上的卡槽号等信息也自动生成。

## 1401. 电缆表

该功能用于统计「DCS 接线」模块生成的所有的电缆，并且可以成批设置电缆长度、修改电缆型号等。这里的数据和「DCS 接线」数据直接关联，修改后 DCS 接线中也直接更新。主界面为：XXXX。工具条上「汇总」功能用于统计每类电缆的根数和长度汇总：XXXX。

## 1501. 回路图

回路图模板直接读取「DCS 接线」模块的接线信息，生成回路图。回路图生成有两种方式：1）一种是套用 Excel 模板生成，模板整理工作量比较大，需要把每种类型的回路方式做成模板，优点是能够完成所有复杂回路的生成。2）另外一种是 AutoCAD 格式自动生成的回路图。采用这种方式，软件自动把回路图图框和接线信号表示的块拼接出回路图，优点是没有模板工作量，只要实现把各种信号类型代表的块整理好即可，软件根据回路构成自动绘制图纸。缺点是只能生成有规律的回路图，对于复杂的和非标准的回路图则生成后还需要手工调整。

两种回路图的切换在「项目参数」中设置，界面为：XXXX。这里我们优先介绍「套用模板生成回路图」方式。进入模块，主界面显示为：XXXX。左边是所有回路图模板。模板分为两层结构，第一层是回路图分类，模板挂在每一个分类下。右边是所有回路数据。回路数据定义在「报表」中，界面为：XXXX。

最主要是利用了这里的过滤条件，从所有回路中搜寻出所有符合条件的回路：1）LoopType=0 搜寻出所有回路。2）`Service<>’空’`，是把那些回路名称 `= ’空’` 的空回路过滤掉。用户也可以根据自己需要筛选掉无效的回路。

右边还有一个「接线仪表」小窗体，如果当前选择回路已经在「DCS 接线」模块接线，这里显示出该回路的接线对象，否则显示为空。界面为：XXXX。

回路图模块主要功能有：1）维护回路图分类。2）维护回路图模板。3）回路图模板定义。4）回路过滤。5）设置回路图模板。6）回路图生成。

### 15.1 维护回路图分类

在「回路图模板」窗口点按「新建」钮或者右键选择「增加回路图分类」出现以下界面：XXXX。在该界面给定分类代码（不能重复）、分类名称和次序（决定分类显示的先后次序）即可。如果要修改分类，点按钮或者右键选择「修改」，出现当前分类修改界面：XXXX。修改后保存即可。点「关闭」按钮或者右键选择「删除」功能，可以删除当前选中的分类。

### 15.2 维护回路图模板

选择一个分类后，可以在该分类下增加回路图模板。点点按钮或者右键选择「增加回路图」出现以下界面：XXXX。

在输入界面给定的信息有：1）回路图代码：不能重复。2）回路图图名和英文图名。3）模板文件：可以点打开按钮选择目录下的一个文件。4）回路数量：确定当前模板是一个回路还是两个回路。对于简单的指示回路，可以支持一个模板 2 个回路。5）次序：决定模板排列先后次序。6）仪表功能列表：暂时没用。

点「修改」按钮或者右键选择「修改」，出现当前选择模板修改界面，界面和增加模板一致。点「关闭」按钮或者右键选择「删除」功能，可以删除当前选中的回路图模板。右键选择「查看模板」功能，可以直接查看模板。对于比较类似的回路图模板，在增加一个后，可以通过「复制」按钮进行复制，并且用「粘贴」功能后出现模板代号修改界面：XXXX。当前显示的复制的代码，修改成不重复的代号后在模板中增加了一条相同的模板。

### 15.3 回路图模板定义

首先我们看模板中所有支持的公式。进入报表模块，找到「接线一览表」，该报表的所有字段就是回路图支持的公式。公式格式为：[字段名。接线位号次序]。查看一个模板，显示为：XXXX。该回路图上有两个接线位号，第一个位号公式的后缀是 1，第二个位号公式后缀是 2。公式可以是批注，也可以是文本框文本。一般常用的公式有：`.1` 代表第一个位号，修改成 `.2` 代表第二个位号，依次类推。

### 15.4 回路过滤

项目里如果回路比较多，利用这个过滤功能比较方便。回路过滤功能可以根据位号或者回路名称进行过滤，界面为：XXXX。输入部分内容即可过滤，内容为空即查询所有。

### 15.5 指定回路图模板

选择一个回路图模板，在右边多选所有符合该模板的回路编号，用按钮或者右键菜单中的「选定模板」功能设置模板，设置后回路颜色为蓝色，并且在「回路图模板」列显示选择的模板编号。界面为：XXXX。按钮或者「取消选定」菜单是反向操作，可以把已经设置了模板的回路设置成空。

### 15.6 回路图生成

点击工具条上的「回路图成品」按钮，出现成品生成界面：XXXX。该界面显示了所有要生成的回路，但是默认选择打勾的只有那些进行过接线的回路。该界面显示的图号格式等设置和数据表、安装图生成界面的功能完全一致。生成的成品格式为：XXXX。

## 1601. 工程计算

工程计算模块提供了常用的计算模块，目前只有调节阀计算，以后将陆续增加更多计算。主界面为：XXXX。进入计算前，首先要确定哪些位号是需要计算的。进入报表模块：XXXX。默认的过滤条件是功能号为：`'TV','PV','FV','LV','XV','HV','AV'` 同时不是厂供的阀门。选择调节阀后，出现以下界面：XXXX。

我们首先需要给定介质状态是液体、气体还是蒸汽。例如：我们给部分指定了介质为气体，结算结果为：XXXX。为了计算最大开度，还需要输入选择 Cv 值，计算结果为：XXXX。计算后，点保存按钮，出现对话框：XXXX。如果选择了确定，则把计算 Cv 值、选择 Cv 值、最大开度三项返回到数据表上。

## 1701. Intools 接口

Intools 接口用于把 INDesign Instrument 软件生成的仪表索引数据导入 INtools 数据库，自动创建仪表名称、管线编号、设备编号等各类关联表，相关数据自动进入 Intools 的 Process Data、Index、Spec 模块。主界面为：XXXX。

首先必须指定 Intools 的安装路径下的 intools.ini 文件，选择后点「下一次」，出现本软件工段和 Intools 工段的对应设置界面：XXXX。例如我们选择把 801 导入到 Default 工段，再选择下一步，出现以下界面：XXXX。就地表判断用于区分软件中哪些位号是就地的，导入到 Intools 时自动创建编号相同的回路和该回路下的仪表。软件默认功能号 G 结尾的为就地表，例如：TG、PG 等。导入的仪表索引效果为：XXXX。

## 1801. 接口

「接口」集成了一系列软件中比较实用的辅助工具。

### 18.1 服务器 -> 单机数据传递

该功能用于安装单机版后把服务器上的项目导入到单机上，点「接口」中的该功能：XXXX。该工具用于把整个项目数据库和图纸自动从服务器同步到单机上，不需要进行数据库恢复以操作，只需要选择一个项目后传递一下即可。如果单机上原来没有该项目，则自动创建该项目；如果已经有该项目，则替换原项目。

## 1901. 软件维护和更新

### 19.1 项目之间参数同步

在软件中，很多界面都有功能，该功能用于项目之间参数设置数据的相互传递。软件中，一个项目是一个完全独立的数据库，所有参数、模板、图纸、数据都存储在该数据库中。但是这种结构也会存在不方便之处，例如：用户在一个项目中增加了一些图例、模板、报表，想要在已有的其它项目中也同样如此，会有很多重复工作。该功能就是解决这个问题。

用户在所在界面上运行「同步」，显示为：XXXX。同步范围，是以本项目为标准，向其它所选择项目更新的数据内容。例如：同步范围是「报表定义」，则只更新报表定义，不影响项目数据。选择一个需要数据源项目，用「备份」功能把数据导出成一个文件。之后，登陆目的地项目后，在「从文件恢复」中选择刚才备份出来的文件，点「恢复」即可把文件内容更新到当前登录项目。

注意：1）同步只影响报表定义、模板、基础数据等内容，不影响图纸、表格的内容。1）操作之前，最好备份被参照数据库。3）同步功能请谨慎小心操作，只有管理员和主设人才能进行该操作。4）恢复只能恢复到当前登录项目

### 19.2 软件和数据库更新

本软件是网络版软件，分客户端和服务器安装。服务器上也有所有客户端文件，用于供客户端机器进行更新下载。