# 问题记录

## 01

切换到本地开发环境后，小程序无法从 api 里获取数据。

最终定位到 BaseController.php 文件，目前的理解，应该就是本地环境跟 Dingo 冲突，导致 Dingo 做的 API 有问题。

```
/**
 * 返回接口数据
 *
 * @param array
 * @return mixed
 */
protected function success($data = []){
    $data =  [
        'code' => 0,
        'status' => 'success',
        'data' => $data
    ];
    return $data;
    // return $this->response->array($data)->send();
}
```

直接返回数据，不要用 Dingo 返回数据的方式。

解决问题的过程中学会了根据数据流的走向一步一步排查，打断点。

```
var_dump(变量名); 
exit;
```

打断点更方便，就不需要用 exit 语句了。

断点调试应该是最低级的测试，进阶测试去看相关的书籍。更高级的是学会单元测试。

1、打断点：在某一需要打断点的代码行的最左边（不要超出编辑框）鼠标双击，就会出现一个圆形的点，这就是断点。

2、debug 方式运行程序，当程序运行到此处时，程序就会停下来。

3、调试：按F5进入方法内部；按 F6 跳过，让当前运行；按 F7 跳出返回上一层程序；按 F8 直接运行到下一个断点。

对于初学者来说，对于在何处打断点是比较迷茫的，可以增加断点数，调试多了，以后就熟悉了。

### VScode 实现 PHP debug

1、安装插件 PHP Debug 。

2、安装 xdebug。

[Xdebug: Documentation » Installation](https://xdebug.org/docs/install)

    pecl install xdebug

安装完的信息：

```
local/Cellar/php@7.3/7.3.15/pecl/20180731/xdebug.so

Build process completed successfully
Installing '/usr/local/Cellar/php@7.3/7.3.15/pecl/20180731/xdebug.so'
install ok: channel://pecl.php.net/xdebug-2.9.3
Extension xdebug enabled in php.ini
```

3、在 php.ini 里修改：

```
zend_extension="/usr/local/Cellar/php@7.3/7.3.15/pecl/20180731/xdebug.so"
xdebug.remote_enable = 1
xdebug.remote_autostart = 1
```

[Xdebug: Support — Tailored Installation Instructions](https://xdebug.org/wizard)

格式：ln -s [原文件] [软链接文件]

ln -s .surge.conf mac_surge.conf

```
~ ll /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php
lrwxrwxrwx  1 root  wheel    10B  1 30 23:10 /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php -> php-7.3.14
➜  ~ ln -s /usr/local/Cellar/php@7.3/7.3.15/bin/php /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php
ln: /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php: File exists
➜  ~ ln -s /usr/local/Cellar/php@7.3/7.3.15/bin/php /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php-7.3.14
ln: /Users/Daglas/.bitnami/stackman/machines/xampp/volumes/root/bin/php-7.3.14: File exists
```

unlink 路径即可

没解决。xampp 用的 php 还是自己的。

## 02

用户基本信息读不出来。

查得 2019 年微信改了规则，app.js 里的直接获取函数不能直接用了。改成直接在 wxml 里用开放数据即可：

```
<open-data type="userAvatarUrl"></open-data>
<open-data type="userNickName"></open-data>
<open-data type="userCity"></open-data>
```










