# 0602提取物性数据

## 01. 从 word 里提取表格数据

```py
# -*- coding:utf-8 -*-

from io import StringIO
import json, time, os.path, re, glob

import numpy as np
import pandas as pd
from sqlalchemy import create_engine
import docx
from docx import Document

def get_docxtable():
    """获取 word 内 table 数据"""
    document = Document('material.docx')
    tables = document.tables
    table = tables[0]

    materials = []

    for i in range(1, len(table.rows)):
        material = {}
        material['id'] = table.cell(i,0).text
        material['name'] = table.cell(i,1).text
        material['alisname'] = table.cell(i,2).text
        material['englishname'] = table.cell(i,3).text
        material['cas'] = table.cell(i,4).text
        material['hazard'] = table.cell(i,5).text
        material['comment'] = table.cell(i,6).text
        materials.append(material)

    # with open('materialdata.json', 'w',  encoding='utf-8') as f:
    with open('materialdata.json', 'w') as f:
        json.dump(materials, f)

    # 存储为 json 数据
    with open('data.json', 'w') as f:
        json.dump(materials, f)
    
    # 转成 dataframe 格式
    df = pd.read_json("data.json",encoding="utf-8", orient='records')

    # 写数据
    engine = create_engine('mysql+pymysql://root@localhost:3306/pandasdata')
    df.to_sql('materialdata', engine, index= False)

if __name__ == '__main__':
    time_start = time.time()

    try:
        get_docxtable()
    except Exception as e:
        print('Error: ' + e)

    time_end = time.time()
    print('Time Used: ' + str(time_end-time_start) + 's')

```

## 02. 过程中遇到的问题

### 01

word 要另存为 2007 版的 docx 文件，否则读不出来。

官方文档有关表格的知识：[Quickstart — python-docx 0.8.10 documentation](https://python-docx.readthedocs.io/en/latest/user/quickstart.html)。

### 02

json 转成 dataframe 格式数据有很多知识点。

[python中基于pandas模块：json与dataframe的互相转换_Python_theskylife的博客-CSDN博客](https://blog.csdn.net/qq_41780234/article/details/84990551)

[pandas.read_json — pandas 1.0.3 documentation](https://pandas.pydata.org/docs/reference/api/pandas.read_json.html#pandas.read_json)

当我们在进行数据分析的时候，经常会遇到各种各样格式的文件，今天在这里整理一下对于json格式的文件怎么转化为dataframe的形式的文件。

1、对于简单的json形式。所谓的简单的 json 格式，就是将字典形式的文件，直接输出成 dataframe 形式的文件。test.json：

```py
obj="""[{"姓名": "张三",
 "住处": "天朝",
 "宠物": "koala",
 "兄弟": "李四"
},{"姓名": "李四",
 "住处": "天朝",
 "宠物": "cat",
 "兄弟": "张三"}]"""

with open("test.json","w",encoding="utf-8") as f:
    f.write(obj)
```

利用 pandas 自带的 read_json 直接解析字符串。

```py
import pandas as pd
df = pd.read_json("test.json",encoding="utf-8", orient='records')
print(df)
```

利用 json 库 loads 方法和 pandas 库中的 json_normalize 方法。

```py
import json 
from pandas.io.json import json_normalize
data=open("test.json",encoding="utf-8").read()
data_list = json.loads(data)
df = json_normalize(data_list)
print(df)
```

2、对于稍微复杂一些的 json 进行处理。复杂的一些的 json 格式的文件，例子如下，我们想要得到的数据是张三兄弟的数据，同样先写入 json 文件：

```py
obj = """
{"姓名": "张三",
 "住处": ["天朝", "岛国", "万恶的资本主义日不落帝国"],
 "宠物": null,
 "兄弟": [{"姓名": "李四", "年龄": 25, "宠物": "汪星人"},
              {"姓名": "王五", "年龄": 23, "宠物": "喵星人"}]
}"""
with open("test1.json","w",encoding="utf-8") as f:
    f.write(obj)
```

利用 json 的 loads 和 pandas 的 DataFrame。

```py
import json 
import pandas as pd
with open("test1.json","r",encoding="utf-8") as f:
    info=f.read()
    data_list = json.loads(info)
    brother_info = data_list["兄弟"]
    df=pd.DataFrame(brother_info)
#     print(type(brother_info))
#     print(brother_info)
#     print(brother_info)
```

利用 json 的 loads 和 pandas 的 json_normalize。

```py
from pandas.io.json import json_normalize
import json 
with open("test1.json","r",encoding="utf-8") as f:
    info=f.read()
    data_list = json.loads(info)
    brother_info = data_list["兄弟"]
    df = json_normalize(brother_info)
    print(df)
```

利用 json 的 loads 和 pandas 的 read_json。

```py
import json 
import pandas as pd
with open("test1.json","r",encoding="utf-8") as f:
    info=f.read()
    data_list = json.loads(info)
    brother_info = data_list["兄弟"]
    json_data=json.dumps(brother_info)
    df=pd.read_json(json_data,orient="records")
    print(df)
```

总结：

在以上的例子中，可以发现在进行简单的格式转换的时候，可以使用 pandas 库的 read_json 进行处理，在进行复杂的格式转换的时候就要配合 json 库进行使用。无论是什么样的 json 数据，基本思路都是现将 json 文件读取进来，然后选择想要转换的数据，或是列表或是字典，然后再进行转换。

在这里重点介绍一下两个函数 read\_json 方法和 json\_normalize 方法。在使用时，要注意 read\_json 方法中 orient 参数的选择，同时 json\_normalize 可以将传入的列表、字典形式的 json 格式数据直接转换成 dataframe。

DataFrame 转为 json。通常情况下，我们使用的都是 pandas 中的 to\_json() 函数，可以通过设置 orient 参数来转换成为我们想要的 json 格式，orient 函数有以下几个参数："split", "records", "index", "columns", "values"。

1『后面的内容详见原文或者官方文档。』






