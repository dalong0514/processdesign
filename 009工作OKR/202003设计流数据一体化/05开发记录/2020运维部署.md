## 01. 换行符准换

提交的时候有个警告：

LF will be replaced by CRLF in git - What is that and is it important?

[LF will be replaced by CRLF in git - What is that and is it important? - Stack Overflow](https://stackoverflow.com/questions/5834014/lf-will-be-replaced-by-crlf-in-git-what-is-that-and-is-it-important)

用命令下面命令解决：

    git config core.autocrlf true

首先问题出在不同操作系统所使用的换行符是不一样的，下面罗列一下三大主流操作系统的换行符：

1、Uinx/Linux 采用换行符 LF 表示下一行（LF：LineFeed，中文意思是换行）。

2、Dos 和 Windows 采用回车+换行 CRLF 表示下一行（CRLF：CarriageReturn LineFeed，中文意思是回车换行）。

3、Mac OS采用回车 CR 表示下一行（CR：CarriageReturn，中文意思是回车）。

可以通过以下命令「git config core.autocrlf」来显示当前你的 Git 中采取哪种对待换行符的方式。

此命令会有三个输出，true，false 或者 input。

 1、为 true 时，Git 会将你 add 的所有文件视为文本文件，将结尾的 CRLF 转换为 LF，而 checkout 时会再将文件的 LF 格式转为 CRLF 格式。

2、为 false 时，line endings 不做任何改变，文本文件保持其原来的样子。

3、为 input 时，add 时 Git 会把 CRLF 转换为 LF，而 check 时仍旧为 LF，所以 Windows 操作系统不建议设置此值。

解决办法：将 core.autocrlf 设为 false 即可解决这个问题，不过如果你和你的伙伴只工作于 Windows 平台或者 Linux 平台，那么没问题，不过如果是存在跨平台的现象的话，还是需要考虑一下。但当 core autocrlf 为 true 时，还有一个需要慎重的地方，当你上传一个二进制文件，Git 可能会将二进制文件误以为是文本文件，从而也会修改你的二进制文件，从而产生隐患。

    git config --global core.autocrlf true

最后的方案：全局的设置为 false，要部署到远程的数据流「miniapp」项目里设置为 true。

## 02. 安装 laravel-excel 

发现部署到远程端后 laravel-excel 没安装后，定位到 .gitignore 文件里，发现设置了 /vendor，表明这个文件夹下的文件不推送到远程，取消后发现还是解决不了问题，估计是晚了的原因。尝试现在本地试验试验。

报错：

```
ReflectionException (-1)
Class excel does not exist
```

结合了几个教程解决了，但具体原理不清楚。

3『[php - Composer Update Laravel - Stack Overflow](https://stackoverflow.com/questions/24782960/composer-update-laravel)

When you run composer update, composer generates a file called composer.lock which lists all your packages and the currently installed versions. This allows you to later run composer install, which will install the packages listed in that file, recreating the environment that you were last using.

It appears from your log that some of the versions of packages that are listed in your composer.lock file are no longer available. Thus, when you run composer install, it complains and fails. This is usually no big deal - just run composer update and it will attempt to build a set of packages that work together and write a new composer.lock file.

However, you're running into a different problem. It appears that, in your composer.json file, the original developer has added some pre- or post- update actions that are failing, specifically a php artisan migrate command. This can be avoided by running the following: composer update --no-scripts

This will run the composer update but will skip over the scripts added to the file. You should be able to successfully run the update this way. However, this does not solve the problem long-term. There are two problems:

1 A migration is for database changes, not random stuff like compiling assets. Go through the migrations and remove that code from there. 「觉得没必要用 laravel 里的 migration 功能，直接在数据库里操作。（2020-05-01）」

2 Assets should not be compiled each time you run composer update. Remove that step from the composer.json file.

From what I've read, best practice seems to be compiling assets on an as-needed basis during development (ie. when you're making changes to your LESS files - ideally using a tool like gulp.js) and before deployment.

「给了一个建议，目前看不懂。（2020-05-01）」

』

先命令：

    composer update --no-scripts

接着在远程服务器里 clean cache config：

```
php artisan cache:clear
php artisan config:cache
```

上面操作完成后，laravel-excel 就可以用了。

## 03. 版本回滚

commit 提交到远程后悔了，本地回滚后发现不能 push，因为远程的比本地的还领先。可以先强制提交：

    git push -f origin master
    
不过这个办法必须得有最高权限。

## 04. 图片 url 的问题

本地服务器跑的时候，图片 URL 没问题，但是远程里就少了前面的头「https://img.hg101.vip/」，找了很久发现配置文件「.env」里七牛的 QN_URL 在各个模型文件里起不了作用，目前想到的解决办法是在模型文件里把 URL 头声明了常量：

```php
const QN_URL = 'https://img.hg101.vip/'; 
```

然后将 env('QN_URL') 更换为 self::QN_URL。

## 05. 配置文件切换

远程服务器配置：

```
DB_CONNECTION=mysql
DB_HOST=47.99.104.199
DB_PORT=3306
DB_DATABASE=shop
DB_USERNAME=root
DB_PASSWORD=root
```

本地服务器配置：

```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=shop
DB_USERNAME=root
DB_PASSWORD=
```

想在本地安装好 npm 包之后直接推送到远程，删掉 .gitignore 里的：

```
/node_modules
```

## 06. Window-Server 服务器

服务器：192.168.1.38

[Windows 10 上的 Windows 和 Linux 容器 | Microsoft Docs](https://docs.microsoft.com/zh-cn/virtualization/windowscontainers/quick-start/set-up-environment?tabs=Windows-Server)

[Windows Server 2016 安装Docker - BBSMAX](https://www.bbsmax.com/A/QW5YeK7q5m/)

连接：

搜索框里直接输入 mstsc，会跳出远程桌面的连接面板，服务器 IP 地址：192.168.1.38，用户名 titan\fengdalong，输入密码即可远程连接到服务器。

```·1q
安装Hyper-V
>Install-WindowsFeature -Name Hyper-V

安装容器功能
>Install-WindowsFeature -Name containers

安装完成后需重启服务器
>Restart-computer
```

确认 NuGet 是否在 PackageProvider 中。

```
PS C:\windows\system32> Get-PackageProvider -ListAvailable

Name                     Version          DynamicOptions
----                     -------          --------------
msi                      3.0.0.0          AdditionalArguments
msu                      3.0.0.0
PowerShellGet            1.0.0.1          PackageManagementProvider, Type, Scope, AllowClobber, SkipPublisherCheck, ...
Programs                 3.0.0.0          IncludeWindowsInstaller, IncludeSystemComponent
```

如果不在其中，那么需要获取 NuGet。

```
PS C:\windows\system32> Install-PackageProvider NuGet -Verbose
VERBOSE: Using the provider 'Bootstrap' for searching packages.
VERBOSE: Finding the package 'Bootstrap::FindPackage' 'NuGet','','','''.
VERBOSE: Performing the operation "Install Package" on target "Package 'nuget' version '2.8.5.208' from
'https://oneget.org/nuget-2.8.5.208.package.swidtag'.".
```

进自己的共享网盘：

```
\\feng--dalong
```

供参考的：

```
$sourceNugetExe = "https://dist.nuget.org/win-x86-commandline/latest/nuget.exe"
$targetNugetExe = "$rootPath\nuget.exe"
Invoke-WebRequest $sourceNugetExe -OutFile $targetNugetExe
Set-Alias nuget $targetNugetExe -Scope Global -Verbose
```

