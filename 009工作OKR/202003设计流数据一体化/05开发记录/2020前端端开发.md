你所看到的可能与事实完全不同。

1、小程序里实现的表格实际上是通过 flex 布局，一个个方块拼接的，边缘 border 设置的实体线。只是视觉上像表格。

2、CAD 数据确认后提交入库，用户看到的是在确认后提交入库，实际后端是，在工艺确认数据数据的环节上就已经入库了。

## 01. 比较运算符

== 不考虑数据类型，=== 考虑数据类型。模块 3 消除余湿里：

```php
foreach ($equipments as $equipment) {
    if ($equipment->type == 1) {  // 电热设备
        $total = $total + $this->electric($equipment);
    }
    if ($equipment->type == 2) {
        $total = $total + $this->motor($equipment);
    }
    if (!$equipment) {
        $total = $total + $this->other($equipment);
    }
}
```

2、给数组添加元素直接用 \$array[] = XX

官方文档：[PHP: array_push - Manual](https://www.php.net/manual/zh/function.array-push.php)

如果用 array_push() 来给数组增加一个单元，还不如用 \$array[] = ，因为这样没有调用函数的额外负担。

## 02. laravel 里实现软删除

[Eloquent: Getting Started - Laravel - The PHP Framework For Web Artisans](https://laravel.com/docs/7.x/eloquent#soft-deleting)

In addition to actually removing records from your database, Eloquent can also "soft delete" models. When models are soft deleted, they are not actually removed from your database. Instead, a deleted_at attribute is set on the model and inserted into the database. If a model has a non-null deleted_at value, the model has been soft deleted. To enable soft deletes for a model, use the Illuminate\Database\Eloquent\SoftDeletes trait on the model:

```php
<?php

namespace App;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Flight extends Model
{
    use SoftDeletes;
}
```

The SoftDeletes trait will automatically cast the deleted_at attribute to a DateTime / Carbon instance for you.

现在 BaseModel 里实现：

```php
<?php

namespace App\Model;

use App\Exceptions\ModelExceptions;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class BaseModel extends Model
{
    use SoftDeletes;

    const CREATED_AT = 'created_at';
    const UPDATED_AT = 'updated_at';

    protected $datas = ['deleted_at'];

    public $timestamps = true;

    public function fromDateTime($value)
    {
        return strtotime(parent::fromDateTime($value));
    }

    /**
     * 抛出错误信息
     * @param string msg
     * @param int code
     * @throws ModelExceptions
     */
    public function error($code,  $msg = '')
    {
        $msg = $msg ?: ModelExceptions::ERROR[$code];
        throw new ModelExceptions($msg, $code);
    }
}
```

后面用到的数据表单模型都直接继承 BaseModel，比如暖通系统通风的数据模型 NsSystemModel：

```php
<?php

namespace App\Model;

class NsSystemModel extends BaseModel
{
    protected $table = 'ns_system';

    public function monomer()
    {
        return $this->hasOne(MonomerModel::class, 'id', 'monomer_id');
    }

}
```

## 03. 前端包的更新

如果要更新 node 组件的话，记得先把 node_modules 文件夹先删掉，然后「npm install」安装，只是新增包的话可以不删那个文件夹。

## 04. 远程服务器上解决冲突的手段

1、服务器上本地做了修改，pull 不下来。

git reset HEAD 是回退到当前版本。经试验，本地修改的文件，提交到暂存区，然后用这个命令，相当于「反悔」上面的步骤。

git reset HEAD^ 回退到上一版本。感觉这 2 个命令都不好用。

git reset --hard 相当于直接放弃之前的修改，不管是只是本次修改还是已经提交到了暂存区，这个命令好用的。

git checkout -- . 或者 git checkout -- *，这两个命令只是针对本地的修改，即放弃掉本地的修改，但是对已经提交到暂存区的就无能为力了。必须得用「git reset --hard」来放弃。

## 05. 不同版本的构建

最后定的是，生产环境用于公司内的服务器，预发布环境应用于阿里云上的服务器。

```
# 打包正式环境
npm run build:prod

# 打包预发布环境
npm run build:stage
```

配置文件「.env.production」：

```
# just a flag
ENV = 'production'

# base api
VUE_APP_BASE_API = '/prod-api'
VUE_APP_BASE_API_DEF = 'http://192.168.1.38:8081'
```

配置文件「.env.staging」：

```
NODE_ENV = production

# just a flag
ENV = 'staging'

# base api
# VUE_APP_BASE_API = '/stage-api'

VUE_APP_BASE_API = '/prod-api'
VUE_APP_BASE_API_DEF = 'http://test.hg101.vip'
```

另外，公司服务器上的前端代码，有一个地方（打包生成文件的路径）要在本地修改。在 `vue.config.js` 文件里，`module.exports` 对象里的属性字段 `outputDir`，将原来的 `dist` 更改为 `../dataflow/`。

## 06. 图床设置

[七牛云 - 个人信息](https://portal.qiniu.com/user/profile)

[如何用七牛和picGO设置免费图床 - 简书](https://www.jianshu.com/p/0997d0d15e55)

小程序的图床

2021-02-01

图片存放在阿里云服务器，因为那边的 ip 地址是有证书验证的（腾讯云上免费领取了一年的使用权）。