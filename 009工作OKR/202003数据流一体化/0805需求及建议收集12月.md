## 01. 需求收集

### 2020-12-16

徐骋：

1、导出的设备临时文件，增加图号字段。——已完成（V1.3）

2、加强版自动拼接仪表控制点。——已完成（V1.3）

### 2020-12-21

屠立峰：

1、导出导入通用块，并且每个属性前自动添加 ' 防止，被 excel 自动转换。——已完成（V1.3）

### 2020-12-21

孙晨（给排水）：

根据消防及给排水平面图，自动生成消火栓系统图，主要是平管和立管（带管线号）。

### 2020-12-24

郑飞宏：

1、字体名称用 DataFlow。——已完成

2、外显的字放在 0 层；面板里的设为随层。——已完成

3、工具栏。——已完成

## 02. 建议收集

## 03. 修改记录及 bug

1、隔膜泵无电机，设备表删除该行信息。

电机功率有数据的话才写入设备一览表。——已修复（V1.3）

贡献者：李恒（2020-12-10）。

2、数据量太大导致数据写不进数据库。

朗华项目，管道去重后大约 2470 多根管道，个人觉得是数据量超过了 PHP 处理的极限，目前的解决办法是将流程图拆成 2 个，测试后发极限处理的管道应该是 1900 多根。

挖掘出新功能，导出数据的面板可以新增框选数据导出，这样既能方便自己测试数据，又能以这种折中的办法解决上面的同类问题。——未完成

贡献者：徐骋（2020-12-10）。

3、插入的块会自动缩小比例。——已修复（V1.3）

解决方案来源：[在 AutoCAD 产品中将对象插入图形时，对象会缩放 | AutoCAD | Autodesk Knowledge Network](https://knowledge.autodesk.com/zh-hans/support/autocad/troubleshooting/caas/sfdcarticles/sfdcarticles/CHS/Blocks-xrefs-or-raster-images-are-scaled-when-inserted.html)。

只需取消激活插入对象的自动缩放即可，输入命令 INSUNITS，将值设为 0。

贡献者：宗源（2020-12-11）。

4、编号出现待小数点。——已修复（V1.3）

标准精度设置导致的，点「标注」或者直接快捷命令 D 进入标准样式管理器，点「修改」，把精度改成 0.00 即可。

贡献者：自己（2020-12-14）。

5、刷图号数据不应包含外管数据。——已修复（V1.3）

外管块里的图号信息并不是所在图里的图号，不应被刷。

贡献者：曾涵卫（2020-12-21）。

6、截图箭头有时出现关联不上设备信息的情况。——已修复（V1.3）

生成接图箭头的管道数据源，其来去里的设备位号有空格，导致与设备数据匹配不上。现在后台在匹配前会自动剔除设备位号的空格。

贡献者：曾涵卫（2020-12-21）。

6、反写数据，临时文件里的数据 ID 有可能在图纸里不存在。——已修复（V1.3）

解决方案：剔除掉不存在的数据 ID。

解决问题时发现的重要信息：块同步后，所有的块数据 ID 会更新掉。

贡献者：李侦糠。

## 04. 邮件记录

### 2020-12-30

邮件名：设计流数据一体化升版V1.3

各位：附件为升版 V1.3 后的的相关文件，更新内容如下（具体操作详见说明文档）：

### V1.3 版更新内容

**总体相关：**

1、数据流菜单规整。（贡献者郑飞宏）

工艺的数据流目前 6 大块功能模块。1）帮助：版本信息、一键同步数据流属性块；2）数据修改：刷数据图号、刷管道起点终点、刷仪表所在位置、命令版刷块属性、界面版刷块属性、强化版自动编号、图签自动编号；3）数据提取：导出数据、导出数据流临时 excel、导出通用块临时 excel；4）流程图辅助：自动生成接图箭头、自动生成辅助流程、自动生成设备位号、刷变等级号信息、刷变管径信息；5）布置图相关：洁净空调条件房间自动编号；6）保留的旧版功能。

在此特别感谢郑飞宏提炼出的功能分类模块。

2、新增数据流常用命令工具栏。（贡献者郑飞宏）

将常用的数据流命令做成了一个 CAD 工具栏，目前画图时你有 3 种方法使用数据流功能：1）菜单栏。2）工具栏。3）将数据流命令映射为自己喜欢的命令名称（CAD 里的工具 -> 自定义 -> 编辑程序参数）。大家根据自己的习惯自行选择。

3、新增一键同步数据流属性块功能。（贡献者徐骋）

以后不需要用命令 BATTMAN 一个块一个块点「同步」了，同步时将自己的图纸整体拷进「模板」CAD 中，点帮助里的「一键同步数据流属性块」即可。

特别提醒：请谨慎同步「管道块」。我们发现同步管道块后，所有管道的「数据 ID」会更改，而一键更新接图箭头和一键更新辅助流程，是与管道的数据 ID 关联的，同步管道块后这两个功能无法使用。所以本次更新的「一键同步数据流属性块」剔除掉了管道同步，也请大家如非必要，不要同步管道块。

4、规整字体、图层以及一些块的基点位置。（贡献者郑飞宏）

汇总：1）数据流数据字体统一样式命名「DataFlow」，里面的字体用公司常用的 tssdeng.shx；2）数据流块图层做了一些调整，外显的字调整到 0 层，保证整个块随意调整到其他层后可随层变化；3）仪表块的基点位置做了调整。使用过程中，有些人将块进行了镜像操作，此时同步块后会出现位置偏移。解决办法是将基点设为图形的中心。

此版已经将仪表块的中心作为基点，同步后你图纸里的仪表块会整体左移，通过 CAD 右键自带的选择类似对象筛选出仪表块，整体右移 5 即可复原位置。目前管道块的偏移问题还没找到好的解决办法，如果管道号文字居中设置且中心设置为基点，会导致不整齐结果。如果有人有解决办法请告知于我。

5、新增批量刷块属性功能。（贡献者郑飞宏）

数据修改的「命令版刷块属性」，可以提取一个块信息为源数据，批量将其属性值刷给后面框选的块，刷的块可以是不同类型的数据（后台自动匹配相关的属性字段）。

6、升级版导出导入 excel 文件。

数据提取模块中的「导出数据流临时 excel」。两点：1）数据流相关块的导入导出集中到一个功能面板，现在可以同时导出 7 大类设备块。2）取消导入临时文件的前置条件，旧版只有点击导出数据完成后才让用户导入。

7、导出通用块临时 excel。（贡献者屠立峰）

数据提取模块中的「导出通用块临时 excel」，可以导出 CAD 中任意同类型块数据，并且自动添加撇号转化为 excel 文本格式，解决一些被 excel 自动转化错的场景，如被当作科学计数法。

**管道数据相关：**

1、新增变等级号、变管径功能。（贡献者郑飞宏、徐骋）

通过给管道刷变等级号、变管径信息，管道数据表中生成相应的多根管道。

**仪表条件相关：**

1、新增自动补全仪表控制点名称隐藏功能。（贡献者徐骋）

自动抓取相关数据补全仪表控制点名称，需要「暗号」，具体操作详见说明文档的技巧篇。

**设备布置相关相关：**

1、新增洁净空调条件模块。（贡献者郑飞宏、牟苏嫣）

具体操作详见说明文档。

### V1.3 版 bug 修复

1、隔膜泵无电机，设备表删除该行信息。（bug 贡献者李恒）

2、插入的块会自动缩小比例。（bug 贡献者宗源）解决方法详见文档说明。

3、编号出现待小数点。（bug 贡献者章圣望、葛兰兰）解决方法详见文档说明。

4、刷图号数据不应包含外管数据。（bug 贡献者曾涵卫）

5、excel 反写数据，临时文件里的数据 ID 有可能在图纸里不存在了。（bug 贡献者李侦糠）